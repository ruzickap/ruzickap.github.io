<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest" /><meta name="author" content="Petr Ruzicka" /><meta property="og:locale" content="en" /><meta name="description" content="TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest" /><meta property="og:description" content="TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest" /><link rel="canonical" href="https://ruzickap.github.io/posts/tp-link-tl-wr1043nd-and-openwrt-1209-with-two-ssids-multissid-private-and-guest/" /><meta property="og:url" content="https://ruzickap.github.io/posts/tp-link-tl-wr1043nd-and-openwrt-1209-with-two-ssids-multissid-private-and-guest/" /><meta property="og:site_name" content="Petr’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2013-08-03T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest" /><meta name="twitter:site" content="@Ruzicka_Petr" /><meta name="twitter:creator" content="@Ruzicka_Petr" /><meta name="google-site-verification" content="4ugGShJoiB9veoPwFcMsMjzk-1BYbi5ozcSnovkBWtA" /><meta name="msvalidate.01" content="592AB158E3F9EF887F8DC8E69A2FF754" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Petr Ruzicka","url":"https://petr.ruzicka.dev"},"dateModified":"2026-01-17T19:48:44+01:00","datePublished":"2013-08-03T00:00:00+02:00","description":"TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest","headline":"TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest","mainEntityOfPage":{"@type":"WebPage","@id":"https://ruzickap.github.io/posts/tp-link-tl-wr1043nd-and-openwrt-1209-with-two-ssids-multissid-private-and-guest/"},"url":"https://ruzickap.github.io/posts/tp-link-tl-wr1043nd-and-openwrt-1209-with-two-ssids-multissid-private-and-guest/"}</script><title>TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest | Petr's Blog</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> document.addEventListener('DOMContentLoaded', () => { const pv = document.getElementById('pageviews'); if (pv !== null) { const uri = location.pathname.replace(/\/$/, ''); const url = `https://ruzickap-github-io.goatcounter.com/counter/${encodeURIComponent(uri)}.json`; fetch(url) .then((response) => response.json()) .then((data) => { const count = data.count.replace(/\D/g, ''); pv.innerText = new Intl.NumberFormat().format(count); }) .catch((error) => { pv.innerText = '1'; }); } }); </script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-64WRCWDZM8"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-64WRCWDZM8'); }); </script> <script async src="https://gc.zgo.at/count.js" data-goatcounter="https://ruzickap-github-io.goatcounter.com/count" ></script> <script defer src="https://cloud.umami.is/script.js" data-website-id="380ea41a-7d5f-4423-8e13-03151bde195f" ></script> <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "ad8c64404e1e41dba184019564cf11bb"}' ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://0.gravatar.com/avatar/5484c0fd9f98e2ffd9212b158931bf4b?s=200" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Petr's Blog</a><p class="site-subtitle fst-italic mb-0">DevOps • GitOps • K8s</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-project-diagram"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/ruzickap" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['petr.ruzicka','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://petr.ruzicka.dev" aria-label="homepage" target="_blank" rel="noopener noreferrer" > <i class="fas fa-home"></i> </a> <a href="https://mastodon.social/@petr_ruzicka" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="false"><header><h1 data-toc-skip>TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest</h1><p class="post-desc fw-light mb-4">TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1375480800" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 3, 2013 </time> </span> <span> Updated <time data-ts="1768675724" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 17, 2026 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://petr.ruzicka.dev">Petr Ruzicka</a> </em> </span><div> <span> <em id="pageviews"> <i class="fas fa-spinner fa-spin small"></i> </em> views </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2733 words" > <em>15 min</em> read</span></div></div></div></header><div class="content"><blockquote class="prompt-info"><p>Original post from <a href="https://linux.xvx.cz/2013/08/tp-link-tl-wr1043nd-and-openwrt-1209.html">linux.xvx.cz</a></p></blockquote><p>I decided to change my home network to match the following “network diagram”:</p><p><a href="https://raw.githubusercontent.com/ruzickap/linux.xvx.cz/refs/heads/gh-pages/pics/openwrt/wifi_openwrt2.svg" class="popup img-link shimmer"><img src="https://raw.githubusercontent.com/ruzickap/linux.xvx.cz/refs/heads/gh-pages/pics/openwrt/wifi_openwrt2.svg" alt="OpenWrt multi-SSID network diagram" loading="lazy"></a></p><p>The core part of the design is <a href="https://www.tp-link.com/en/products/details/?model=TL-WR1043ND">TP-Link TL-WR1043ND</a> wifi router running <a href="https://openwrt.org/">OpenWrt</a> with a small 16GB USB stick <code class="language-plaintext highlighter-rouge">/dev/sda1</code> containing ext3 partition with OpenWrt configuration + swap.</p><p>There is also a 16GB USB stick and 2 thermometers connected using USB Serial connector (bought on eBay):</p><p>I’m going to use the last stable version of the OpenWrt firmware: <a href="https://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/openwrt-ar71xx-generic-tl-wr1043nd-v1-squashfs-sysupgrade.bin">openwrt-ar71xx-generic-tl-wr1043nd-v1-squashfs-sysupgrade.bin</a></p><p>Upgrade the firmware and remove the old configuration:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">rm</span> <span class="nt">-r</span> /tmp/opkg-lists/
sysctl <span class="nt">-w</span> vm.drop_caches<span class="o">=</span>1
sysupgrade <span class="nt">-v</span> <span class="nt">-n</span> https://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/openwrt-ar71xx-generic-tl-wr1043nd-v1-squashfs-sysupgrade.bin
</pre></table></code></div></div><p>Here are the notes how way how I configured it.</p><p>If you don’t like the commands feel free to check the configs here: <a href="https://github.com/ruzickap/linux.xvx.cz/tree/gh-pages/files/openwrt">https://github.com/ruzickap/linux.xvx.cz/tree/gh-pages/files/openwrt</a></p><p>Configure the system, ssh on port 2222 and LAN + wifi IP:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre><td class="rouge-code"><pre>telnet 192.168.1.1
passwd

<span class="c">#Erase ALL</span>
<span class="c">#rm -r /overlay/*</span>
<span class="c">#mtd -r erase rootfs_data</span>

opkg update
opkg <span class="nb">install </span>block-mount kmod-fs-ext4 kmod-usb-storage

uci <span class="nb">set </span>system.@system[0].hostname<span class="o">=</span>gate
uci <span class="nb">set </span>system.@system[0].timezone<span class="o">=</span>CET-1CEST,M3.5.0,M10.5.0/3
uci <span class="nb">set </span>system.@system[0].timezone<span class="o">=</span>CET-1CEST,M3.5.0,M10.5.0/3
uci <span class="nb">set </span>system.@system[0].log_file<span class="o">=</span>/etc/messages
uci <span class="nb">set </span>system.@system[0].log_size<span class="o">=</span>1024
uci <span class="nb">set </span>system.@system[0].log_type<span class="o">=</span>file

uci <span class="nb">set </span>dropbear.@dropbear[0].Port<span class="o">=</span>2222
uci <span class="nb">set </span>system.@timeserver[0].enable_server<span class="o">=</span>1

uci add firewall rule
uci <span class="nb">set </span>firewall.@rule[-1].name<span class="o">=</span>ssh
uci <span class="nb">set </span>firewall.@rule[-1].src<span class="o">=</span>wan
uci <span class="nb">set </span>firewall.@rule[-1].target<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@rule[-1].proto<span class="o">=</span>tcp
uci <span class="nb">set </span>firewall.@rule[-1].dest_port<span class="o">=</span>2222

uci add firewall redirect
uci <span class="nb">set </span>firewall.@redirect[-1].name<span class="o">=</span>ssh_lan
uci <span class="nb">set </span>firewall.@redirect[-1].src<span class="o">=</span>lan
uci <span class="nb">set </span>firewall.@redirect[-1].proto<span class="o">=</span>tcp
uci <span class="nb">set </span>firewall.@redirect[-1].src_dport<span class="o">=</span>22
uci <span class="nb">set </span>firewall.@redirect[-1].dest_port<span class="o">=</span>2222
uci <span class="nb">set </span>firewall.@redirect[-1].dest_ip<span class="o">=</span>192.168.0.1

uci <span class="nb">set </span>network.lan.ipaddr<span class="o">=</span>192.168.0.1
uci <span class="nb">set </span>network.lan.netmask<span class="o">=</span>255.255.255.0

uci <span class="nb">set </span>dhcp.lan.start<span class="o">=</span>200
uci <span class="nb">set </span>dhcp.lan.limit<span class="o">=</span>54

uci <span class="nb">set </span>dhcp.@dnsmasq[0].domain<span class="o">=</span>xvx.cz
uci <span class="nb">set </span>dhcp.@dnsmasq[0].leasefile<span class="o">=</span>/etc/dnsmasq-dhcp.leases
uci <span class="nb">set </span>dhcp.@dnsmasq[0].port<span class="o">=</span>0
uci <span class="nb">set </span>dhcp.@dnsmasq[0].cachelocal<span class="o">=</span>0
uci <span class="nb">set </span>dhcp.lan.dhcp_option<span class="o">=</span>6,8.8.8.8
uci <span class="nb">set </span>dhcp.wifi_open.dhcp_option<span class="o">=</span>6,8.8.8.8

uci add fstab mount
uci <span class="nb">set </span>fstab.@mount[-1].device<span class="o">=</span>/dev/sda1
uci <span class="nb">set </span>fstab.@mount[-1].fstype<span class="o">=</span>ext3
uci <span class="nb">set </span>fstab.@mount[-1].options<span class="o">=</span>rw,sync,noatime,nodiratime
uci <span class="nb">set </span>fstab.@mount[-1].enabled<span class="o">=</span>1
uci <span class="nb">set </span>fstab.@mount[-1].enabled_fsck<span class="o">=</span>0
uci <span class="nb">set </span>fstab.@mount[-1].is_rootfs<span class="o">=</span>1

uci <span class="nb">set </span>fstab.@swap[0].enabled<span class="o">=</span>1
</pre></table></code></div></div><p>Configure the private wifi:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>uci add wireless wifi-iface
uci <span class="nb">set </span>wireless.@wifi-iface[-1].device<span class="o">=</span>radio0
uci <span class="nb">set </span>wireless.@wifi-iface[-1].network<span class="o">=</span>lan
uci <span class="nb">set </span>wireless.@wifi-iface[-1].mode<span class="o">=</span>ap
uci <span class="nb">set </span>wireless.@wifi-iface[-1].ssid<span class="o">=</span>peru_private
uci <span class="nb">set </span>wireless.@wifi-iface[-1].encryption<span class="o">=</span>psk2+tkip+aes
uci <span class="nb">set </span>wireless.@wifi-iface[-1].key<span class="o">=</span>xxxxxxxx

uci <span class="nb">set </span>wireless.radio0.channel<span class="o">=</span>8
uci <span class="nb">set </span>wireless.radio0.country<span class="o">=</span>CZ
uci <span class="nb">set </span>wireless.radio0.htmode<span class="o">=</span>HT40-
uci <span class="nb">set </span>wireless.radio0.noscan<span class="o">=</span>1
uci <span class="nb">set </span>wireless.radio0.bursting<span class="o">=</span>1
uci <span class="nb">set </span>wireless.radio0.ff<span class="o">=</span>1
uci <span class="nb">set </span>wireless.radio0.compression<span class="o">=</span>1
uci <span class="nb">set </span>wireless.radio0.xr<span class="o">=</span>1
uci <span class="nb">set </span>wireless.radio0.ar<span class="o">=</span>1
uci <span class="nb">set </span>wireless.radio0.txpower<span class="o">=</span>20
uci del wireless.@wifi-device[0].disabled
</pre></table></code></div></div><p>Configure the wifi_open - guest wifi access. For some reason <a href="https://web.archive.org/web/20140825150515/http://wiki.openwrt.org/doc/recipes/guest-wlan">OpenWrt Guest WLAN</a> is not working for me. I found this article (Polish) <a href="https://eko.one.pl/forum/viewtopic.php?id=2937">https://eko.one.pl/forum/viewtopic.php?id=2937</a> how to do it.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre><td class="rouge-code"><pre><span class="c">#Use your default MAC + 1 - my router's original MAC is 94:0C:6D:AC:55:AC</span>
<span class="nv">MAC</span><span class="o">=</span><span class="s2">"96:0C:6D:AC:55:AD"</span>

uci <span class="nb">set </span>network.wifi_open<span class="o">=</span>interface
uci <span class="nb">set </span>network.wifi_open.ifname<span class="o">=</span>eth0.3
uci <span class="nb">set </span>network.wifi_open.type<span class="o">=</span>bridge
uci <span class="nb">set </span>network.wifi_open.macaddr<span class="o">=</span><span class="nv">$MAC</span>
uci <span class="nb">set </span>network.wifi_open.proto<span class="o">=</span>static
uci <span class="nb">set </span>network.wifi_open.ipaddr<span class="o">=</span>10.0.0.1
uci <span class="nb">set </span>network.wifi_open.netmask<span class="o">=</span>255.255.255.0

uci <span class="nb">set </span>wireless.@wifi-iface[0].ssid<span class="o">=</span>medlanky.xvx.cz
uci <span class="nb">set </span>wireless.@wifi-iface[0].network<span class="o">=</span>wifi_open
uci <span class="nb">set </span>wireless.@wifi-iface[0].encryption<span class="o">=</span>none
uci <span class="nb">set </span>wireless.@wifi-iface[0].isolate<span class="o">=</span>1
uci <span class="nb">set </span>wireless.@wifi-iface[0].macaddr<span class="o">=</span><span class="nv">$MAC</span>

uci add firewall zone
uci <span class="nb">set </span>firewall.@zone[-1].name<span class="o">=</span>wifi_open
uci <span class="nb">set </span>firewall.@zone[-1].input<span class="o">=</span>REJECT
uci <span class="nb">set </span>firewall.@zone[-1].output<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@zone[-1].forward<span class="o">=</span>REJECT

uci add firewall forwarding
uci <span class="nb">set </span>firewall.@forwarding[-1].src<span class="o">=</span>wifi_open
uci <span class="nb">set </span>firewall.@forwarding[-1].dest<span class="o">=</span>wan

uci add firewall rule
uci <span class="nb">set </span>firewall.@rule[-1].name<span class="o">=</span>icmp-echo-request
uci <span class="nb">set </span>firewall.@rule[-1].src<span class="o">=</span>wifi_open
uci <span class="nb">set </span>firewall.@rule[-1].target<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@rule[-1].proto<span class="o">=</span>icmp
uci <span class="nb">set </span>firewall.@rule[-1].icmp_type<span class="o">=</span>echo-request

uci add firewall rule
uci <span class="nb">set </span>firewall.@rule[-1].name<span class="o">=</span>dhcp
uci <span class="nb">set </span>firewall.@rule[-1].src<span class="o">=</span>wifi_open
uci <span class="nb">set </span>firewall.@rule[-1].target<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@rule[-1].proto<span class="o">=</span>udp
uci <span class="nb">set </span>firewall.@rule[-1].src_port<span class="o">=</span>67-68
uci <span class="nb">set </span>firewall.@rule[-1].dest_port<span class="o">=</span>67-68

uci add firewall rule
uci <span class="nb">set </span>firewall.@rule[-1].name<span class="o">=</span>dns
uci <span class="nb">set </span>firewall.@rule[-1].src<span class="o">=</span>wifi_open
uci <span class="nb">set </span>firewall.@rule[-1].target<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@rule[-1].proto<span class="o">=</span>tcpudp
uci <span class="nb">set </span>firewall.@rule[-1].dest_port<span class="o">=</span>53

uci <span class="nb">set </span>dhcp.wifi_open<span class="o">=</span>dhcp
uci <span class="nb">set </span>dhcp.wifi_open.interface<span class="o">=</span>wifi_open
uci <span class="nb">set </span>dhcp.wifi_open.start<span class="o">=</span>2
uci <span class="nb">set </span>dhcp.wifi_open.limit<span class="o">=</span>253
uci <span class="nb">set </span>dhcp.wifi_open.dhcp_option<span class="o">=</span>6,8.8.8.8
uci <span class="nb">set </span>dhcp.wifi_open.leasetime<span class="o">=</span>1h

uci commit dhcp
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"/dnsmasq-dhcp.leases/a list 'interface' 'lan'"</span> /etc/config/dhcp
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"/dnsmasq-dhcp.leases/a list 'interface' 'wifi_open'"</span> /etc/config/dhcp

<span class="nb">rm</span> /etc/resolv.conf
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/resolv.conf <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
search xvx.cz
nameserver 8.8.8.8
</span><span class="no">EOF
</span></pre></table></code></div></div><p>Define the DHCP static hosts:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre><td class="rouge-code"><pre><span class="c"># WiFi</span>
uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>peru-nb-work-wifi
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.2
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:26:c6:51:39:34

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>andy-nb-wifi
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.3
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>74:f0:6d:93:c7:3a

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>peru-nb-old-wifi
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.4
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:15:00:11:48:5A

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>andy-android-wifi
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.5
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:23:76:D6:42:C7

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>peru-android-work-wifi
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.6
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:90:4c:c5:00:34

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>peru-palm-wifi
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.7
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:0b:6c:57:da:9a

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>RTL8187-wifi
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.8
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:C0:CA:54:F5:BA

<span class="c"># NIC</span>
uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>peru-nb-work-nic
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.130
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:22:68:1a:14:5d

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>andy-nb-nic
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.131
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>20:cf:30:31:da:b3

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>peru-nb-old-nic
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.132
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:13:D4:D1:03:57

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>peru-tv-nic
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.133
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:12:FB:94:1B:9A

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>raspberrypi-nic
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.134
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>b8:27:eb:8c:97:9e

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>server-nic
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.135
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:1f:c6:e9:f5:14
</pre></table></code></div></div><p>Configure the ssh to enable autologin:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>scp <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.ssh/id_rsa.pub"</span> root@192.168.1.1:/tmp/authorized_keys
ssh root@192.168.1.1
<span class="nb">cp</span> /tmp/authorized_keys /etc/dropbear/authorized_keys
<span class="nb">chmod </span>600 /etc/dropbear/authorized_keys
uci <span class="nb">set </span>dropbear.@dropbear[0].RootPasswordAuth<span class="o">=</span>off

uci commit
reboot
</pre></table></code></div></div><p>Repeat the steps above to save all the changes/files to the external USB storage.</p><p>Install the following packages:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>opkg update
opkg <span class="nb">install </span>bind-dig bzip2 collectd-mod-conntrack collectd-mod-cpu collectd-mod-df collectd-mod-disk collectd-mod-dns collectd-mod-exec collectd-mod-irq collectd-mod-memory collectd-mod-ping collectd-mod-processes collectd-mod-syslog collectd-mod-tcpconns ddns-scripts digitemp ethtool file <span class="nb">gzip </span>htop kmod-usb-serial-pl2303 less lftp lighttpd-mod-cgi lighttpd-mod-proxy lsof luci-app-statistics luci-app-transmission luci-app-upnp luci-app-vnstat luci-app-wol luci-app-qos luci-app-ddns luci-app-firewall
opkg <span class="nb">install </span>luci-app-watchcat mc mtr nmap nodogsplash openssh-sftp-server openssl-util rsync screen shadow-useradd ssmtp <span class="nb">sudo </span>sysstat tcpdump transmission-remote transmission-web vnstati wget zoneinfo-europe
</pre></table></code></div></div><p>Add my user and configure mc, screen and shell:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /usr/lib/mc/extfs.d
<span class="nb">touch</span> /etc/mc/sfs.ini

wget <span class="nt">--no-check-certificate</span> https://raw.github.com/MidnightCommander/mc/master/misc/filehighlight.ini <span class="nt">-O</span> /etc/mc/filehighlight.ini

<span class="nb">mkdir</span> <span class="nt">-p</span> /etc/skel/.mc/
<span class="nb">chmod </span>700 /etc/skel/.mc
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/skel/.mc/ini <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
[Midnight-Commander]
auto_save_setup=0
drop_menus=1
use_internal_edit=1
confirm_exit=0

[Layout]
menubar_visible=0
message_visible=0
</span><span class="no">EOF
</span><span class="nb">cp</span> <span class="nt">-r</span> /etc/skel/.mc /root/

wget <span class="nt">--no-check-certificate</span> https://raw.github.com/MidnightCommander/mc/master/contrib/mc-wrapper.sh.in <span class="nt">-O</span> - | <span class="nb">sed</span> <span class="s1">'s|@bindir@/mc|/usr/bin/mc --nomouse|'</span> <span class="o">&gt;</span> /usr/bin/mc-wrapper.sh
<span class="nb">chmod </span>a+x /usr/bin/mc-wrapper.sh

<span class="nb">echo</span> <span class="s2">"ruzickap  ALL=(ALL) NOPASSWD:ALL"</span> <span class="o">&gt;&gt;</span> /etc/sudoers

<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/screenrc <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
defscrollback 1000
startup_message off
termcapinfo xterm ti@:te@
hardstatus alwayslastline '%{= kG}[ %{G}%H %{g}][%= %{= kw}%?%-Lw%?%{r}(%{W}%n*%f%t%?(%u)%?%{r})%{w}%?%+Lw%?%?%= %{g}][%{B} %d/%m %{W}%c %{g}]'
vbell off
</span><span class="no">EOF

</span><span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/profile <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">

if [ </span><span class="nv">$USER</span><span class="sh"> == "root" ]; then
  PS1='</span><span class="se">\[\0</span><span class="sh">33[01;31m</span><span class="se">\]\h\[\0</span><span class="sh">33[01;34m</span><span class="se">\]</span><span class="sh"> </span><span class="se">\W</span><span class="sh"> </span><span class="se">\$\[\0</span><span class="sh">33[00m</span><span class="se">\]</span><span class="sh"> '
else
  PS1='</span><span class="se">\[\0</span><span class="sh">33[01;32m</span><span class="se">\]\u</span><span class="sh">@</span><span class="se">\h\[\0</span><span class="sh">33[01;34m</span><span class="se">\]</span><span class="sh"> </span><span class="se">\w</span><span class="sh"> </span><span class="se">\$\[\0</span><span class="sh">33[00m</span><span class="se">\]</span><span class="sh"> '
fi

[ -x /usr/bin/mc-wrapper.sh ] &amp;&amp; alias mc='. /usr/bin/mc-wrapper.sh --nomouse'

alias ssh='ssh -y -i </span><span class="nv">$HOME</span><span class="sh">/.ssh/id_rsa'
</span><span class="no">EOF

</span><span class="c"># shellcheck disable=SC2016 # Single quotes intentional - backticks expand on router, not locally</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'/^exit 0/i echo -e "Subject: Reboot `uci get system.@system[0].hostname`.`uci get dhcp.@dnsmasq[0].domain`\\n\\nOpenwrt rebooted: `date; uptime`\\n\\n`grep -B 50 \\"syslogd started\\" /etc/messages`" | sendmail petr.ruzicka@gmail.com'</span> /etc/rc.local

<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/HISTORY=3/HISTORY=30/'</span> /etc/sysstat/config

<span class="nb">mkdir</span> /home
useradd <span class="nt">--shell</span> /bin/ash <span class="nt">--password</span> <span class="s2">"</span><span class="si">$(</span>openssl passwd <span class="nt">-1</span> xxxx<span class="si">)</span><span class="s2">"</span> <span class="nt">--create-home</span> <span class="nt">--comment</span> <span class="s2">"Petr Ruzicka"</span> ruzickap
<span class="nb">mkdir</span> /home/ruzickap/.ssh
<span class="nb">cp</span> /etc/dropbear/authorized_keys /home/ruzickap/.ssh/
<span class="nb">chown</span> <span class="nt">-R</span> ruzickap:ruzickap /home/ruzickap/.ssh

<span class="nb">cat</span> <span class="o">&gt;</span> /etc/rsyncd.conf <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
max connections = 3
timeout = 300
dont compress = *

[data]
  comment = data
  path = /data
  read only = yes
  list = yes
</span><span class="no">EOF

</span><span class="nb">echo</span> <span class="s2">"vm.swappiness=5"</span> <span class="o">&gt;&gt;</span> /etc/sysctl.conf
</pre></table></code></div></div><p>Configure the DDNS - duckdns.org:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>uci <span class="nb">set </span>ddns.myddns.enabled<span class="o">=</span>1
uci <span class="nb">set </span>ddns.myddns.service_name<span class="o">=</span>duckdns.org
uci <span class="nb">set </span>ddns.myddns.domain<span class="o">=</span>gate
uci <span class="nb">set </span>ddns.myddns.username<span class="o">=</span>NA
uci <span class="nb">set </span>ddns.myddns.password<span class="o">=</span>xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
uci <span class="nb">set </span>ddns.myddns.ip_source<span class="o">=</span>network
uci <span class="nb">set </span>ddns.myddns.ip_network<span class="o">=</span>wan
uci <span class="nb">set </span>ddns.myddns.force_interval<span class="o">=</span>72
uci <span class="nb">set </span>ddns.myddns.force_unit<span class="o">=</span>hours
uci <span class="nb">set </span>ddns.myddns.check_interval<span class="o">=</span>10
uci <span class="nb">set </span>ddns.myddns.check_unit<span class="o">=</span>minutes
uci <span class="nb">set</span> <span class="s1">'ddns.myddns.update_url=http://www.duckdns.org/update?domains=[DOMAIN]&amp;token=[PASSWORD]&amp;ip=[IP]'</span>
</pre></table></code></div></div><p>Here are some details about thermometers:</p><ul><li><a href="https://web.archive.org/web/20130219033601/http://www.linuxfocus.org/English/November2003/article315.shtml">DS18S20 article</a><li><a href="https://martybugs.net/electronics/tempsensor/hardware.cgi">https://martybugs.net/electronics/tempsensor/hardware.cgi</a></ul><p>Configure thermometers:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>digitemp_DS9097 <span class="nt">-a</span> <span class="nt">-i</span> <span class="nt">-c</span> /etc/digitemp.conf <span class="nt">-s</span> /dev/ttyUSB0

<span class="nb">cat</span> <span class="o">&gt;</span> /etc/digitemp.script <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
#!/bin/sh
/usr/bin/digitemp_DS9097 -c/etc/digitemp.conf -a -n0 -d10 -q -s/dev/ttyUSB0 -o"PUTVAL </span><span class="si">$(</span>uci get system.@system[0].hostname<span class="si">)</span><span class="sh">/temp/temperature-%s interval=10 %N:%.2C"
</span><span class="no">EOF
</span><span class="nb">chmod </span>a+x /etc/digitemp.script
</pre></table></code></div></div><p>Replace uhttpd by lighttpd, configure SSL and mod_proxy for <a href="https://transmissionbt.com/">Transmission</a>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre>/etc/init.d/uhttpd disable
/etc/init.d/uhttpd stop
/etc/init.d/lighttpd <span class="nb">enable

mkdir</span> <span class="nt">-p</span> /www/myadmin/luci
<span class="nb">mv</span> /www/index.html /www/myadmin/luci/
wget <span class="nt">--no-check-certificate</span> https://raw.github.com/ruzickap/medlanky.xvx.cz/gh-pages/index.html <span class="nt">-O</span> - | <span class="nb">sed</span> <span class="s1">'s@facebook.com/medlanky@xvx.cz@g;s/UA-6594742-7/UA-6594742-8/'</span> <span class="o">&gt;</span> /www/index.html

uci add firewall rule
uci <span class="nb">set </span>firewall.@rule[-1].name<span class="o">=</span>https
uci <span class="nb">set </span>firewall.@rule[-1].src<span class="o">=</span>wan
uci <span class="nb">set </span>firewall.@rule[-1].target<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@rule[-1].proto<span class="o">=</span>tcp
uci <span class="nb">set </span>firewall.@rule[-1].dest_port<span class="o">=</span>443

uci add firewall rule
uci <span class="nb">set </span>firewall.@rule[-1].name<span class="o">=</span>http
uci <span class="nb">set </span>firewall.@rule[-1].src<span class="o">=</span>wan
uci <span class="nb">set </span>firewall.@rule[-1].target<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@rule[-1].proto<span class="o">=</span>tcp
uci <span class="nb">set </span>firewall.@rule[-1].dest_port<span class="o">=</span>80

<span class="nb">mkdir</span> <span class="nt">-p</span> /etc/lighttpd/ssl/xvx.cz
<span class="nb">chmod </span>0600 /etc/lighttpd/ssl/xvx.cz

<span class="nv">SUBJ</span><span class="o">=</span><span class="s2">"
C=CZ
ST=Czech Republic
O=XvX, Inc.
localityName=Brno
commonName=xvx.cz Certificate Authority
"</span>

openssl req <span class="nt">-new</span> <span class="nt">-x509</span> <span class="nt">-subj</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$SUBJ</span><span class="s2">"</span> | <span class="nb">tr</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="s2">"/"</span><span class="si">)</span><span class="s2">"</span> <span class="nt">-keyout</span> /etc/lighttpd/ssl/xvx.cz/server.pem <span class="nt">-out</span> /etc/lighttpd/ssl/xvx.cz/server.pem <span class="nt">-days</span> 3650 <span class="nt">-nodes</span>

<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/lighttpd/lighttpd.conf <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">

server.port = 80

</span><span class="nv">$SERVER</span><span class="sh">["socket"] == ":443" {
  ssl.engine                  = "enable"
  ssl.pemfile                 = "/etc/lighttpd/ssl/xvx.cz/server.pem"
}

server.modules = (
 "mod_proxy",
 "mod_cgi",
)

cgi.assign = ( "luci" =&gt; "/usr/bin/lua" )

server.errorlog-use-syslog = "enable"
server.dir-listing = "enable"

</span><span class="nv">$HTTP</span><span class="sh">["url"] =~ "^/myadmin/transmission*" {
  # Use proxy for redirection to Transmission's own web interface
  proxy.server = ( "" =&gt;
    ( (
      "host" =&gt; "127.0.0.1",
      "port" =&gt; 9091
    ) )
  )
}
</span><span class="no">EOF
</span></pre></table></code></div></div><p>Make outgoing emails to reach the SMTP server:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/^mailhub=.*/mailhub=mail.upcmail.cz/;s/^rewriteDomain=.*/rewriteDomain=xvx.cz/'</span> /etc/ssmtp/ssmtp.conf
</pre></table></code></div></div><p>Configure TFTPboot and dnsmasq script:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> /tftpboot

wget <span class="nt">-P</span> /tftpboot http://static.netboot.me/gpxe/netbootme.kpxe
uci <span class="nb">set </span>dhcp.@dnsmasq[0].enable_tftp<span class="o">=</span>1
uci <span class="nb">set </span>dhcp.@dnsmasq[0].tftp_root<span class="o">=</span>/tftpboot
uci <span class="nb">set </span>dhcp.@dnsmasq[0].dhcp_boot<span class="o">=</span>netbootme.kpxe

<span class="nb">echo</span> <span class="s2">"dhcp-script=/etc/dnsmasq-script.sh"</span> <span class="o">&gt;&gt;</span> /etc/dnsmasq.conf

<span class="nb">cat</span> <span class="o">&gt;</span> /etc/dnsmasq-script.sh <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
#!/bin/sh

if [ "</span><span class="nv">$1</span><span class="sh">" == "add" ] &amp;&amp; ! grep -iq "</span><span class="nv">$2</span><span class="sh">" /etc/config/dhcp; then
  echo -e "Subject: New MAC on </span><span class="si">$(</span>uci get system.@system[0].hostname<span class="si">)</span><span class="sh">.</span><span class="si">$(</span>uci get dhcp.@dnsmasq[0].domain<span class="si">)</span><span class="se">\\</span><span class="sh">n</span><span class="se">\\</span><span class="sh">n</span><span class="si">$(</span>/bin/date +<span class="s2">"%F %T"</span><span class="si">)</span><span class="sh"> </span><span class="nv">$*</span><span class="sh">" | sendmail petr.ruzicka@gmail.com
fi
</span><span class="no">EOF

</span><span class="nb">chmod </span>a+x /etc/dnsmasq-script.sh
</pre></table></code></div></div><p>Watchcat is used to monitor network connection “pingability” to <code class="language-plaintext highlighter-rouge">8.8.8.8</code> otherwise the router is rebooted.</p><p>Configure QoS:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>uci <span class="nb">set </span>qos.wan.upload<span class="o">=</span>500    <span class="c"># Upload speed in kBits/s</span>
uci <span class="nb">set </span>qos.wan.download<span class="o">=</span>5000 <span class="c"># Download speed in kBits/s</span>
uci <span class="nb">set </span>qos.wan.enabled<span class="o">=</span>1
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s/'22,53'/'22,2222,53'/"</span> /etc/config/qos
/etc/init.d/qos <span class="nb">enable</span>
</pre></table></code></div></div><p>Configure statistics (collectd):</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/collectd/conf.d

uci <span class="nb">set </span>luci_statistics.collectd_rrdtool.DataDir<span class="o">=</span>/etc/collectd
uci <span class="nb">set </span>luci_statistics.collectd_ping.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.collectd_ping.Hosts<span class="o">=</span>www.google.com
uci <span class="nb">set </span>luci_statistics.collectd_df.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.collectd_df.Devices<span class="o">=</span>/dev/sda1
uci <span class="nb">set </span>luci_statistics.collectd_df.MountPoints<span class="o">=</span>/overlay
uci <span class="nb">set </span>luci_statistics.collectd_df.FSTypes<span class="o">=</span>ext3
uci <span class="nb">set </span>luci_statistics.collectd_disk.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.collectd_disk.Disks<span class="o">=</span>sda
uci <span class="nb">set </span>luci_statistics.collectd_dns.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.collectd_dns.Interfaces<span class="o">=</span>any
uci <span class="nb">set </span>luci_statistics.collectd_interface.Interfaces<span class="o">=</span><span class="s2">"eth0.2 wlan0 wlan0-1 eth0.1"</span>
uci <span class="nb">set </span>luci_statistics.collectd_iptables.enable<span class="o">=</span>0
uci <span class="nb">set </span>luci_statistics.collectd_irq.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.collectd_processes.Processes<span class="o">=</span><span class="s2">"lighttpd collectd transmission-daemon"</span>
uci <span class="nb">set </span>luci_statistics.collectd_tcpconns.LocalPorts<span class="o">=</span><span class="s2">"2222 443 80"</span>
uci <span class="nb">set </span>luci_statistics.collectd_olsrd.enable<span class="o">=</span>0
uci <span class="nb">set </span>luci_statistics.collectd_rrdtool.CacheTimeout<span class="o">=</span>120
uci <span class="nb">set </span>luci_statistics.collectd_rrdtool.CacheFlush<span class="o">=</span>900

uci <span class="nb">set </span>luci_statistics.collectd_exec.enable<span class="o">=</span>1
uci commit
uci add luci_statistics collectd_exec_input
uci <span class="nb">set </span>luci_statistics.@collectd_exec_input[-1].cmdline<span class="o">=</span><span class="s2">"/etc/digitemp.script"</span>

<span class="nb">cat</span> <span class="o">&gt;</span> /etc/collectd/conf.d/my_collectd.conf
LogLevel <span class="s2">"info"</span>

EOF
</pre></table></code></div></div><p>Configure vnstat - software for monitoring / graphing network throughput:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> /etc/vnstat
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s@^\(DatabaseDir\).*@\1 "/overlay/etc/vnstat"@'</span> /etc/vnstat.conf
vnstat <span class="nt">-u</span> <span class="nt">-i</span> eth0.2
vnstat <span class="nt">-u</span> <span class="nt">-i</span> wlan0
vnstat <span class="nt">-u</span> <span class="nt">-i</span> wlan0-1
vnstat <span class="nt">-u</span> <span class="nt">-i</span> eth0.1

<span class="nb">echo</span> <span class="s2">"*/5 * * * * vnstat -u"</span> <span class="o">&gt;&gt;</span> /etc/crontabs/root

<span class="nb">cat</span> <span class="o">&gt;</span> /etc/graphs-vnstat.sh <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
#!/bin/sh
# vnstati image generation script.
# Source:  https://code.google.com/p/x-wrt/source/browse/package/webif/files/www/cgi-bin/webif/graphs-vnstat.sh

WWW_D=/www/myadmin/vnstat # output images to here
LIB_D=</span><span class="si">$(</span><span class="nb">awk</span> <span class="nt">-F</span> <span class="se">\"</span> <span class="s1">'/^DatabaseDir/ { print $2 }'</span> /etc/vnstat.conf<span class="si">)</span><span class="sh"> # db location
BIN=/usr/bin/vnstati  # which vnstati

outputs="s h d t m"   # what images to generate

# Sanity checks
[ -d "</span><span class="nv">$WWW_D</span><span class="sh">" ] || mkdir -p "</span><span class="nv">$WWW_D</span><span class="sh">" # make the folder if it doesn't exist.

# End of config changes
interfaces="</span><span class="si">$(</span><span class="nb">ls</span> <span class="nt">-1</span> <span class="nv">$LIB_D</span><span class="si">)</span><span class="sh">"

if [ -z "</span><span class="nv">$interfaces</span><span class="sh">" ]; then
    echo "No database found, nothing to do."
    echo "A new database can be created with the following command: "
    echo "    vnstat -u -i eth0"
    exit 0
else
    for interface in </span><span class="nv">$interfaces</span><span class="sh">; do
        for output in </span><span class="nv">$outputs</span><span class="sh">; do
            </span><span class="nv">$BIN</span><span class="sh"> -</span><span class="k">${</span><span class="nv">output</span><span class="k">}</span><span class="sh"> -i </span><span class="nv">$interface</span><span class="sh"> -o </span><span class="nv">$WWW_D</span><span class="sh">/vnstat_</span><span class="k">${</span><span class="nv">interface</span><span class="k">}</span><span class="sh">_</span><span class="k">${</span><span class="nv">output</span><span class="k">}</span><span class="sh">.png
        done
    done
fi

exit 1
</span><span class="no">EOF

</span><span class="nb">chmod </span>a+x /etc/graphs-vnstat.sh
<span class="nb">echo</span> <span class="s2">"0 2 * * * /etc/graphs-vnstat.sh"</span> <span class="o">&gt;&gt;</span> /etc/crontabs/root

<span class="nb">cat</span> <span class="o">&gt;</span> /www/myadmin/vnstat/index.html <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
&lt;META HTTP-EQUIV="refresh" CONTENT="300"&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Traffic of OpenWRT interfaces&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
</span><span class="no">EOF

</span><span class="k">for </span>IFCE <span class="k">in</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">awk</span> <span class="nt">-F</span> <span class="se">\"</span> <span class="s1">'/^DatabaseDir/ { print $2 }'</span> /etc/vnstat.conf<span class="si">)</span><span class="s2">"</span>/<span class="k">*</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">cat</span> <span class="o">&gt;&gt;</span> /www/myadmin/vnstat/index.html <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
    &lt;h2&gt;Traffic of Interface </span><span class="nv">$IFCE</span><span class="sh">&lt;/h2&gt;
    &lt;table&gt;
        &lt;tbody&gt;
            &lt;tr&gt;
                &lt;td&gt;
                    &lt;img src="vnstat_</span><span class="k">${</span><span class="nv">IFCE</span><span class="k">}</span><span class="sh">_s.png" alt="</span><span class="nv">$IFCE</span><span class="sh"> Summary" /&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;img src="vnstat_</span><span class="k">${</span><span class="nv">IFCE</span><span class="k">}</span><span class="sh">_h.png" alt="</span><span class="nv">$IFCE</span><span class="sh"> Hourly" /&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td valign="top"&gt;
                    &lt;img src="vnstat_</span><span class="k">${</span><span class="nv">IFCE</span><span class="k">}</span><span class="sh">_d.png" alt="</span><span class="nv">$IFCE</span><span class="sh"> Daily" /&gt;
                &lt;/td&gt;
                &lt;td valign="top"&gt;
                    &lt;img src="vnstat_</span><span class="k">${</span><span class="nv">IFCE</span><span class="k">}</span><span class="sh">_t.png" alt="</span><span class="nv">$IFCE</span><span class="sh"> Top 10" /&gt;
                    &lt;br /&gt;
                    &lt;img src="vnstat_</span><span class="k">${</span><span class="nv">IFCE</span><span class="k">}</span><span class="sh">_m.png" alt="</span><span class="nv">$IFCE</span><span class="sh"> Monthly" /&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;
</span><span class="no">EOF
</span><span class="k">done

</span><span class="nb">cat</span> <span class="o">&gt;&gt;</span> /www/myadmin/vnstat/index.html <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
  &lt;/body&gt;
&lt;/html&gt;
</span><span class="no">EOF
</span></pre></table></code></div></div><p>Configure the nodogsplash for <code class="language-plaintext highlighter-rouge">wifi_open</code> (guests):</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="nb">mv</span> /etc/nodogsplash/nodogsplash.conf /etc/nodogsplash/nodogsplash.conf-orig

<span class="nb">cat</span> <span class="o">&gt;</span> /etc/nodogsplash/nodogsplash.conf <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
GatewayInterface br-wifi_open

FirewallRuleSet authenticated-users {
    FirewallRule block to 192.168.0.0/16
    FirewallRule block to 10.0.0.0/8
    FirewallRule allow tcp port 53
    FirewallRule allow udp port 53
    FirewallRule allow tcp port 80
    FirewallRule allow tcp port 443
    FirewallRule allow tcp port 22
    FirewallRule allow icmp
}

FirewallRuleSet preauthenticated-users {
    FirewallRule allow tcp port 53
    FirewallRule allow udp port 53
}

FirewallRuleSet users-to-router {
    FirewallRule allow udp port 53
    FirewallRule allow tcp port 53
    FirewallRule allow udp port 67
    FirewallRule allow icmp
}

GatewayName medlanky.xvx.cz
RedirectURL http://medlanky-hotspot.xvx.cz/
ClientForceTimeout 120
</span><span class="no">EOF

</span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s@#OPTIONS="-s -d 5"@OPTIONS="-s -d 5"@'</span> /etc/init.d/nodogsplash

wget <span class="s2">"http://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Brno-Medl%C3%A1nky_znak.svg/90px-Brno-Medl%C3%A1nky_znak.svg.png"</span> <span class="nt">-O</span> /etc/nodogsplash/htdocs/images/90px-Brno-Medlanky_znak.svg.png

<span class="nb">cp</span> /etc/nodogsplash/htdocs/splash.html /etc/nodogsplash/htdocs/splash.html-orig
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s@wifidog.png.*@90px-Brno-Medlanky_znak.svg.png"@;/align=center height="120"&gt;/a\
\ \ &lt;h2&gt;For Internet access - click the sign.&lt;/h2&gt; &lt;h2&gt;Pro pristup na Internet klikni na znak.&lt;/h2&gt;\
'</span> /etc/nodogsplash/htdocs/splash.html

/etc/init.d/nodogsplash <span class="nb">enable</span>
</pre></table></code></div></div><p>Transmission bittorrent client configuration:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /data/torrents/torrents-completed /data/torrents/torrents-incomplete /data/torrents/torrents /data/torrents/config

<span class="nb">ln</span> <span class="nt">-s</span> /data/torrents/torrents /home/ruzickap/torrents
<span class="nb">chown</span> <span class="nt">-R</span> ruzickap:ruzickap /data/torrents/torrents

uci <span class="nb">set </span>transmission.@transmission[-1].enabled<span class="o">=</span>1
uci <span class="nb">set </span>transmission.@transmission[-1].config_dir<span class="o">=</span>/data/torrents/config
uci <span class="nb">set </span>transmission.@transmission[-1].download_dir<span class="o">=</span>/data/torrents/torrents-completed
uci <span class="nb">set </span>transmission.@transmission[-1].incomplete_dir_enabled<span class="o">=</span><span class="nb">true
</span>uci <span class="nb">set </span>transmission.@transmission[-1].incomplete_dir<span class="o">=</span>/data/torrents/torrents-incomplete
uci <span class="nb">set </span>transmission.@transmission[-1].blocklist_enabled<span class="o">=</span>1
uci <span class="nb">set</span> <span class="s2">"transmission.@transmission[-1].blocklist_url=&lt;http://list.iblocklist.com/?list=bt_level1&amp;fileformat=p2p&amp;archiveformat=zip&gt;"</span>
uci <span class="nb">set </span>transmission.@transmission[-1].speed_limit_down_enabled<span class="o">=</span><span class="nb">true
</span>uci <span class="nb">set </span>transmission.@transmission[-1].speed_limit_up_enabled<span class="o">=</span><span class="nb">true
</span>uci <span class="nb">set </span>transmission.@transmission[-1].speed_limit_down<span class="o">=</span>300
uci <span class="nb">set </span>transmission.@transmission[-1].speed_limit_up<span class="o">=</span>5
uci <span class="nb">set </span>transmission.@transmission[-1].alt_speed_enabled<span class="o">=</span><span class="nb">true
</span>uci <span class="nb">set </span>transmission.@transmission[-1].alt_speed_down<span class="o">=</span>99999
uci <span class="nb">set </span>transmission.@transmission[-1].alt_speed_up<span class="o">=</span>10
uci <span class="nb">set </span>transmission.@transmission[-1].alt_speed_time_enabled<span class="o">=</span><span class="nb">true
</span>uci <span class="nb">set </span>transmission.@transmission[-1].alt_speed_time_day<span class="o">=</span>127
uci <span class="nb">set </span>transmission.@transmission[-1].alt_speed_time_begin<span class="o">=</span>60
uci <span class="nb">set </span>transmission.@transmission[-1].alt_speed_time_end<span class="o">=</span>420
uci <span class="nb">set </span>transmission.@transmission[-1].rpc_whitelist_enabled<span class="o">=</span><span class="nb">false
</span>uci <span class="nb">set </span>transmission.@transmission[-1].start_added_torrents<span class="o">=</span><span class="nb">true
</span>uci <span class="nb">set </span>transmission.@transmission[-1].script_torrent_done_enabled<span class="o">=</span><span class="nb">true
</span>uci <span class="nb">set </span>transmission.@transmission[-1].script_torrent_done_filename<span class="o">=</span>/etc/torrent-done.sh
uci <span class="nb">set </span>transmission.@transmission[-1].watch_dir_enabled<span class="o">=</span><span class="nb">true
</span>uci <span class="nb">set </span>transmission.@transmission[-1].watch_dir<span class="o">=</span>/data/torrents/torrents/
uci <span class="nb">set </span>transmission.@transmission[-1].rpc_url<span class="o">=</span>/myadmin/transmission/
uci <span class="nb">set </span>transmission.@transmission[-1].rpc_authentication_required<span class="o">=</span><span class="nb">true
</span>uci <span class="nb">set </span>transmission.@transmission[-1].rpc_username<span class="o">=</span>ruzickap
uci <span class="nb">set </span>transmission.@transmission[-1].rpc_password<span class="o">=</span>xxxx
uci <span class="nb">set </span>transmission.@transmission[-1].ratio_limit<span class="o">=</span>0
uci <span class="nb">set </span>transmission.@transmission[-1].ratio_limit_enabled<span class="o">=</span><span class="nb">true
</span>uci <span class="nb">set </span>transmission.@transmission[-1].upload_slots_per_torrent<span class="o">=</span>5
uci <span class="nb">set </span>transmission.@transmission[-1].trash_original_torrent_files<span class="o">=</span><span class="nb">true
</span>uci <span class="nb">set </span>transmission.@transmission[-1].download_queue_size<span class="o">=</span>1

uci add firewall rule
uci <span class="nb">set </span>firewall.@rule[-1].name<span class="o">=</span>transmission
uci <span class="nb">set </span>firewall.@rule[-1].src<span class="o">=</span>wan
uci <span class="nb">set </span>firewall.@rule[-1].target<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@rule[-1].proto<span class="o">=</span>tcpudp
uci <span class="nb">set </span>firewall.@rule[-1].dest_port<span class="o">=</span>51413

/etc/init.d/transmission <span class="nb">enable</span>
/etc/init.d/miniupnpd <span class="nb">enable

cat</span> <span class="o">&gt;</span> /etc/torrent-done.sh <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">

## !/bin/sh

echo -e "Subject: </span><span class="nv">$TR_TORRENT_NAME</span><span class="sh"> finished.</span><span class="se">\n\n</span><span class="sh">Transmission finished downloading </span><span class="se">\"</span><span class="nv">$TR_TORRENT_NAME</span><span class="se">\"</span><span class="sh"> on </span><span class="nv">$TR_TIME_LOCALTIME</span><span class="sh">" | /usr/sbin/ssmtp petr.ruzicka@gmail.com
</span><span class="no">EOF
</span><span class="nb">chmod </span>a+x /etc/torrent-done.sh

uci commit
reboot
</pre></table></code></div></div><p>I’m sure you need to customize most of the thing mentioned above, but these notes can still help you.</p><p>Enjoy :-)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/openwrt/">OpenWrt</a>, <a href="/categories/networking/">Networking</a>, <a href="/categories/linux-xvx-cz/">linux.xvx.cz</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/tp-link/" class="post-tag no-text-decoration" >tp-link</a> <a href="/tags/router/" class="post-tag no-text-decoration" >router</a> <a href="/tags/wifi/" class="post-tag no-text-decoration" >wifi</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=TP-Link%20TL-WR1043ND%20and%20OpenWrt%2012.09%20with%20two%20SSIDs%20(MultiSSID)%20-%20private%20and%20guest%20-%20Petr's%20Blog&url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Ftp-link-tl-wr1043nd-and-openwrt-1209-with-two-ssids-multissid-private-and-guest%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=TP-Link%20TL-WR1043ND%20and%20OpenWrt%2012.09%20with%20two%20SSIDs%20(MultiSSID)%20-%20private%20and%20guest%20-%20Petr's%20Blog&u=https%3A%2F%2Fruzickap.github.io%2Fposts%2Ftp-link-tl-wr1043nd-and-openwrt-1209-with-two-ssids-multissid-private-and-guest%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Ftp-link-tl-wr1043nd-and-openwrt-1209-with-two-ssids-multissid-private-and-guest%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <script defer type="module" src="https://cdn.jsdelivr.net/npm/@justinribeiro/share-to-mastodon/+esm"></script> <button class="btn text-start" data-bs-toggle="tooltip" data-bs-placement="top" title="Mastodon" aria-label="Mastodon"> <share-to-mastodon class="share-mastodon" message="TP-Link%20TL-WR1043ND%20and%20OpenWrt%2012.09%20with%20two%20SSIDs%20(MultiSSID)%20-%20private%20and%20guest%20-%20Petr's%20Blog" url="https%3A%2F%2Fruzickap.github.io%2Fposts%2Ftp-link-tl-wr1043nd-and-openwrt-1209-with-two-ssids-multissid-private-and-guest%2F"customInstanceList="[{&quot;label&quot;:&quot;mastodon.social&quot;,&quot;link&quot;:&quot;https://mastodon.social/&quot;},{&quot;label&quot;:&quot;mastodon.online&quot;,&quot;link&quot;:&quot;https://mastodon.online/&quot;},{&quot;label&quot;:&quot;fosstodon.org&quot;,&quot;link&quot;:&quot;https://fosstodon.org/&quot;},{&quot;label&quot;:&quot;photog.social&quot;,&quot;link&quot;:&quot;https://photog.social/&quot;}]" > <i class="fa-fw fa-brands fa-mastodon"></i> </share-to-mastodon> </button> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/installtion-f5-bigip-virtual-edition-to-rhel7/">Installation F5 BIGIP Virtual Edition to RHEL7</a><li class="text-truncate lh-lg"> <a href="/posts/detect-a-hacker-attacks-eks-vm/">Detect the hacker attacks on Amazon EKS and EC2 instances</a><li class="text-truncate lh-lg"> <a href="/posts/secure-cheap-amazon-eks-auto/">Build secure and cheap Amazon EKS Auto Mode</a><li class="text-truncate lh-lg"> <a href="/posts/eks-auto-cert-manager-velero/">Amazon EKS Auto Mode with cert-manager and Velero</a><li class="text-truncate lh-lg"> <a href="/posts/mcp-servers-k8s/">MCP Servers running on Kubernetes</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon-eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/bash/">bash</a> <a class="post-tag btn btn-outline-primary" href="/tags/pxe/">pxe</a> <a class="post-tag btn btn-outline-primary" href="/tags/wifi/">wifi</a> <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">prometheus</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/turris-openwrt-and-guest-access/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1399500000" data-df="ll" > May 8, 2014 </time><h4 class="pt-0 my-2">Turris - OpenWRT and guest access</h4><div class="text-muted"><p>Turris - OpenWRT and guest access</p></div></div></a></article><article class="col"> <a href="/posts/turris-openwrt-configuration/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1397599200" data-df="ll" > Apr 16, 2014 </time><h4 class="pt-0 my-2">Turris - OpenWrt configuration</h4><div class="text-muted"><p>Turris - OpenWrt configuration</p></div></div></a></article><article class="col"> <a href="/posts/turris-the-open-enterprise-wi-fi-router/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1396994400" data-df="ll" > Apr 9, 2014 </time><h4 class="pt-0 my-2">Turris - The Open Enterprise Wi-Fi Router</h4><div class="text-muted"><p>Turris - The Open Enterprise Wi-Fi Router</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/tl-wr1043nd-wifi-router-with-camera-and-theromometers/" class="btn btn-outline-primary" aria-label="Older" ><p>TL-WR1043ND wifi router with camera and thermometers</p></a> <a href="/posts/how-to-get-hp-enclosure-c7000-information-without-ssh/" class="btn btn-outline-primary" aria-label="Newer" ><p>How to get HP enclosure c7000 information without ssh</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2026</time> <a href="https://twitter.com/Ruzicka_Petr">Petr Ruzicka</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon-eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/bash/">bash</a> <a class="post-tag btn btn-outline-primary" href="/tags/pxe/">pxe</a> <a class="post-tag btn btn-outline-primary" href="/tags/wifi/">wifi</a> <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">prometheus</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ruzickap/ruzickap.github.io', 'data-repo-id': 'R_kgDOGkp4nQ', 'data-category': 'General', 'data-category-id': 'DIC_kwDOGkp4nc4CSdu1', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
