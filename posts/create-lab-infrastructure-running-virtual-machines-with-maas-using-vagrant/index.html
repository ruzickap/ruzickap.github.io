<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Create lab infrastructure running Virtual machines with MAAS using Vagrant" /><meta name="author" content="Petr Ruzicka" /><meta property="og:locale" content="en" /><meta name="description" content="Create lab infrastructure running Virtual machines with MAAS using Vagrant" /><meta property="og:description" content="Create lab infrastructure running Virtual machines with MAAS using Vagrant" /><link rel="canonical" href="https://ruzickap.github.io/posts/create-lab-infrastructure-running-virtual-machines-with-maas-using-vagrant/" /><meta property="og:url" content="https://ruzickap.github.io/posts/create-lab-infrastructure-running-virtual-machines-with-maas-using-vagrant/" /><meta property="og:site_name" content="Petr’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-02-20T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Create lab infrastructure running Virtual machines with MAAS using Vagrant" /><meta name="twitter:site" content="@Ruzicka_Petr" /><meta name="twitter:creator" content="@Ruzicka_Petr" /><meta name="google-site-verification" content="4ugGShJoiB9veoPwFcMsMjzk-1BYbi5ozcSnovkBWtA" /><meta name="msvalidate.01" content="592AB158E3F9EF887F8DC8E69A2FF754" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Petr Ruzicka","url":"https://petr.ruzicka.dev"},"dateModified":"2026-01-17T19:48:44+01:00","datePublished":"2018-02-20T00:00:00+01:00","description":"Create lab infrastructure running Virtual machines with MAAS using Vagrant","headline":"Create lab infrastructure running Virtual machines with MAAS using Vagrant","mainEntityOfPage":{"@type":"WebPage","@id":"https://ruzickap.github.io/posts/create-lab-infrastructure-running-virtual-machines-with-maas-using-vagrant/"},"url":"https://ruzickap.github.io/posts/create-lab-infrastructure-running-virtual-machines-with-maas-using-vagrant/"}</script><title>Create lab infrastructure running Virtual machines with MAAS using Vagrant | Petr's Blog</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> document.addEventListener('DOMContentLoaded', () => { const pv = document.getElementById('pageviews'); if (pv !== null) { const uri = location.pathname.replace(/\/$/, ''); const url = `https://ruzickap-github-io.goatcounter.com/counter/${encodeURIComponent(uri)}.json`; fetch(url) .then((response) => response.json()) .then((data) => { const count = data.count.replace(/\D/g, ''); pv.innerText = new Intl.NumberFormat().format(count); }) .catch((error) => { pv.innerText = '1'; }); } }); </script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-64WRCWDZM8"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-64WRCWDZM8'); }); </script> <script async src="https://gc.zgo.at/count.js" data-goatcounter="https://ruzickap-github-io.goatcounter.com/count" ></script> <script defer src="https://cloud.umami.is/script.js" data-website-id="380ea41a-7d5f-4423-8e13-03151bde195f" ></script> <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "ad8c64404e1e41dba184019564cf11bb"}' ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://0.gravatar.com/avatar/5484c0fd9f98e2ffd9212b158931bf4b?s=200" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Petr's Blog</a><p class="site-subtitle fst-italic mb-0">DevOps • GitOps • K8s</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-project-diagram"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/ruzickap" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['petr.ruzicka','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://petr.ruzicka.dev" aria-label="homepage" target="_blank" rel="noopener noreferrer" > <i class="fas fa-home"></i> </a> <a href="https://mastodon.social/@petr_ruzicka" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Create lab infrastructure running Virtual machines with MAAS using Vagrant</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="false"><header><h1 data-toc-skip>Create lab infrastructure running Virtual machines with MAAS using Vagrant</h1><p class="post-desc fw-light mb-4">Create lab infrastructure running Virtual machines with MAAS using Vagrant</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1519081200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 20, 2018 </time> </span> <span> Updated <time data-ts="1768675724" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 17, 2026 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://petr.ruzicka.dev">Petr Ruzicka</a> </em> </span><div> <span> <em id="pageviews"> <i class="fas fa-spinner fa-spin small"></i> </em> views </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1582 words" > <em>8 min</em> read</span></div></div></div></header><div class="content"><blockquote class="prompt-info"><p>Original post from <a href="https://linux.xvx.cz/2018/02/create-lab-infrastructure-running.html">linux.xvx.cz</a></p></blockquote><p>Sometimes it’s handy to replicate the physical environment on a single server to do some testing.</p><p>In my case I replicated the environment containing 3 VMs where <a href="https://www.ubuntu.com/server/maas">MAAS</a> was installed on the first VM (<code class="language-plaintext highlighter-rouge">kvm01</code>) and the other two VMs (<code class="language-plaintext highlighter-rouge">kvm02</code>, <code class="language-plaintext highlighter-rouge">kvm03</code>) were provisioned by MAAS. I also defined a few networks with IP ranges: <code class="language-plaintext highlighter-rouge">deploy_network</code> <code class="language-plaintext highlighter-rouge">192.168.25.0/24</code>, <code class="language-plaintext highlighter-rouge">control_network</code> <code class="language-plaintext highlighter-rouge">192.168.26.0/24</code>, <code class="language-plaintext highlighter-rouge">tenant_network</code> <code class="language-plaintext highlighter-rouge">192.168.27.0/24</code>.</p><p>Here is the network diagram of the lab:</p><p><a href="/assets/img/posts/2018/2018-02-20-create-lab-infrastructure-running-virtual-machines-with-maas-using-vagrant/network_diagram.avif" class="popup img-link shimmer"><img src="/assets/img/posts/2018/2018-02-20-create-lab-infrastructure-running-virtual-machines-with-maas-using-vagrant/network_diagram.avif" alt="MAAS lab network diagram with three VMs" loading="lazy"></a></p><p>You can see the commands I used and descriptive video…</p><p>It’s better to see the video with lab description:</p><iframe class="embed-video" loading="lazy" src="https://www.youtube.com/embed/ms9lx_QUmCw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><p>Here are the commands I used:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
</pre><td class="rouge-code"><pre><span class="c"># Install Vagrant and virsh command</span>
dnf <span class="nb">install</span> <span class="nt">-y</span> libvirt-client vagrant-hostmanager vagrant-libvirt

<span class="c"># Allow to manage VMs via libvirt remotely (using TCP connection)</span>
<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/libvirt/libvirtd.conf <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
listen_tls = 0
listen_tcp = 1
listen_addr = "0.0.0.0"
auth_tcp = "none"
</span><span class="no">EOF

</span><span class="nb">echo</span> <span class="s1">'LIBVIRTD_ARGS="--listen --config /etc/libvirt/libvirtd.conf"'</span> <span class="o">&gt;&gt;</span> /etc/sysconfig/libvirtd
service libvirtd restart

<span class="c"># Generate ssh key used for accessing the VMs</span>
ssh-keygen <span class="nt">-P</span> <span class="s2">""</span> <span class="nt">-f</span> /root/.ssh/id_rsa <span class="nt">-C</span> <span class="s2">"admin@example.com"</span>

<span class="c"># Check the VMs</span>
<span class="nv">VIRSH_VMS</span><span class="o">=</span><span class="si">$(</span>virsh list | <span class="nb">awk</span> <span class="s1">'/_kvm/ { print $2 }'</span><span class="si">)</span>
<span class="k">for </span>VIRSH_VM <span class="k">in</span> <span class="nv">$VIRSH_VMS</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="s2">"*** </span><span class="nv">$VIRSH_VM</span><span class="s2">"</span>
  virsh dumpxml <span class="s2">"</span><span class="nv">$VIRSH_VM</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="s1">'mac address'</span> | <span class="nb">sort
</span><span class="k">done</span>

<span class="c"># Check the subnets</span>
virsh net-list <span class="nt">--all</span> | <span class="nb">grep </span>network
<span class="nv">VIRSH_NETWORKS</span><span class="o">=</span><span class="si">$(</span>virsh net-list | <span class="nb">awk</span> <span class="s1">'/network|vagrant/ { print $1 }'</span><span class="si">)</span>
<span class="k">for </span>VIRSH_NETWORK <span class="k">in</span> <span class="nv">$VIRSH_NETWORKS</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="s2">"*** </span><span class="nv">$VIRSH_NETWORK</span><span class="s2">"</span>
  virsh net-dumpxml <span class="s2">"</span><span class="nv">$VIRSH_NETWORK</span><span class="s2">"</span>
<span class="k">done</span>

<span class="c"># Create Vagrantfile</span>
<span class="nb">mkdir</span> /var/tmp/test
<span class="nb">cat</span> <span class="o">&gt;</span> /var/tmp/test/Vagrantfile <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">

box_image = "peru/my_ubuntu-16.04-server-amd64"
node_count = 3
ssh_pub_key = File.readlines("#{Dir.home}/.ssh/id_rsa.pub").first.strip

Vagrant.configure(2) do |config|
  config.hostmanager.enabled = true
  config.hostmanager.manage_host = true
  config.hostmanager.manage_guest = false
  config.vm.synced_folder ".", "/vagrant", :disabled =&gt; true

  config.vm.provider :libvirt do |domain|
    domain.cpus = 2
    domain.cpu_mode = "host-passthrough"
    domain.memory = 1536
    domain.machine_virtual_size = 150
    domain.disk_bus = "virtio"
    domain.nic_model_type = "virtio"
    domain.video_type = "qxl"
    domain.graphics_type = "spice"
    domain.management_network_address = "192.168.100.0/24"
  end

  (1..node_count).each do |i|
    config.vm.define "kvm0#{i}" do |config|
      config.vm.hostname = "kvm0#{i}"
      config.hostmanager.ignore_private_ip = true

      if i == 1
        config.vm.box = box_image
        config.vm.network :forwarded_port, guest: 80, host: 80, host_ip: "*"
      end

      config.vm.provider :libvirt do |domain|
        domain.storage :file, :size =&gt; '100G', :type =&gt; 'qcow2'
        if i == 1
          domain.memory = 4096
        else
          boot_network = {'network' =&gt; 'deploy_network'}
          domain.boot boot_network
          #domain.loader = "/usr/share/edk2/ovmf/OVMF_CODE.fd"
        end
      end

      config.vm.network :private_network, ip: "192.168.25.#{i+10}", auto_config: false, libvirt__network_name: "deploy_network", libvirt__dhcp_enabled: false, libvirt__forward_mode: "nat", :mac =&gt; "52:54:00:00:25:#{i+10}"

      config.vm.network :private_network, ip: "192.168.26.#{i+10}", auto_config: false, libvirt__network_name: "control_network", libvirt__dhcp_enabled: false, libvirt__forward_mode: "nat", :mac =&gt; "52:54:00:00:26:#{i+10}"
      config.vm.network :private_network, ip: "192.168.26.#{i+20}", auto_config: false, libvirt__network_name: "control_network", libvirt__dhcp_enabled: false, libvirt__forward_mode: "nat", :mac =&gt; "52:54:00:00:26:#{i+20}"

      config.vm.network :private_network, ip: "192.168.27.#{i+10}", auto_config: false, libvirt__network_name: "tenant_network", libvirt__dhcp_enabled: false, libvirt__forward_mode: "nat", :mac =&gt; "52:54:00:00:27:#{i+10}"
      config.vm.network :private_network, ip: "192.168.27.#{i+20}", auto_config: false, libvirt__network_name: "tenant_network", libvirt__dhcp_enabled: false, libvirt__forward_mode: "nat", :mac =&gt; "52:54:00:00:27:#{i+20}"
    end
  end

  config.vm.provision 'shell', inline: "install -m 0700 -d /root/.ssh/; echo #{ssh_pub_key} &gt;&gt; /root/.ssh/authorized_keys; chmod 0600 /root/.ssh/authorized_keys"
  config.vm.provision 'shell', inline: "echo #{ssh_pub_key} &gt;&gt; /home/vagrant/.ssh/authorized_keys", privileged: false
end

# Deploy network subnet:  192.168.25.0/24, GW: 192.168.125.1
# Control network subnet: 192.168.26.0/24, GW: 192.168.126.1
# Tenant network subnet:  192.168.27.0/24, GW: 192.168.127.1
</span><span class="no">EOF

</span><span class="nb">cd</span> /var/tmp/test <span class="o">||</span> <span class="nb">exit</span>
<span class="c"># Start all VMs + create networking</span>
vagrant up kvm01
vagrant up

<span class="c"># Check the VMs - all should be running</span>
<span class="nv">VIRSH_VMS</span><span class="o">=</span><span class="si">$(</span>virsh list | <span class="nb">awk</span> <span class="s1">'/_kvm/ { print $2 }'</span><span class="si">)</span>
<span class="k">for </span>VIRSH_VM <span class="k">in</span> <span class="nv">$VIRSH_VMS</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="s2">"*** </span><span class="nv">$VIRSH_VM</span><span class="s2">"</span>
  virsh dumpxml <span class="s2">"</span><span class="nv">$VIRSH_VM</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="s1">'mac address'</span> | <span class="nb">sort
</span><span class="k">done</span>

<span class="c"># Check the subnets</span>
virsh net-list <span class="nt">--all</span> | <span class="nb">grep </span>network
<span class="nv">VIRSH_NETWORKS</span><span class="o">=</span><span class="si">$(</span>virsh net-list | <span class="nb">awk</span> <span class="s1">'/network|vagrant/ { print $1 }'</span><span class="si">)</span>
<span class="k">for </span>VIRSH_NETWORK <span class="k">in</span> <span class="nv">$VIRSH_NETWORKS</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="s2">"*** </span><span class="nv">$VIRSH_NETWORK</span><span class="s2">"</span>
  virsh net-dumpxml <span class="s2">"</span><span class="nv">$VIRSH_NETWORK</span><span class="s2">"</span>
<span class="k">done</span>

<span class="c"># Check the DHCP lease file - there should be only kvm01</span>
<span class="nv">DEVICE</span><span class="o">=</span><span class="si">$(</span>virsh net-dumpxml vagrant-libvirt | <span class="nb">awk</span> <span class="nt">-F</span><span class="se">\'</span> <span class="s1">'/bridge/ { print $2 }'</span><span class="si">)</span>
<span class="nb">cat</span> <span class="s2">"/var/lib/libvirt/dnsmasq/</span><span class="k">${</span><span class="nv">DEVICE</span><span class="k">}</span><span class="s2">.status"</span>

<span class="c"># SSH to the first node where MAAS will be installed</span>
ssh <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no kvm01

<span class="c"># Check IPs / NICS</span>
ip a

<span class="c"># Configure the NICs</span>
apt update
apt <span class="nb">install</span> <span class="nt">-y</span> ifenslave
<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/network/interfaces <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
auto eth1
iface eth1 inet static
    address 192.168.25.11
    netmask 255.255.255.0

auto eth2
iface eth2 inet manual
    bond-master bond0

auto eth3
iface eth3 inet manual
    bond-master bond0

auto bond0
iface bond0 inet static
    address 192.168.26.11
    netmask 255.255.255.0
    bond-slaves eth2 eth3
    bond_mode active-backup

auto eth4
iface eth4 inet manual
    bond-master bond1

auto eth5
iface eth5 inet manual
    bond-master bond1

auto bond1
iface bond1 inet static
    address 192.168.27.11
    netmask 255.255.255.0
    bond-slaves eth4 eth5
    bond_mode active-backup
</span><span class="no">EOF
</span>service networking restart

<span class="c"># Install MAAS</span>
apt <span class="nb">install</span> <span class="nt">-y</span> jq libvirt-bin maas

<span class="c"># Configure Region controller to point to the right MAAS IP address</span>
maas-region local_config_set <span class="nt">--maas-url</span> http://192.168.25.11:5240/MAAS
systemctl restart maas-regiond

<span class="c"># Register a rack controller with the MAAS</span>
maas-rack register <span class="nt">--url</span> http://192.168.25.11:5240/MAAS <span class="nt">--secret</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">cat</span> /var/lib/maas/secret<span class="si">)</span><span class="s2">"</span>

<span class="c"># Create administrator (MAAS "superuser")</span>
maas createadmin <span class="nt">--username</span><span class="o">=</span>admin <span class="nt">--email</span><span class="o">=</span>admin@example.com <span class="nt">--password</span> admin123

<span class="c"># Export API key that was generated when the MAAS account was created</span>
maas-region apikey <span class="nt">--username</span><span class="o">=</span>admin <span class="o">&gt;</span> /root/api_key

<span class="c"># Create a short script which will help you to login to MAAS quickly</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /root/maas-login.sh <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
#!/bin/sh

# Change these 3 values as required
PROFILE=admin
API_KEY_FILE=/root/api_key
API_SERVER=localhost

MAAS_URL=http://</span><span class="nv">$API_SERVER</span><span class="sh">/MAAS/api/2.0

maas login </span><span class="nv">$PROFILE</span><span class="sh"> </span><span class="nv">$MAAS_URL</span><span class="sh"> - &lt; </span><span class="nv">$API_KEY_FILE</span><span class="sh">
</span><span class="no">EOF

</span><span class="nb">chmod </span>a+x /root/maas-login.sh
<span class="c"># Login to MAAS</span>
/root/maas-login.sh

<span class="c"># Generate SSH key which will be imported in the next command</span>
ssh-keygen <span class="nt">-P</span> <span class="s2">""</span> <span class="nt">-f</span> /root/.ssh/id_rsa <span class="nt">-C</span> <span class="s2">"admin@example.com"</span>

<span class="c"># Import the admin SSH key</span>
maas admin sshkeys create <span class="s2">"key=</span><span class="si">$(</span><span class="nb">cat</span> /root/.ssh/id_rsa.pub<span class="si">)</span><span class="s2">"</span>

<span class="c"># Turn OFF all VMs except the first one running MAAS</span>
<span class="c"># This will also test if the libvirtd daemon is properly configured allowing MAAS to manage the VMs</span>
virsh <span class="nt">-c</span> qemu+tcp://192.168.25.1/system destroy test_kvm02
virsh <span class="nt">-c</span> qemu+tcp://192.168.25.1/system destroy test_kvm03
virsh <span class="nt">-c</span> qemu+tcp://192.168.25.1/system list <span class="nt">--all</span>

<span class="nv">SUBNET_CIDR</span><span class="o">=</span><span class="s2">"192.168.25.0/24"</span>
<span class="nv">SUBNET_PREFIX</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$SUBNET_CIDR</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="nt">-r</span> <span class="s1">'s/(([0-9]{1,3}\.){2}.[0-9]{1,3}).*/\1/'</span><span class="si">)</span>
<span class="nv">PRIMARY_RACK_CONTROLLER</span><span class="o">=</span><span class="si">$(</span>maas admin rack-controllers <span class="nb">read</span> | jq <span class="nt">-r</span> <span class="s1">'.[0].system_id'</span><span class="si">)</span>
<span class="nv">VLAN_FABRIC_ID</span><span class="o">=</span><span class="si">$(</span>maas admin subnet <span class="nb">read</span> <span class="s2">"</span><span class="nv">$SUBNET_CIDR</span><span class="s2">"</span> | jq <span class="s1">'.vlan.fabric_id'</span><span class="si">)</span>
<span class="nv">VLAN_VID</span><span class="o">=</span><span class="si">$(</span>maas admin subnets <span class="nb">read</span> | jq <span class="nt">-r</span> <span class="s2">".[] |  select(.cidr==</span><span class="se">\"</span><span class="nv">$SUBNET_CIDR</span><span class="se">\"</span><span class="s2">)"</span>.vlan.vid<span class="si">)</span>

<span class="c"># Add default gateway for 192.168.25.0/24</span>
maas admin subnet update <span class="s2">"cidr:</span><span class="k">${</span><span class="nv">SUBNET_CIDR</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"gateway_ip=</span><span class="k">${</span><span class="nv">SUBNET_PREFIX</span><span class="k">}</span><span class="s2">.1"</span>

<span class="c"># Enable DHCP on the subnet 192.168.25.0/24 and reserve dynamic IP range (192.168.25.200 - 192.168.25.250) - used for commissioning</span>
maas admin ipranges create <span class="nb">type</span><span class="o">=</span>dynamic <span class="s2">"start_ip=</span><span class="k">${</span><span class="nv">SUBNET_PREFIX</span><span class="k">}</span><span class="s2">.200"</span> <span class="s2">"end_ip=</span><span class="k">${</span><span class="nv">SUBNET_PREFIX</span><span class="k">}</span><span class="s2">.250"</span> <span class="nv">comment</span><span class="o">=</span><span class="s1">'This is a reserved dynamic range'</span>
maas admin vlan update <span class="s2">"</span><span class="nv">$VLAN_FABRIC_ID</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$VLAN_VID</span><span class="s2">"</span> <span class="nv">dhcp_on</span><span class="o">=</span>True <span class="s2">"primary_rack=</span><span class="nv">$PRIMARY_RACK_CONTROLLER</span><span class="s2">"</span>

<span class="c"># Define node by specifying the libvirt VM management and start commissioning</span>
<span class="k">for </span>INDEX <span class="k">in</span> <span class="o">{</span>2..3<span class="o">}</span><span class="p">;</span> <span class="k">do
  </span><span class="nv">MAC</span><span class="o">=</span><span class="s2">"52:54:00:00:25:1</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="s2">"</span>
  maas admin machines create <span class="nv">power_parameters_power_address</span><span class="o">=</span>qemu+tcp://192.168.25.1/system <span class="s2">"hostname=kvm0</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="s2">"</span> <span class="nv">power_type</span><span class="o">=</span>virsh <span class="s2">"power_parameters_power_id=test_kvm0</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="s2">"</span> <span class="nv">architecture</span><span class="o">=</span>amd64/generic <span class="s2">"mac_addresses=</span><span class="nv">$MAC</span><span class="s2">"</span>
<span class="k">done</span>

<span class="c"># All the machines should be in commissioning state right now</span>
virsh <span class="nt">-c</span> qemu+tcp://192.168.25.1/system list <span class="nt">--all</span>

<span class="c"># Set static IPs, create bonds and deploy the Ubuntu Xenial</span>
<span class="k">for </span>INDEX <span class="k">in</span> <span class="o">{</span>2..3<span class="o">}</span><span class="p">;</span> <span class="k">do
  </span><span class="nv">MAC_1</span><span class="o">=</span><span class="s2">"52:54:00:00:25:1</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="s2">"</span>
  <span class="nv">MAC_2</span><span class="o">=</span><span class="s2">"52:54:00:00:26:1</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="s2">"</span>
  <span class="nv">MAC_3</span><span class="o">=</span><span class="s2">"52:54:00:00:26:2</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="s2">"</span>
  <span class="nv">MAC_4</span><span class="o">=</span><span class="s2">"52:54:00:00:27:1</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="s2">"</span>
  <span class="nv">MAC_5</span><span class="o">=</span><span class="s2">"52:54:00:00:27:2</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="s2">"</span>
  <span class="nv">IP_1</span><span class="o">=</span><span class="s2">"192.168.25.1</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="s2">"</span>
  <span class="nv">SUBNET_CIDR_1</span><span class="o">=</span><span class="s2">"192.168.25.0/24"</span>
  <span class="nv">IP_2</span><span class="o">=</span><span class="s2">"192.168.26.1</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="s2">"</span>
  <span class="nv">SUBNET_CIDR_2</span><span class="o">=</span><span class="s2">"192.168.26.0/24"</span>
  <span class="nv">IP_3</span><span class="o">=</span><span class="s2">"192.168.27.1</span><span class="k">${</span><span class="nv">INDEX</span><span class="k">}</span><span class="s2">"</span>
  <span class="nv">SUBNET_CIDR_3</span><span class="o">=</span><span class="s2">"192.168.27.0/24"</span>

  maas admin nodes <span class="nb">read</span> <span class="s2">"mac_address=</span><span class="nv">$MAC_1</span><span class="s2">"</span> <span class="o">&gt;</span> /tmp/maas_nodes_read
  <span class="nv">SYSTEM_ID</span><span class="o">=</span><span class="si">$(</span>jq <span class="nt">-r</span> <span class="s2">".[].system_id"</span> /tmp/maas_nodes_read<span class="si">)</span>
  <span class="nv">INTERFACE_ID_1</span><span class="o">=</span><span class="si">$(</span>jq <span class="nt">-r</span> <span class="s2">".[].interface_set[] | select(.mac_address==</span><span class="se">\"</span><span class="nv">$MAC_1</span><span class="se">\"</span><span class="s2">).id"</span> /tmp/maas_nodes_read<span class="si">)</span>
  <span class="nv">INTERFACE_ID_2</span><span class="o">=</span><span class="si">$(</span>jq <span class="nt">-r</span> <span class="s2">".[].interface_set[] | select(.mac_address==</span><span class="se">\"</span><span class="nv">$MAC_2</span><span class="se">\"</span><span class="s2">).id"</span> /tmp/maas_nodes_read<span class="si">)</span>
  <span class="nv">INTERFACE_ID_3</span><span class="o">=</span><span class="si">$(</span>jq <span class="nt">-r</span> <span class="s2">".[].interface_set[] | select(.mac_address==</span><span class="se">\"</span><span class="nv">$MAC_3</span><span class="se">\"</span><span class="s2">).id"</span> /tmp/maas_nodes_read<span class="si">)</span>
  <span class="nv">INTERFACE_ID_4</span><span class="o">=</span><span class="si">$(</span>jq <span class="nt">-r</span> <span class="s2">".[].interface_set[] | select(.mac_address==</span><span class="se">\"</span><span class="nv">$MAC_4</span><span class="se">\"</span><span class="s2">).id"</span> /tmp/maas_nodes_read<span class="si">)</span>
  <span class="nv">INTERFACE_ID_5</span><span class="o">=</span><span class="si">$(</span>jq <span class="nt">-r</span> <span class="s2">".[].interface_set[] | select(.mac_address==</span><span class="se">\"</span><span class="nv">$MAC_5</span><span class="se">\"</span><span class="s2">).id"</span> /tmp/maas_nodes_read<span class="si">)</span>

  <span class="c"># Remove the "Auto assign" IP address and set static instead</span>
  <span class="c"># https://askubuntu.com/questions/942412/how-do-you-statically-asign-an-ip-to-a-commissioned-machine-in-maas</span>
  <span class="nv">OLD_LINK_ID</span><span class="o">=</span><span class="si">$(</span>jq <span class="s2">".[].interface_set[] | select(.id==</span><span class="nv">$INTERFACE_ID_1</span><span class="s2">).links[].id"</span> /tmp/maas_nodes_read<span class="si">)</span>
  maas admin interface unlink-subnet <span class="s2">"</span><span class="nv">$SYSTEM_ID</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$INTERFACE_ID_1</span><span class="s2">"</span> <span class="s2">"id=</span><span class="nv">$OLD_LINK_ID</span><span class="s2">"</span>
  maas admin interface link-subnet <span class="s2">"</span><span class="nv">$SYSTEM_ID</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$INTERFACE_ID_1</span><span class="s2">"</span> <span class="nv">mode</span><span class="o">=</span>STATIC <span class="s2">"subnet=cidr:</span><span class="nv">$SUBNET_CIDR_1</span><span class="s2">"</span> <span class="s2">"ip_address=</span><span class="nv">$IP_1</span><span class="s2">"</span> <span class="nv">default_gateway</span><span class="o">=</span><span class="nb">true</span>

  <span class="c"># Create bond interfaces</span>
  maas admin interfaces create-bond <span class="s2">"</span><span class="nv">$SYSTEM_ID</span><span class="s2">"</span> <span class="nv">name</span><span class="o">=</span>bond0 <span class="s2">"parents=</span><span class="nv">$INTERFACE_ID_2</span><span class="s2">"</span> <span class="s2">"mac_address=</span><span class="nv">$MAC_2</span><span class="s2">"</span> <span class="s2">"parents=</span><span class="nv">$INTERFACE_ID_3</span><span class="s2">"</span> <span class="nv">bond_mode</span><span class="o">=</span>active-backup
  maas admin interfaces create-bond <span class="s2">"</span><span class="nv">$SYSTEM_ID</span><span class="s2">"</span> <span class="nv">name</span><span class="o">=</span>bond1 <span class="s2">"parents=</span><span class="nv">$INTERFACE_ID_4</span><span class="s2">"</span> <span class="s2">"mac_address=</span><span class="nv">$MAC_4</span><span class="s2">"</span> <span class="s2">"parents=</span><span class="nv">$INTERFACE_ID_5</span><span class="s2">"</span> <span class="nv">bond_mode</span><span class="o">=</span>active-backup

  <span class="c"># Regenerate /tmp/maas_nodes_read - now with the bond interfaces</span>
  maas admin nodes <span class="nb">read</span> <span class="s2">"mac_address=</span><span class="nv">$MAC_1</span><span class="s2">"</span> <span class="o">&gt;</span> /tmp/maas_nodes_read
  <span class="nv">BOND0_ID</span><span class="o">=</span><span class="si">$(</span>jq <span class="nt">-r</span> <span class="s2">".[].interface_set[] | select(.name==</span><span class="se">\"</span><span class="s2">bond0</span><span class="se">\"</span><span class="s2">).id"</span> /tmp/maas_nodes_read<span class="si">)</span>
  <span class="nv">BOND1_ID</span><span class="o">=</span><span class="si">$(</span>jq <span class="nt">-r</span> <span class="s2">".[].interface_set[] | select(.name==</span><span class="se">\"</span><span class="s2">bond1</span><span class="se">\"</span><span class="s2">).id"</span> /tmp/maas_nodes_read<span class="si">)</span>

  <span class="c"># Assign proper fabric and IP to the bond0</span>
  <span class="nv">FABRIC_VLAN_ID</span><span class="o">=</span><span class="si">$(</span>maas admin subnets <span class="nb">read</span> | jq <span class="s2">".[] | select(.cidr==</span><span class="se">\"</span><span class="nv">$SUBNET_CIDR_2</span><span class="se">\"</span><span class="s2">).vlan.id"</span><span class="si">)</span>
  maas admin interface update <span class="s2">"</span><span class="nv">$SYSTEM_ID</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$BOND0_ID</span><span class="s2">"</span> <span class="s2">"vlan=</span><span class="nv">$FABRIC_VLAN_ID</span><span class="s2">"</span>
  maas admin interface link-subnet <span class="s2">"</span><span class="nv">$SYSTEM_ID</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$BOND0_ID</span><span class="s2">"</span> <span class="nv">mode</span><span class="o">=</span>STATIC <span class="s2">"subnet=cidr:</span><span class="nv">$SUBNET_CIDR_2</span><span class="s2">"</span> <span class="s2">"ip_address=</span><span class="nv">$IP_2</span><span class="s2">"</span>

  <span class="c"># Assign proper fabric and IP to the bond1</span>
  <span class="nv">FABRIC_VLAN_ID</span><span class="o">=</span><span class="si">$(</span>maas admin subnets <span class="nb">read</span> | jq <span class="s2">".[] | select(.cidr==</span><span class="se">\"</span><span class="nv">$SUBNET_CIDR_3</span><span class="se">\"</span><span class="s2">).vlan.id"</span><span class="si">)</span>
  maas admin interface update <span class="s2">"</span><span class="nv">$SYSTEM_ID</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$BOND1_ID</span><span class="s2">"</span> <span class="s2">"vlan=</span><span class="nv">$FABRIC_VLAN_ID</span><span class="s2">"</span>
  maas admin interface link-subnet <span class="s2">"</span><span class="nv">$SYSTEM_ID</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$BOND1_ID</span><span class="s2">"</span> <span class="nv">mode</span><span class="o">=</span>STATIC <span class="s2">"subnet=cidr:</span><span class="nv">$SUBNET_CIDR_3</span><span class="s2">"</span> <span class="s2">"ip_address=</span><span class="nv">$IP_3</span><span class="s2">"</span>

  <span class="c"># Deploy server</span>
  maas admin machine deploy <span class="s2">"</span><span class="nv">$SYSTEM_ID</span><span class="s2">"</span>
<span class="k">done</span>

<span class="c"># All machines should be installed + deployed...</span>
virsh <span class="nt">-c</span> qemu+tcp://192.168.25.1/system list <span class="nt">--all</span>

ssh ubuntu@192.168.25.12 <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no
ssh ubuntu@192.168.25.13 <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no
</pre></table></code></div></div><p>Asciinema if needed:</p><p><a href="https://asciinema.org/a/163897" class="img-link shimmer" ><img src="https://asciinema.org/a/163897.svg" alt="asciicast" loading="lazy"></a></p><p>I hope it’s helpful for somebody…</p><p>Enjoy ;-)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/linux/">Linux</a>, <a href="/categories/virtualization/">Virtualization</a>, <a href="/categories/linux-xvx-cz/">linux.xvx.cz</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/maas/" class="post-tag no-text-decoration" >maas</a> <a href="/tags/vagrant/" class="post-tag no-text-decoration" >vagrant</a> <a href="/tags/kvm/" class="post-tag no-text-decoration" >kvm</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Create%20lab%20infrastructure%20running%20Virtual%20machines%20with%20MAAS%20using%20Vagrant%20-%20Petr's%20Blog&url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fcreate-lab-infrastructure-running-virtual-machines-with-maas-using-vagrant%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Create%20lab%20infrastructure%20running%20Virtual%20machines%20with%20MAAS%20using%20Vagrant%20-%20Petr's%20Blog&u=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fcreate-lab-infrastructure-running-virtual-machines-with-maas-using-vagrant%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fcreate-lab-infrastructure-running-virtual-machines-with-maas-using-vagrant%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <script defer type="module" src="https://cdn.jsdelivr.net/npm/@justinribeiro/share-to-mastodon/+esm"></script> <button class="btn text-start" data-bs-toggle="tooltip" data-bs-placement="top" title="Mastodon" aria-label="Mastodon"> <share-to-mastodon class="share-mastodon" message="Create%20lab%20infrastructure%20running%20Virtual%20machines%20with%20MAAS%20using%20Vagrant%20-%20Petr's%20Blog" url="https%3A%2F%2Fruzickap.github.io%2Fposts%2Fcreate-lab-infrastructure-running-virtual-machines-with-maas-using-vagrant%2F"customInstanceList="[{&quot;label&quot;:&quot;mastodon.social&quot;,&quot;link&quot;:&quot;https://mastodon.social/&quot;},{&quot;label&quot;:&quot;mastodon.online&quot;,&quot;link&quot;:&quot;https://mastodon.online/&quot;},{&quot;label&quot;:&quot;fosstodon.org&quot;,&quot;link&quot;:&quot;https://fosstodon.org/&quot;},{&quot;label&quot;:&quot;photog.social&quot;,&quot;link&quot;:&quot;https://photog.social/&quot;}]" > <i class="fa-fw fa-brands fa-mastodon"></i> </share-to-mastodon> </button> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/installtion-f5-bigip-virtual-edition-to-rhel7/">Installation F5 BIGIP Virtual Edition to RHEL7</a><li class="text-truncate lh-lg"> <a href="/posts/detect-a-hacker-attacks-eks-vm/">Detect the hacker attacks on Amazon EKS and EC2 instances</a><li class="text-truncate lh-lg"> <a href="/posts/secure-cheap-amazon-eks-auto/">Build secure and cheap Amazon EKS Auto Mode</a><li class="text-truncate lh-lg"> <a href="/posts/eks-auto-cert-manager-velero/">Amazon EKS Auto Mode with cert-manager and Velero</a><li class="text-truncate lh-lg"> <a href="/posts/mcp-servers-k8s/">MCP Servers running on Kubernetes</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon-eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/bash/">bash</a> <a class="post-tag btn btn-outline-primary" href="/tags/pxe/">pxe</a> <a class="post-tag btn btn-outline-primary" href="/tags/wifi/">wifi</a> <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">prometheus</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/setup-production-ready-kubernetes-cluster-using-kubespray-and-vagrant-running-on-the-libvirt-kvms/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1509577200" data-df="ll" > Nov 2, 2017 </time><h4 class="pt-0 my-2">Setup production ready Kubernetes cluster using Kubespray and Vagrant running on the libvirt KVMs</h4><div class="text-muted"><p>Setup production ready Kubernetes cluster using Kubespray and Vagrant running on the libvirt KVMs</p></div></div></a></article><article class="col"> <a href="/posts/create-windows-image-using-packer-and-ansible-and-then-run-it-in-vagrant-libvirt/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1508796000" data-df="ll" > Oct 24, 2017 </time><h4 class="pt-0 my-2">Create Windows image using Packer and Ansible and then run it in Vagrant (libvirt)</h4><div class="text-muted"><p>Create Windows image using Packer and Ansible and then run it in Vagrant (libvirt)</p></div></div></a></article><article class="col"> <a href="/posts/automated-installation-of-windows-7-in-kvm/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1384124400" data-df="ll" > Nov 11, 2013 </time><h4 class="pt-0 my-2">Automated installation of Windows 7 in KVM</h4><div class="text-muted"><p>Automated installation of Windows 7 in KVM</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/how-i-began-with-darktable/" class="btn btn-outline-primary" aria-label="Older" ><p>How I began with Darktable</p></a> <a href="/posts/create-kubernetes-multinode-cluster-using-multiple-vms/" class="btn btn-outline-primary" aria-label="Newer" ><p>Create Kubernetes Multinode Cluster using multiple VMs</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2026</time> <a href="https://twitter.com/Ruzicka_Petr">Petr Ruzicka</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon-eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/bash/">bash</a> <a class="post-tag btn btn-outline-primary" href="/tags/pxe/">pxe</a> <a class="post-tag btn btn-outline-primary" href="/tags/wifi/">wifi</a> <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">prometheus</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ruzickap/ruzickap.github.io', 'data-repo-id': 'R_kgDOGkp4nQ', 'data-category': 'General', 'data-category-id': 'DIC_kwDOGkp4nc4CSdu1', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
