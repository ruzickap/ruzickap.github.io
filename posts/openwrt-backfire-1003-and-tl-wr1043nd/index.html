<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="OpenWrt (Backfire 10.03) and TL-WR1043ND" /><meta name="author" content="Petr Ruzicka" /><meta property="og:locale" content="en" /><meta name="description" content="Configure OpenWrt Backfire on TP-Link TL-WR1043ND with USB extroot, dual WiFi, webcam, and temperature sensors" /><meta property="og:description" content="Configure OpenWrt Backfire on TP-Link TL-WR1043ND with USB extroot, dual WiFi, webcam, and temperature sensors" /><link rel="canonical" href="https://ruzickap.github.io/posts/openwrt-backfire-1003-and-tl-wr1043nd/" /><meta property="og:url" content="https://ruzickap.github.io/posts/openwrt-backfire-1003-and-tl-wr1043nd/" /><meta property="og:site_name" content="Petr’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2011-12-13T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="OpenWrt (Backfire 10.03) and TL-WR1043ND" /><meta name="twitter:site" content="@Ruzicka_Petr" /><meta name="twitter:creator" content="@Ruzicka_Petr" /><meta name="google-site-verification" content="4ugGShJoiB9veoPwFcMsMjzk-1BYbi5ozcSnovkBWtA" /><meta name="msvalidate.01" content="592AB158E3F9EF887F8DC8E69A2FF754" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Petr Ruzicka","url":"https://petr.ruzicka.dev"},"dateModified":"2026-02-08T18:16:39+01:00","datePublished":"2011-12-13T00:00:00+01:00","description":"Configure OpenWrt Backfire on TP-Link TL-WR1043ND with USB extroot, dual WiFi, webcam, and temperature sensors","headline":"OpenWrt (Backfire 10.03) and TL-WR1043ND","mainEntityOfPage":{"@type":"WebPage","@id":"https://ruzickap.github.io/posts/openwrt-backfire-1003-and-tl-wr1043nd/"},"url":"https://ruzickap.github.io/posts/openwrt-backfire-1003-and-tl-wr1043nd/"}</script><title>OpenWrt (Backfire 10.03) and TL-WR1043ND | Petr's Blog</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> document.addEventListener('DOMContentLoaded', () => { const pv = document.getElementById('pageviews'); if (pv !== null) { const uri = location.pathname.replace(/\/$/, ''); const url = `https://ruzickap-github-io.goatcounter.com/counter/${encodeURIComponent(uri)}.json`; fetch(url) .then((response) => response.json()) .then((data) => { const count = data.count.replace(/\D/g, ''); pv.innerText = new Intl.NumberFormat().format(count); }) .catch((error) => { pv.innerText = '1'; }); } }); </script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-64WRCWDZM8"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-64WRCWDZM8'); }); </script> <script async src="https://gc.zgo.at/count.js" data-goatcounter="https://ruzickap-github-io.goatcounter.com/count" ></script> <script defer src="https://cloud.umami.is/script.js" data-website-id="380ea41a-7d5f-4423-8e13-03151bde195f" ></script> <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "ad8c64404e1e41dba184019564cf11bb"}' ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://0.gravatar.com/avatar/5484c0fd9f98e2ffd9212b158931bf4b?s=200" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Petr's Blog</a><p class="site-subtitle fst-italic mb-0">DevOps • GitOps • K8s</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-project-diagram"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/ruzickap" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['petr.ruzicka','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://petr.ruzicka.dev" aria-label="homepage" target="_blank" rel="noopener noreferrer" > <i class="fas fa-home"></i> </a> <a href="https://mastodon.social/@petr_ruzicka" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>OpenWrt (Backfire 10.03) and TL-WR1043ND</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="false"><header><h1 data-toc-skip>OpenWrt (Backfire 10.03) and TL-WR1043ND</h1><p class="post-desc fw-light mb-4">Configure OpenWrt Backfire on TP-Link TL-WR1043ND with USB extroot, dual WiFi, webcam, and temperature sensors</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1323730800" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 13, 2011 </time> </span> <span> Updated <time data-ts="1770570999" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 8, 2026 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://petr.ruzicka.dev">Petr Ruzicka</a> </em> </span><div> <span> <em id="pageviews"> <i class="fas fa-spinner fa-spin small"></i> </em> views </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1727 words" > <em>9 min</em> read</span></div></div></div></header><div class="content"><blockquote class="prompt-info"><p><a href="https://linux-old.xvx.cz/2011/12/openwrt-backfire-10-03-and-tl-wr1043nd/">https://linux-old.xvx.cz/2011/12/openwrt-backfire-10-03-and-tl-wr1043nd/</a></p></blockquote><p>I forgot to publish this article almost a year ago :-( So now it’s a good time before I’ll write another one…</p><p>It’s <strong>OUTDATED</strong> and <strong>INCOMPLETE</strong>, but it can still bring some light…</p><hr /><p>A few days ago I bought the WiFi router <a href="https://openwrt.org/toh/tp-link/tl-wr1043nd">TP-Link TL-WR1043ND</a>. The main reason was the USB, Gigabit Ethernet ports, 802.11n and <a href="https://dev.openwrt.org/milestone/Backfire%2010.03">support</a> in latest <a href="https://openwrt.org/">OpenWrt</a>.</p><p>OpenWrt is an amazing project which can create a really powerful device from wifi routers.</p><p>I spent many days collecting various information about OpenWrt, because I want to use a web camera, USB hub, external USB storage and later a few thermometers.</p><p>I decided to compile it from scratch (using Fedora 13), because squashfs can’t work with block-extroot without building an image (see <a href="https://forum.openwrt.org/viewtopic.php?pid=108642">https://forum.openwrt.org/viewtopic.php?pid=108642</a>). I prefer to use <a href="https://squashfs.sourceforge.net/">squashfs</a>, because some people say it’s better than jffs2.</p><p>Here you can find my notes…</p><p>Download necessary packages to compile OpenWrt:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum <span class="nb">install </span>subversion gcc-c++ libz-dev flex unzip ncurses-devel zlib-devel
</pre></table></code></div></div><p>Download OpenWrt Backfire from svn:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">cd</span> /var/tmp/ <span class="o">||</span> <span class="nb">exit
</span>svn co svn://svn.openwrt.org/openwrt/branches/backfire
</pre></table></code></div></div><p>or use the standard way:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">cd</span> /var/tmp/ <span class="o">||</span> <span class="nb">exit
</span>wget http://downloads.openwrt.org/backfire/10.03/backfire_10.03_source.tar.bz2
<span class="nb">tar </span>xvjf backfire_10.03_source.tar.bz2
<span class="nb">mv </span>backfire_10.03 backfire
</pre></table></code></div></div><p>Start configuring it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">cd </span>backfire/ <span class="o">||</span> <span class="nb">exit</span>
./scripts/feeds update
./scripts/feeds <span class="nb">install </span>xxx
make menuconfig
</pre></table></code></div></div><p>Select following items in the menuconfig and the items from the command below:</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>Target System (Atheros AR71xx/AR7240/AR913x)
Target Profile (TP-LINK TL-WR1043ND v1)
Kernel modules ---&gt; Filesystems ---&gt; kmod-fs-ext2
Kernel modules ---&gt; USB Support ---&gt; kmod-usb-core
Kernel modules ---&gt; USB Support ---&gt; kmod-usb-storage
Kernel modules ---&gt; USB Support ---&gt; kmod-usb-video
Kernel modules ---&gt; USB Support ---&gt; kmod-usb-serial
Kernel modules ---&gt; USB Support ---&gt; kmod-usb-serial-pl2303
Kernel modules ---&gt; Video Support ---&gt; kmod-video-core
Kernel modules ---&gt; Video Support ---&gt; kmod-video-uvc
Utilities ---&gt; disc ---&gt; block-extroot
#Base system ---&gt; block-extroot

and all the packages you installed before
</pre></table></code></div></div><p>Run <code class="language-plaintext highlighter-rouge">make V=99</code> to compile it.</p><p>I’ll put all the root files to the USB disk and I formatted my 500MB USB stick this way:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">root@fedora:/#</span><span class="w"> </span>parted <span class="nt">-s</span> /dev/sda p
<span class="go">Model: Generic STORAGE DEVICE (scsi)
Disk /dev/sda: 492MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos

Number Start End Size Type File system Flags
1 16.4kB 450MB 450MB primary ext2
2 450MB 492MB 41.9MB primary linux-swap(v1)
</span></pre></table></code></div></div><p>Connect router to your desktop/laptop and flash it from the webgui using this file: <code class="language-plaintext highlighter-rouge">openwrt-ar71xx-tl-wr1043nd-v1-squashfs-factory.bin</code> or use these commands if you already have OpenWrt installed:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>scp ./backfire/bin/ar71xx/openwrt-ar71xx-tl-wr1043nd-v1-squashfs-sysupgrade.bin root@192.168.0.2:/tmp
sysupgrade openwrt-ar71xx-tl-wr1043nd-v1-squashfs-sysupgrade.bin
<span class="c">#scp ./backfire/bin/ar71xx/openwrt-ar71xx-tl-wr1043nd-v1-squashfs-sysupgrade.bin root@192.168.0.2:/tmp</span>
<span class="c">#mtd -e firmware -r write /tmp/openwrt-ar71xx-tl-wr1043nd-v1-squashfs-sysupgrade.bin firmware</span>
</pre></table></code></div></div><p>Set your password using telnet command and setup up <code class="language-plaintext highlighter-rouge">block-extroot</code> (<a href="https://openwrt.org/docs/guide-user/additional-software/extroot_configuration">Rootfs on External Storage</a>) and use my USB stick as root partition to have more space:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>ifconfig eth0 192.168.1.2 netmask 255.255.255.0
telnet 192.168.1.1

uci <span class="nb">set </span>fstab.@mount[0].fstype<span class="o">=</span>ext2
uci <span class="nb">set </span>fstab.@mount[0].device<span class="o">=</span>/dev/sda1
uci <span class="nb">set </span>fstab.@mount[0].is_rootfs<span class="o">=</span>1
uci <span class="nb">set </span>fstab.@mount[0].enabled_fsck<span class="o">=</span>1
uci <span class="nb">set </span>fstab.@mount[0].target<span class="o">=</span>/mnt
uci <span class="nb">set </span>fstab.@mount[0].enabled<span class="o">=</span>1
uci commit fstab

passwd
reboot
</pre></table></code></div></div><p>Turn on the swap:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>uci <span class="nb">set </span>fstab.@swap[0].device<span class="o">=</span>/dev/sda2
uci <span class="nb">set </span>fstab.@swap[0].enabled<span class="o">=</span>1
</pre></table></code></div></div><p>Add option <code class="language-plaintext highlighter-rouge">force_space</code> in <code class="language-plaintext highlighter-rouge">/etc/opkg.conf</code> to allow installation of packets bigger than your <code class="language-plaintext highlighter-rouge">/rom</code> partitions free space:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo </span>option force_space <span class="o">&gt;&gt;</span> /etc/opkg.conf
</pre></table></code></div></div><p>Setup the ssh key to enable autologin:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>scp <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.ssh/id_rsa.pub"</span> root@192.168.0.2:/tmp/authorized_keys
ssh root@192.168.0.2
<span class="nb">cp</span> /tmp/authorized_keys /etc/dropbear/authorized_keys
<span class="nb">chmod </span>600 /etc/dropbear/authorized_keys
</pre></table></code></div></div><p>Configure getting DHCP requests from WAN (Internet) port, wifi and firewall:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
</pre><td class="rouge-code"><pre>uci <span class="nb">set </span>network.lan.ipaddr<span class="o">=</span>192.168.0.193
uci <span class="nb">set </span>network.lan.netmask<span class="o">=</span>255.255.255.192

uci <span class="nb">set </span>network.wan.ifname<span class="o">=</span>eth0.2
uci <span class="nb">set </span>network.wan.proto<span class="o">=</span>static
uci <span class="nb">set </span>network.wan.type<span class="o">=</span>bridge
uci <span class="nb">set </span>network.wan.ipaddr<span class="o">=</span>192.168.0.2
uci <span class="nb">set </span>network.wan.netmask<span class="o">=</span>255.255.255.192
uci <span class="nb">set </span>network.wan.dns<span class="o">=</span><span class="s2">"192.168.0.1 8.8.8.8"</span>
uci <span class="nb">set </span>network.wan.gateway<span class="o">=</span>192.168.0.1

uci <span class="nb">set </span>network.wifi_open<span class="o">=</span>interface
uci <span class="nb">set </span>network.wifi_open.ifname<span class="o">=</span>eth0.3
uci <span class="nb">set </span>network.wifi_open.type<span class="o">=</span>bridge
uci <span class="nb">set </span>network.wifi_open.proto<span class="o">=</span>static
uci <span class="nb">set </span>network.wifi_open.ipaddr<span class="o">=</span>192.168.0.129
uci <span class="nb">set </span>network.wifi_open.netmask<span class="o">=</span>255.255.255.192

uci <span class="nb">set </span>network.wifi_priv<span class="o">=</span>interface
uci <span class="nb">set </span>network.wifi_priv.ifname<span class="o">=</span>eth0.1
uci <span class="nb">set </span>network.wifi_priv.type<span class="o">=</span>bridge
uci <span class="nb">set </span>network.wifi_priv.proto<span class="o">=</span>static
uci <span class="nb">set </span>network.wifi_priv.ipaddr<span class="o">=</span>192.168.0.65
uci <span class="nb">set </span>network.wifi_priv.netmask<span class="o">=</span>255.255.255.192

uci add network switch_vlan
uci <span class="nb">set </span>network.@switch_vlan[-1].device<span class="o">=</span>rtl8366rb
uci <span class="nb">set </span>network.@switch_vlan[-1].vlan<span class="o">=</span>3
uci <span class="nb">set </span>network.@switch_vlan[-1].ports<span class="o">=</span>5

uci <span class="nb">set </span>wireless.@wifi-iface[0].ssid<span class="o">=</span>test123
uci <span class="nb">set </span>wireless.@wifi-iface[0].network<span class="o">=</span>wifi_open
uci <span class="nb">set </span>wireless.@wifi-iface[0].encryption<span class="o">=</span>psk2
uci <span class="nb">set </span>wireless.@wifi-iface[0].key<span class="o">=</span>yyyyyyyy
uci <span class="nb">set </span>wireless.@wifi-iface[0].isolate<span class="o">=</span>1

uci add wireless wifi-iface
uci <span class="nb">set </span>wireless.@wifi-iface[-1].device<span class="o">=</span>radio0
uci <span class="nb">set </span>wireless.@wifi-iface[-1].network<span class="o">=</span>wifi_priv
uci <span class="nb">set </span>wireless.@wifi-iface[-1].mode<span class="o">=</span>ap
uci <span class="nb">set </span>wireless.@wifi-iface[-1].ssid<span class="o">=</span>test345
uci <span class="nb">set </span>wireless.@wifi-iface[-1].encryption<span class="o">=</span>psk2
uci <span class="nb">set </span>wireless.@wifi-iface[-1].key<span class="o">=</span>yyyyyyyy

uci <span class="nb">set </span>wireless.radio0.channel<span class="o">=</span>8
uci <span class="nb">set </span>wireless.radio0.country<span class="o">=</span>CZ
uci <span class="nb">set </span>wireless.radio0.hwmode<span class="o">=</span>11ng
uci del wireless.@wifi-device[0].disabled

uci <span class="nb">set </span>firewall.@zone[1].conntrack<span class="o">=</span>1
uci <span class="nb">set </span>firewall.@zone[1].forward<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@zone[1].input<span class="o">=</span>ACCEPT

uci add firewall zone
uci <span class="nb">set </span>firewall.@zone[-1].name<span class="o">=</span>wifi_open
uci <span class="nb">set </span>firewall.@zone[-1].input<span class="o">=</span>REJECT
uci <span class="nb">set </span>firewall.@zone[-1].output<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@zone[-1].forward<span class="o">=</span>REJECT
uci <span class="nb">set </span>firewall.@zone[-1].conntrack<span class="o">=</span>1

uci add firewall zone
uci <span class="nb">set </span>firewall.@zone[-1].name<span class="o">=</span>wifi_priv
uci <span class="nb">set </span>firewall.@zone[-1].input<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@zone[-1].output<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@zone[-1].forward<span class="o">=</span>REJECT

uci add firewall forwarding
uci <span class="nb">set </span>firewall.@forwarding[-1].src<span class="o">=</span>wifi_open
uci <span class="nb">set </span>firewall.@forwarding[-1].dst<span class="o">=</span>wan

uci add firewall forwarding
uci <span class="nb">set </span>firewall.@forwarding[-1].src<span class="o">=</span>wifi_priv
uci <span class="nb">set </span>firewall.@forwarding[-1].dst<span class="o">=</span>wan

uci add firewall rule
uci <span class="nb">set </span>firewall.@rule[-1].name<span class="o">=</span>icmp-echo-request
uci <span class="nb">set </span>firewall.@rule[-1].src<span class="o">=</span>wifi_open
uci <span class="nb">set </span>firewall.@rule[-1].target<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@rule[-1].proto<span class="o">=</span>icmp
uci <span class="nb">set </span>firewall.@rule[-1].icmp_type<span class="o">=</span>echo-request

uci add firewall rule
uci <span class="nb">set </span>firewall.@rule[-1].name<span class="o">=</span>dhcp
uci <span class="nb">set </span>firewall.@rule[-1].src<span class="o">=</span>wifi_open
uci <span class="nb">set </span>firewall.@rule[-1].target<span class="o">=</span>ACCEPT
uci <span class="nb">set </span>firewall.@rule[-1].proto<span class="o">=</span>udp
uci <span class="nb">set </span>firewall.@rule[-1].src_port<span class="o">=</span>68

uci <span class="nb">set </span>dhcp.@dnsmasq[0].domain<span class="o">=</span>xvx.cz
uci <span class="nb">set </span>dhcp.@dnsmasq[0].port<span class="o">=</span>0
uci <span class="nb">set </span>dhcp.@dnsmasq[0].cachelocal<span class="o">=</span>0
uci <span class="nb">set </span>dhcp.@dnsmasq[0].dhcpscript<span class="o">=</span>/etc/dnsmasq.script

uci <span class="nb">set </span>dhcp.wifi_open<span class="o">=</span>dhcp
uci <span class="nb">set </span>dhcp.wifi_open.interface<span class="o">=</span>wifi_open
uci <span class="nb">set </span>dhcp.wifi_open.start<span class="o">=</span>130
uci <span class="nb">set </span>dhcp.wifi_open.limit<span class="o">=</span>60
uci <span class="nb">set </span>dhcp.wifi_open.dhcp_option<span class="o">=</span>6,192.168.0.1

uci <span class="nb">set </span>dhcp.wifi_priv<span class="o">=</span>dhcp
uci <span class="nb">set </span>dhcp.wifi_priv.interface<span class="o">=</span>wifi_priv
uci <span class="nb">set </span>dhcp.wifi_priv.start<span class="o">=</span>70
uci <span class="nb">set </span>dhcp.wifi_priv.limit<span class="o">=</span>60
uci <span class="nb">set </span>dhcp.wifi_priv.dhcp_option<span class="o">=</span>6,192.168.0.1

uci <span class="nb">set </span>dhcp.lan.start<span class="o">=</span>194
uci <span class="nb">set </span>dhcp.lan.limit<span class="o">=</span>60
uci <span class="nb">set </span>dhcp.lan.dhcp_option<span class="o">=</span>6,192.168.0.1

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>peru-nb-work
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.66
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:1C:65:38:7C:F6

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>peru-nb
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.67
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:15:00:11:48:5a

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>phone
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.68
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:23:76:d6:42:c7

uci add dhcp host
uci <span class="nb">set </span>dhcp.@host[-1].name<span class="o">=</span>palm
uci <span class="nb">set </span>dhcp.@host[-1].ip<span class="o">=</span>192.168.0.69
uci <span class="nb">set </span>dhcp.@host[-1].mac<span class="o">=</span>00:0b:6c:57:da:9a

wget http://rpc.one.pl/pliki/openwrt/backfire/10.03.x/dnsmasq/dnsmasq <span class="nt">-O</span> /etc/init.d/dnsmasq
</pre></table></code></div></div><p>Set the hostname, timezone and configure syslogd:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>uci <span class="nb">set </span>system.@system[0].timezone<span class="o">=</span>CET-1CEST,M3.5.0,M10.5.0/3
uci <span class="nb">set </span>system.@system[0].timezone<span class="o">=</span>CET-1CEST,M3.5.0,M10.5.0/3
uci <span class="nb">set </span>system.@system[0].log_size<span class="o">=</span>64
uci <span class="nb">set </span>system.@system[0].log_ip<span class="o">=</span>192.168.0.1
</pre></table></code></div></div><p>Configure certificate details for https:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>uci <span class="nb">set </span>uhttpd.px5g.days<span class="o">=</span>3650
uci <span class="nb">set </span>uhttpd.px5g.country<span class="o">=</span>CZ
uci <span class="nb">set </span>uhttpd.px5g.state<span class="o">=</span><span class="s2">"Czech Republic"</span>
uci <span class="nb">set </span>uhttpd.px5g.location<span class="o">=</span>Brno
<span class="nb">rm</span> /etc/uhttpd.crt /etc/uhttpd.key
</pre></table></code></div></div><p>Configure darkstat, snmpd and vnstat.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>uci <span class="nb">set </span>darkstat.@darkstat[0].interface<span class="o">=</span>wan

uci <span class="nb">set </span>mini_snmpd.@mini_snmpd[0].interfaces<span class="o">=</span>lo,br-wan,br-wifi_open,br-wifi_private
uci <span class="nb">set </span>mini_snmpd.@mini_snmpd[0].community<span class="o">=</span>OpenWrt
uci <span class="nb">set </span>mini_snmpd.@mini_snmpd[0].location<span class="o">=</span><span class="s1">'V Ujezdech 1, Brno'</span>
uci <span class="nb">set </span>mini_snmpd.@mini_snmpd[0].contact<span class="o">=</span><span class="s1">'PeRu'</span>
</pre></table></code></div></div><p>Few more commands to configure “non-uci” files:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
</pre><td class="rouge-code"><pre><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/\(^mailhub\).*/\1=gate.xvx.cz/;s/\(^rewriteDomain=\).*/\1xvx.cz/'</span> /etc/ssmtp/ssmtp.conf

<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/\(^GatewayInterface\).*/\1 br-wifi_open/;s/^# \(GatewayName\).*/\1 Medlanky/;s/^\([[:space:]]*FirewallRule allow tcp port 80\)/#\1/;s/\(.*FirewallRule allow tcp port 22\)/#\1/;s/\(.*FirewallRule allow tcp port 443\)/#\1/;/^FirewallRuleSet authenticated-users/a\ FirewallRule allow'</span> /etc/nodogsplash/nodogsplash.conf

<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s@\(\)@\1\n
&lt;h3&gt;For Internet access - click the dog&lt;/h3&gt;
\n
&lt;h3&gt;Pro pristup na Internet klikni na psa.&lt;/h3&gt;
@'</span> /etc/nodogsplash/htdocs/splash.html

<span class="nb">cat</span> <span class="o">&gt;</span> /etc/dnsmasq.script <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh"> #!/bin/sh /bin/echo `/bin/date +"%F %T"` </span><span class="nv">$*</span><span class="sh"> &gt;&gt; /tmp/dnsmasq.script.log

case </span><span class="nv">$1</span><span class="sh"> in
"add")
#grep -q </span><span class="nv">$2</span><span class="sh"> /etc/config/dhcp || /usr/bin/nmap -T4 -A </span><span class="nv">$3</span><span class="sh"> | ssmtp petr.ruzicka@gmail.com
#echo "Subject: New connection to `hostname` (</span><span class="nv">$2</span><span class="sh"> </span><span class="nv">$3</span><span class="sh">)</span><span class="se">\n\n</span><span class="sh">`/usr/bin/nmap -T4 -A </span><span class="nv">$3</span><span class="sh">`" | ssmtp petr.ruzicka@gmail.com
echo "ADD: MAC: </span><span class="nv">$MAC</span><span class="sh">; DNSMASQ_LEASE_LENGTH: </span><span class="nv">$DNSMASQ_LEASE_LENGTH</span><span class="sh">; DNSMASQ_LEASE_EXPIRES: </span><span class="nv">$DNSMASQ_LEASE_EXPIRES</span><span class="sh">; DNSMASQ_TIME_REMAINING: </span><span class="nv">$DNSMASQ_TIME_REMAINING</span><span class="sh">; DNSMASQ_TAGS: </span><span class="nv">$DNSMASQ_TAGS</span><span class="sh">" &gt;&gt; /tmp/dnsmasq.script.log
;;
"old")
echo "OLD: MAC: </span><span class="nv">$MAC</span><span class="sh">; DNSMASQ_LEASE_LENGTH: </span><span class="nv">$DNSMASQ_LEASE_LENGTH</span><span class="sh">; DNSMASQ_LEASE_EXPIRES: </span><span class="nv">$DNSMASQ_LEASE_EXPIRES</span><span class="sh">; DNSMASQ_TIME_REMAINING: </span><span class="nv">$DNSMASQ_TIME_REMAINING</span><span class="sh">; DNSMASQ_TAGS: </span><span class="nv">$DNSMASQ_TAGS</span><span class="sh">" &gt;&gt; /tmp/dnsmasq.script.log
;;
"del")
echo "DEL: MAC: </span><span class="nv">$MAC</span><span class="sh">; DNSMASQ_LEASE_LENGTH: </span><span class="nv">$DNSMASQ_LEASE_LENGTH</span><span class="sh">; DNSMASQ_LEASE_EXPIRES: </span><span class="nv">$DNSMASQ_LEASE_EXPIRES</span><span class="sh">; DNSMASQ_TIME_REMAINING: </span><span class="nv">$DNSMASQ_TIME_REMAINING</span><span class="sh">; DNSMASQ_TAGS: </span><span class="nv">$DNSMASQ_TAGS</span><span class="sh">" &gt;&gt; /tmp/dnsmasq.script.log
;;
esac
</span><span class="no">EOF

</span><span class="nb">chmod </span>a+x /etc/dnsmasq.script

<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/digitemp.script <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
#!/bin/sh /usr/bin/digitemp_DS9097 -c/etc/digitemp.conf -a -n0 -d10 -q -s/dev/ttyUSB0 -o"PUTVAL OpenWrt/temp/temperature-%s interval=10 %N:%.2C"
</span><span class="no">EOF
</span><span class="nb">chmod </span>a+x /etc/digitemp.script
<span class="nb">mkdir</span> /root/.ssh/
dropbearkey <span class="nt">-t</span> rsa <span class="nt">-f</span> /root/.ssh/id_rsa

<span class="c"># Save the public key to the ~/.ssh/authorized_keys on the server cat &gt; /etc/fswebcam.script &lt;&lt; \EOF</span>
<span class="c">#!/bin/sh</span>
<span class="nv">OUTPUT_FILE</span><span class="o">=</span><span class="s2">"/tmp/webcam/</span><span class="si">$(</span><span class="nb">date</span> +%F_%H-%M<span class="si">)</span><span class="s2">.png"</span>
<span class="nv">OUTPUT_DIR</span><span class="o">=</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$OUTPUT_FILE</span><span class="s2">"</span><span class="si">)</span>

<span class="nb">date</span> <span class="o">&gt;</span> /tmp/fswebcam.script.log

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="si">$(</span>pgrep <span class="nt">-f</span> fswebcam | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span><span class="s2">"</span> <span class="nt">-ge</span> 4 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">BAD_STATE</span><span class="o">=</span>1
  <span class="c"># shellcheck disable=SC2009 # ps | grep is intentional to show full process details for debugging</span>
  <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"*** fswebcam already running [</span><span class="si">$(</span>pgrep <span class="nt">-f</span> fswebcam | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span><span class="s2">] !!!</span><span class="se">\n</span><span class="s2">*** ps -ef | grep -E '(fswebcam|scp)':</span><span class="se">\n</span><span class="si">$(</span>ps <span class="nt">-ef</span> | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">'(fswebcam|scp)'</span><span class="si">)</span><span class="se">\n</span><span class="s2">*** killall fswebcam:</span><span class="se">\n</span><span class="si">$(</span>killall fswebcam<span class="si">)</span><span class="se">\n</span><span class="s2">"</span> | <span class="nb">tee</span> <span class="nt">-a</span> /tmp/fswebcam.script.log
<span class="k">fi

</span><span class="nb">test</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$OUTPUT_DIR</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$OUTPUT_DIR</span><span class="s2">"</span>

fswebcam <span class="nt">--no-banner</span> <span class="nt">--rotate</span> 180 <span class="nt">--resolution</span> 640x480 <span class="nt">--fps</span> 15 <span class="nt">--png</span> 7 <span class="nt">--save</span> <span class="s2">"</span><span class="nv">$OUTPUT_FILE</span><span class="s2">"</span> 2&gt;&amp;1 | <span class="nb">tee</span> <span class="nt">-a</span> /tmp/fswebcam.script.log

<span class="k">if </span>scp <span class="nt">-B</span> <span class="nt">-p</span> <span class="nt">-i</span> /root/.ssh/id_rsa <span class="s2">"</span><span class="nv">$OUTPUT_FILE</span><span class="s2">"</span> ruzickap@gate.xvx.cz:/home/ftp/ <span class="o">&gt;&gt;</span> /tmp/fswebcam.script.log 2&gt;&amp;1<span class="p">;</span> <span class="k">then
  </span><span class="nb">rm</span> <span class="s2">"</span><span class="nv">$OUTPUT_FILE</span><span class="s2">"</span>
<span class="k">else
  </span><span class="nv">BAD_STATE</span><span class="o">=</span>1
  <span class="nb">test</span> <span class="nt">-d</span> /root/webcam_medlanky <span class="o">||</span> <span class="nb">mkdir</span> <span class="nt">-p</span> /root/webcam_medlanky
  <span class="nb">mv</span> <span class="s2">"</span><span class="nv">$OUTPUT_FILE</span><span class="s2">"</span> /root/webcam_medlanky/
  <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"*** ls -la /root/webcam_medlanky/:</span><span class="se">\n</span><span class="si">$(</span><span class="nb">ls</span> <span class="nt">-la</span> /root/webcam_medlanky/<span class="si">)</span><span class="se">\n</span><span class="s2">"</span> | <span class="nb">tee</span> <span class="nt">-a</span> /tmp/fswebcam.script.log
<span class="k">fi

if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$BAD_STATE</span><span class="s2">"</span> <span class="nt">-eq</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Subject: Webcam script failed!</span><span class="se">\n\n</span><span class="si">$(</span><span class="nb">cat</span> /tmp/fswebcam.script.log<span class="si">)</span><span class="se">\n</span><span class="s2">"</span> | ssmtp petr.ruzicka@gmail.com
<span class="k">fi
</span>EOF

<span class="nb">chmod </span>a+x /etc/fswebcam.script
<span class="nb">echo</span> <span class="s2">"*/30 * * * * /etc/fswebcam.script"</span> <span class="o">&gt;&gt;</span> /etc/crontabs/root
/etc/init.d/cron <span class="nb">enable</span>
/etc/init.d/cron start
</pre></table></code></div></div><p>Collectd configuration:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre>/usr/bin/digitemp_DS9097 <span class="nt">-a</span> <span class="nt">-i</span> <span class="nt">-c</span> /etc/digitemp.conf <span class="nt">-s</span>/dev/ttyUSB0

<span class="nb">mkdir</span> <span class="nt">-p</span> /etc/collectd/conf.d
<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/collectd/conf.d/my_collectd.conf <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
LoadPlugin contextswitch
LoadPlugin memory
LoadPlugin uptime
LoadPlugin vmem
LoadPlugin users

LoadPlugin protocols
Value "/^Tcp:/"
IgnoreSelected false

LoadPlugin syslog
LogLevel "info"
</span><span class="no">EOF

</span>uci <span class="nb">set </span>luci_statistics.collectd_ping.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.collectd_ping.Hosts<span class="o">=</span>www.google.com
uci <span class="nb">set </span>luci_statistics.collectd_df.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.collectd_df.Devices<span class="o">=</span>/dev/sda1
uci <span class="nb">set </span>luci_statistics.collectd_df.MountPoints<span class="o">=</span>/mnt/sda1
uci <span class="nb">set </span>luci_statistics.collectd_df.FSTypes<span class="o">=</span>fuseblk
uci <span class="nb">set </span>luci_statistics.collectd_disk.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.collectd_disk.Disks<span class="o">=</span>sda
uci <span class="nb">set </span>luci_statistics.collectd_dns.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.collectd_dns.Interfaces<span class="o">=</span><span class="s2">"br-wan br-wifi_open br-wifi_private"</span>
uci <span class="nb">set </span>luci_statistics.collectd_interface.Interfaces<span class="o">=</span><span class="s2">"br-wan br-wifi_open br-wifi_private"</span>
uci <span class="nb">set </span>luci_statistics.collectd_irq.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.collectd_netlink.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.collectd_netlink.VerboseInterfaces<span class="o">=</span><span class="s2">"br-wan br-wifi_open br-wifi_private"</span>
uci <span class="nb">set </span>luci_statistics.collectd_netlink.QDisc<span class="o">=</span><span class="s2">"br-wan br-wifi_open br-wifi_private"</span>
uci <span class="nb">set </span>luci_statistics.collectd_network.enable<span class="o">=</span>1
uci <span class="nb">set </span>luci_statistics.@collectd_network_server[0].host<span class="o">=</span><span class="s2">"</span><span class="se">\"</span><span class="s2">collectd.xvx.cz</span><span class="se">\"</span><span class="s2">"</span>
uci <span class="nb">set </span>luci_statistics.collectd_tcpconns.LocalPorts<span class="o">=</span><span class="s2">"22 80 443 667"</span>
uci <span class="nb">set </span>luci_statistics.@collectd_exec_input[0].cmdline<span class="o">=</span><span class="s2">"/etc/digitemp.script"</span>

/etc/init.d/luci_statistics <span class="nb">enable</span>
</pre></table></code></div></div><p>Useful commands:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>swconfig dev rtl8366rb show
swconfig dev rtl8366rb vlan 1 show
<span class="nb">cat</span> /proc/net/vlan/config
snmpwalk <span class="nt">-v2c</span> <span class="nt">-c</span> public_wifi 192.168.0.2
logread
</pre></table></code></div></div><p>Serial Port Temperature Sensors: <a href="https://web.archive.org/web/2020/http://www.linuxfocus.org/English/November2003/article315.shtml">https://web.archive.org/web/2020/http://www.linuxfocus.org/English/November2003/article315.shtml</a> <a href="https://martybugs.net/electronics/tempsensor/hardware.cgi">https://martybugs.net/electronics/tempsensor/hardware.cgi</a></p><p>Serial cable: <a href="https://halfface.se/wiki/index.php/Openwrt">https://halfface.se/wiki/index.php/Openwrt</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/openwrt/">OpenWrt</a>, <a href="/categories/networking/">Networking</a>, <a href="/categories/linux-old-xvx-cz/">linux-old.xvx.cz</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/tp-link/" class="post-tag no-text-decoration" >tp-link</a> <a href="/tags/wifi/" class="post-tag no-text-decoration" >wifi</a> <a href="/tags/dnsmasq/" class="post-tag no-text-decoration" >dnsmasq</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=OpenWrt%20(Backfire%2010.03)%20and%20TL-WR1043ND%20-%20Petr's%20Blog&url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fopenwrt-backfire-1003-and-tl-wr1043nd%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=OpenWrt%20(Backfire%2010.03)%20and%20TL-WR1043ND%20-%20Petr's%20Blog&u=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fopenwrt-backfire-1003-and-tl-wr1043nd%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fopenwrt-backfire-1003-and-tl-wr1043nd%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <script defer type="module" src="https://cdn.jsdelivr.net/npm/@justinribeiro/share-to-mastodon/+esm"></script> <button class="btn text-start" data-bs-toggle="tooltip" data-bs-placement="top" title="Mastodon" aria-label="Mastodon"> <share-to-mastodon class="share-mastodon" message="OpenWrt%20(Backfire%2010.03)%20and%20TL-WR1043ND%20-%20Petr's%20Blog" url="https%3A%2F%2Fruzickap.github.io%2Fposts%2Fopenwrt-backfire-1003-and-tl-wr1043nd%2F"customInstanceList="[{&quot;label&quot;:&quot;mastodon.social&quot;,&quot;link&quot;:&quot;https://mastodon.social/&quot;},{&quot;label&quot;:&quot;mastodon.online&quot;,&quot;link&quot;:&quot;https://mastodon.online/&quot;},{&quot;label&quot;:&quot;fosstodon.org&quot;,&quot;link&quot;:&quot;https://fosstodon.org/&quot;},{&quot;label&quot;:&quot;photog.social&quot;,&quot;link&quot;:&quot;https://photog.social/&quot;}]" > <i class="fa-fw fa-brands fa-mastodon"></i> </share-to-mastodon> </button> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/installtion-f5-bigip-virtual-edition-to-rhel7/">Installation F5 BIGIP Virtual Edition to RHEL7</a><li class="text-truncate lh-lg"> <a href="/posts/detect-a-hacker-attacks-eks-vm/">Detect the hacker attacks on Amazon EKS and EC2 instances</a><li class="text-truncate lh-lg"> <a href="/posts/secure-cheap-amazon-eks-auto/">Build secure and cheap Amazon EKS Auto Mode</a><li class="text-truncate lh-lg"> <a href="/posts/eks-auto-cert-manager-velero/">Amazon EKS Auto Mode with cert-manager and Velero</a><li class="text-truncate lh-lg"> <a href="/posts/mcp-servers-k8s/">MCP Servers running on Kubernetes</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon-eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/bash/">bash</a> <a class="post-tag btn btn-outline-primary" href="/tags/pxe/">pxe</a> <a class="post-tag btn btn-outline-primary" href="/tags/wifi/">wifi</a> <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">prometheus</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/another-openwrt-configuration/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1327705200" data-df="ll" > Jan 28, 2012 </time><h4 class="pt-0 my-2">Another OpenWrt configuration</h4><div class="text-muted"><p>Configure OpenWrt with extroot, DDNS, iodine DNS tunneling, nodogsplash captive portal, and collectd monitoring</p></div></div></a></article><article class="col"> <a href="/posts/tp-link-tl-wr1043nd-and-openwrt-1209-with-two-ssids-multissid-private-and-guest/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1375480800" data-df="ll" > Aug 3, 2013 </time><h4 class="pt-0 my-2">TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest</h4><div class="text-muted"><p>TP-Link TL-WR1043ND and OpenWrt 12.09 with two SSIDs (MultiSSID) - private and guest</p></div></div></a></article><article class="col"> <a href="/posts/openwrt-with-transmission-samba-and-vsftpd/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1291158000" data-df="ll" > Dec 1, 2010 </time><h4 class="pt-0 my-2">OpenWrt with Transmission, Samba and vsftpd</h4><div class="text-muted"><p>Compile and configure OpenWrt on TP-Link TL-WR1043ND with Transmission, Samba, vsftpd, and monitoring</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/update-offline-centos-rhel-server/" class="btn btn-outline-primary" aria-label="Older" ><p>Update offline CentOS-RHEL server</p></a> <a href="/posts/another-openwrt-configuration/" class="btn btn-outline-primary" aria-label="Newer" ><p>Another OpenWrt configuration</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2026</time> <a href="https://twitter.com/Ruzicka_Petr">Petr Ruzicka</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon-eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/bash/">bash</a> <a class="post-tag btn btn-outline-primary" href="/tags/pxe/">pxe</a> <a class="post-tag btn btn-outline-primary" href="/tags/wifi/">wifi</a> <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">prometheus</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ruzickap/ruzickap.github.io', 'data-repo-id': 'R_kgDOGkp4nQ', 'data-category': 'General', 'data-category-id': 'DIC_kwDOGkp4nc4CSdu1', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
