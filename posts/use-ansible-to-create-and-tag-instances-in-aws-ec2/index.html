<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Use Ansible to create and tag Instances in AWS (EC2)" /><meta name="author" content="Petr Ruzicka" /><meta property="og:locale" content="en" /><meta name="description" content="Use Ansible to create and tag Instances in AWS (EC2)" /><meta property="og:description" content="Use Ansible to create and tag Instances in AWS (EC2)" /><link rel="canonical" href="https://ruzickap.github.io/posts/use-ansible-to-create-and-tag-instances-in-aws-ec2/" /><meta property="og:url" content="https://ruzickap.github.io/posts/use-ansible-to-create-and-tag-instances-in-aws-ec2/" /><meta property="og:site_name" content="Petr’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-02-16T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Use Ansible to create and tag Instances in AWS (EC2)" /><meta name="twitter:site" content="@Ruzicka_Petr" /><meta name="twitter:creator" content="@Ruzicka_Petr" /><meta name="google-site-verification" content="4ugGShJoiB9veoPwFcMsMjzk-1BYbi5ozcSnovkBWtA" /><meta name="msvalidate.01" content="592AB158E3F9EF887F8DC8E69A2FF754" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Petr Ruzicka","url":"https://petr.ruzicka.dev"},"dateModified":"2026-01-17T19:48:44+01:00","datePublished":"2017-02-16T00:00:00+01:00","description":"Use Ansible to create and tag Instances in AWS (EC2)","headline":"Use Ansible to create and tag Instances in AWS (EC2)","mainEntityOfPage":{"@type":"WebPage","@id":"https://ruzickap.github.io/posts/use-ansible-to-create-and-tag-instances-in-aws-ec2/"},"url":"https://ruzickap.github.io/posts/use-ansible-to-create-and-tag-instances-in-aws-ec2/"}</script><title>Use Ansible to create and tag Instances in AWS (EC2) | Petr's Blog</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> document.addEventListener('DOMContentLoaded', () => { const pv = document.getElementById('pageviews'); if (pv !== null) { const uri = location.pathname.replace(/\/$/, ''); const url = `https://ruzickap-github-io.goatcounter.com/counter/${encodeURIComponent(uri)}.json`; fetch(url) .then((response) => response.json()) .then((data) => { const count = data.count.replace(/\D/g, ''); pv.innerText = new Intl.NumberFormat().format(count); }) .catch((error) => { pv.innerText = '1'; }); } }); </script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-64WRCWDZM8"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-64WRCWDZM8'); }); </script> <script async src="https://gc.zgo.at/count.js" data-goatcounter="https://ruzickap-github-io.goatcounter.com/count" ></script> <script defer src="https://cloud.umami.is/script.js" data-website-id="380ea41a-7d5f-4423-8e13-03151bde195f" ></script> <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "ad8c64404e1e41dba184019564cf11bb"}' ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://0.gravatar.com/avatar/5484c0fd9f98e2ffd9212b158931bf4b?s=200" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Petr's Blog</a><p class="site-subtitle fst-italic mb-0">DevOps • GitOps • K8s</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-project-diagram"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/ruzickap" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['petr.ruzicka','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://petr.ruzicka.dev" aria-label="homepage" target="_blank" rel="noopener noreferrer" > <i class="fas fa-home"></i> </a> <a href="https://mastodon.social/@petr_ruzicka" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Use Ansible to create and tag Instances in AWS (EC2)</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="false"><header><h1 data-toc-skip>Use Ansible to create and tag Instances in AWS (EC2)</h1><p class="post-desc fw-light mb-4">Use Ansible to create and tag Instances in AWS (EC2)</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1487199600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 16, 2017 </time> </span> <span> Updated <time data-ts="1768675724" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 17, 2026 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://petr.ruzicka.dev">Petr Ruzicka</a> </em> </span><div> <span> <em id="pageviews"> <i class="fas fa-spinner fa-spin small"></i> </em> views </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="797 words" > <em>4 min</em> read</span></div></div></div></header><div class="content"><blockquote class="prompt-info"><p>Original post from <a href="https://linux.xvx.cz/2017/02/use-ansible-to-create-and-tag-instances.html">linux.xvx.cz</a></p></blockquote><p>It may be handy to quickly create a few instances for testing in AWS.</p><p>For such a case I’m using a simple Ansible playbook which can deploy a few CentOS 7 instances, configure disks, tags volumes and instances and install public ssh key to root for example.</p><p><a href="/assets/img/posts/2017/2017-02-16-use-ansible-to-create-and-tag-instances-in-aws-ec2/Screenshot_20170216_154501.avif" class="popup img-link shimmer"><img src="/assets/img/posts/2017/2017-02-16-use-ansible-to-create-and-tag-instances-in-aws-ec2/Screenshot_20170216_154501.avif" alt="AWS EC2 Console showing instances" loading="lazy"></a> <em>AWS Console</em></p><p>Here is the playbook:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
</pre><td class="rouge-code"><pre><span class="nn">---</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create Instance in AWS</span>
  <span class="na">hosts</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">connection</span><span class="pi">:</span> <span class="s">local</span>
  <span class="na">gather_facts</span><span class="pi">:</span> <span class="kc">false</span>

  <span class="na">vars</span><span class="pi">:</span>
    <span class="na">aws_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">xxxxxx"</span>
    <span class="na">aws_secret_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">xxxxxx"</span>
    <span class="na">security_token</span><span class="pi">:</span> <span class="s2">"</span><span class="s">xxxxxx"</span>
    <span class="na">aws_instance_type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">t2.nano"</span>
    <span class="na">aws_region</span><span class="pi">:</span> <span class="s2">"</span><span class="s">us-east-1"</span>
    <span class="na">aws_security_group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">All</span><span class="nv"> </span><span class="s">Ports"</span>
    <span class="na">aws_ami_owner</span><span class="pi">:</span> <span class="s2">"</span><span class="s">099720109477"</span>
    <span class="na">aws_key_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ruzickap"</span>
    <span class="na">aws_instance_initiated_shutdown_behavior</span><span class="pi">:</span> <span class="s2">"</span><span class="s">terminate"</span>
    <span class="na">aws_instances_count</span><span class="pi">:</span> <span class="m">3</span>
    <span class="na">site_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ruzickap-test"</span>
    <span class="na">aws_tags</span><span class="pi">:</span>
      <span class="na">Name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">site_name</span><span class="nv"> </span><span class="s">}}"</span>
      <span class="na">Application</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">site_name</span><span class="nv"> </span><span class="s">}}"</span>
      <span class="na">Environment</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Development"</span>
      <span class="na">Costcenter</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1xxxxxxx3"</span>
      <span class="na">Division</span><span class="pi">:</span> <span class="s2">"</span><span class="s">My"</span>
      <span class="na">Consumer</span><span class="pi">:</span> <span class="s2">"</span><span class="s">petr.ruzicka@gmail.com"</span>

  <span class="na">tasks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Search for the latest CentOS AMI</span>
      <span class="na">shell</span><span class="pi">:</span> <span class="s">aws ec2 describe-images --region {{ aws_region }} --owners aws-marketplace --output text --filters "Name=product-code,Values=aw0evgkw8e5c1q413zgy5pjce" "Name=virtualization-type,Values=hvm" --query 'sort_by(Images, &amp;CreationDate)[-1].[ImageId]' --output 'text'</span>
      <span class="na">changed_when</span><span class="pi">:</span> <span class="s">False</span>
      <span class="na">register</span><span class="pi">:</span> <span class="s">centos_ami_id</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get Private Subnets in VPC</span>
      <span class="na">ec2_vpc_subnet_facts</span><span class="pi">:</span>
        <span class="na">aws_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_access_key</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">aws_secret_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_secret_key</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">security_token</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">access_token</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">region</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_region</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">filters</span><span class="pi">:</span>
          <span class="s2">"</span><span class="s">tag:Type"</span><span class="err">:</span> <span class="s">Private</span>
      <span class="na">register</span><span class="pi">:</span> <span class="s">ec2_vpc_subnet_facts</span>

    <span class="pi">-</span> <span class="na">debug</span><span class="pi">:</span> <span class="s2">"</span><span class="s">msg='name:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_vpc_subnet_facts.subnets[0].tags.Name</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">subnet_id:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_vpc_subnet_facts.subnets[0].id</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">cidr_block:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_vpc_subnet_facts.subnets[0].cidr_block</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">region:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_region</span><span class="nv"> </span><span class="s">}}'"</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create an EC2 instance</span>
      <span class="na">ec2</span><span class="pi">:</span>
        <span class="na">aws_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_access_key</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">aws_secret_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_secret_key</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">security_token</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">access_token</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">region</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_region</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">key_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_key_name</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">instance_type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_instance_type</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">centos_ami_id.stdout</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">instance_tags</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_tags</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">user_data</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">#!/bin/bash</span>
          <span class="s">echo "Defaults:centos !requiretty" &gt; /etc/sudoers.d/disable_requiretty</span>
          <span class="s">yum upgrade -y yum</span>
        <span class="na">wait</span><span class="pi">:</span> <span class="s">yes</span>
        <span class="na">exact_count</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_instances_count</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">count_tag</span><span class="pi">:</span>
          <span class="na">Application</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_tags.Application</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_security_group</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">vpc_subnet_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_vpc_subnet_facts.subnets[0].id</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">instance_initiated_shutdown_behavior</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_instance_initiated_shutdown_behavior</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">volumes</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">device_name</span><span class="pi">:</span> <span class="s">/dev/sda1</span>
            <span class="na">volume_type</span><span class="pi">:</span> <span class="s">gp2</span>
            <span class="na">volume_size</span><span class="pi">:</span> <span class="m">9</span>
            <span class="na">delete_on_termination</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="pi">-</span> <span class="na">device_name</span><span class="pi">:</span> <span class="s">/dev/sdb</span>
            <span class="na">volume_type</span><span class="pi">:</span> <span class="s">standard</span>
            <span class="na">volume_size</span><span class="pi">:</span> <span class="m">1</span>
            <span class="na">delete_on_termination</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">register</span><span class="pi">:</span> <span class="s">ec2_instances</span>

    <span class="pi">-</span> <span class="na">block</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set name tag for AWS instances</span>
        <span class="na">ec2_tag</span><span class="pi">:</span>
          <span class="na">aws_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_access_key</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">aws_secret_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_secret_key</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">security_token</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">access_token</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">region</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_region</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">resource</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">item.1.id</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">tags</span><span class="pi">:</span>
            <span class="na">Name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_tags.Name</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">'%02d'</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">format(item.0</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">1)</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">with_indexed_items</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_instances.instances</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">loop_control</span><span class="pi">:</span>
          <span class="na">label</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">item.1.id</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_tags.Name</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">'%02d'</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">format(item.0</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">1)</span><span class="nv"> </span><span class="s">}}"</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get volumes ids</span>
        <span class="na">ec2_vol</span><span class="pi">:</span>
          <span class="na">aws_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_access_key</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">aws_secret_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_secret_key</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">security_token</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">access_token</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">region</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_region</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">instance</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">state</span><span class="pi">:</span> <span class="s">list</span>
        <span class="na">with_items</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_instances.instance_ids</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">register</span><span class="pi">:</span> <span class="s">ec2_instances_volumes</span>
        <span class="na">loop_control</span><span class="pi">:</span>
          <span class="na">label</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}"</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Tag volumes</span>
        <span class="na">ec2_tag</span><span class="pi">:</span>
          <span class="na">aws_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_access_key</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">aws_secret_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_secret_key</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">security_token</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">access_token</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">region</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_region</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">resource</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">item.1.id</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="na">tags</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_tags</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">combine({'Instance':</span><span class="nv"> </span><span class="s">item.1.attachment_set.instance_id},</span><span class="nv"> </span><span class="s">{'Device':</span><span class="nv"> </span><span class="s">item.1.attachment_set.device})</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">with_subelements</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_instances_volumes.results</span><span class="nv"> </span><span class="s">}}"</span>
          <span class="pi">-</span> <span class="s">volumes</span>
        <span class="na">loop_control</span><span class="pi">:</span>
          <span class="na">label</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">item.1.id</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.1.attachment_set.device</span><span class="nv"> </span><span class="s">}}"</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Wait for SSH to come up</span>
        <span class="na">wait_for</span><span class="pi">:</span> <span class="s">host={{ item.private_ip }} port=22 delay=60 timeout=320 state=started</span>
        <span class="na">with_items</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_instances.instances</span><span class="nv"> </span><span class="s">}}'</span>
        <span class="na">loop_control</span><span class="pi">:</span>
          <span class="na">label</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">item.id</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.private_ip</span><span class="nv"> </span><span class="s">}}"</span>

      <span class="na">when</span><span class="pi">:</span> <span class="s">ec2_instances.changed</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Gather EC2 facts</span>
      <span class="na">ec2_remote_facts</span><span class="pi">:</span>
        <span class="na">aws_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_access_key</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">aws_secret_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_secret_key</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">security_token</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">access_token</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">region</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">aws_region</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">filters</span><span class="pi">:</span>
          <span class="na">instance-state-name</span><span class="pi">:</span> <span class="s">running</span>
          <span class="s2">"</span><span class="s">tag:Application"</span><span class="err">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">site_name</span><span class="nv"> </span><span class="s">}}"</span>
      <span class="na">register</span><span class="pi">:</span> <span class="s">ec2_facts</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Add AWS hosts to groups</span>
      <span class="na">add_host</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">item.tags.Name</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">ansible_ssh_host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">item.private_ip_address</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="na">groups</span><span class="pi">:</span> <span class="s">ec2_hosts</span>
        <span class="na">site_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">site_name</span><span class="nv"> </span><span class="s">}}"</span>
      <span class="na">changed_when</span><span class="pi">:</span> <span class="kc">false</span>
      <span class="na">with_items</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ec2_facts.instances</span><span class="nv"> </span><span class="s">}}"</span>
      <span class="na">loop_control</span><span class="pi">:</span>
        <span class="na">label</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">item.id</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.private_ip_address</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.tags.Name</span><span class="nv"> </span><span class="s">}}"</span>


<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install newly created machines</span>
  <span class="na">hosts</span><span class="pi">:</span> <span class="s">ec2_hosts</span>
  <span class="na">any_errors_fatal</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">remote_user</span><span class="pi">:</span> <span class="s">centos</span>
  <span class="na">become</span><span class="pi">:</span> <span class="s">yes</span>

  <span class="na">tasks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set hostname</span>
      <span class="na">hostname</span><span class="pi">:</span> <span class="s">name={{ inventory_hostname }}</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build hosts file</span>
      <span class="na">lineinfile</span><span class="pi">:</span> <span class="s">dest=/etc/hosts regexp='{{ item }}' line="{{ hostvars[item].ansible_default_ipv4.address }} {{ item }}"</span>
      <span class="na">when</span><span class="pi">:</span> <span class="s">hostvars[item].ansible_default_ipv4.address is defined</span>
      <span class="na">with_items</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">groups['ec2_hosts']</span><span class="nv"> </span><span class="s">}}"</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Add SSH key to root</span>
      <span class="na">authorized_key</span><span class="pi">:</span> <span class="s">user=root key="{{ lookup('file', item) }}"</span>
      <span class="na">with_items</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">~/.ssh/id_rsa.pub</span>
      <span class="na">tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">ssh_keys</span>
</pre></table></code></div></div><p>You can easily run it using:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ansible-playbook <span class="nt">-i</span> <span class="s2">"127.0.0.1,"</span> site_aws.yml
</pre></table></code></div></div><p>I hope some parts will be handy…</p><p>Enjoy :-)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/cloud/">Cloud</a>, <a href="/categories/devops/">DevOps</a>, <a href="/categories/linux-xvx-cz/">linux.xvx.cz</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ec2/" class="post-tag no-text-decoration" >ec2</a> <a href="/tags/ansible/" class="post-tag no-text-decoration" >ansible</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Use%20Ansible%20to%20create%20and%20tag%20Instances%20in%20AWS%20(EC2)%20-%20Petr's%20Blog&url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fuse-ansible-to-create-and-tag-instances-in-aws-ec2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Use%20Ansible%20to%20create%20and%20tag%20Instances%20in%20AWS%20(EC2)%20-%20Petr's%20Blog&u=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fuse-ansible-to-create-and-tag-instances-in-aws-ec2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fuse-ansible-to-create-and-tag-instances-in-aws-ec2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <script defer type="module" src="https://cdn.jsdelivr.net/npm/@justinribeiro/share-to-mastodon/+esm"></script> <button class="btn text-start" data-bs-toggle="tooltip" data-bs-placement="top" title="Mastodon" aria-label="Mastodon"> <share-to-mastodon class="share-mastodon" message="Use%20Ansible%20to%20create%20and%20tag%20Instances%20in%20AWS%20(EC2)%20-%20Petr's%20Blog" url="https%3A%2F%2Fruzickap.github.io%2Fposts%2Fuse-ansible-to-create-and-tag-instances-in-aws-ec2%2F"customInstanceList="[{&quot;label&quot;:&quot;mastodon.social&quot;,&quot;link&quot;:&quot;https://mastodon.social/&quot;},{&quot;label&quot;:&quot;mastodon.online&quot;,&quot;link&quot;:&quot;https://mastodon.online/&quot;},{&quot;label&quot;:&quot;fosstodon.org&quot;,&quot;link&quot;:&quot;https://fosstodon.org/&quot;},{&quot;label&quot;:&quot;photog.social&quot;,&quot;link&quot;:&quot;https://photog.social/&quot;}]" > <i class="fa-fw fa-brands fa-mastodon"></i> </share-to-mastodon> </button> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/installtion-f5-bigip-virtual-edition-to-rhel7/">Installation F5 BIGIP Virtual Edition to RHEL7</a><li class="text-truncate lh-lg"> <a href="/posts/detect-a-hacker-attacks-eks-vm/">Detect the hacker attacks on Amazon EKS and EC2 instances</a><li class="text-truncate lh-lg"> <a href="/posts/secure-cheap-amazon-eks-auto/">Build secure and cheap Amazon EKS Auto Mode</a><li class="text-truncate lh-lg"> <a href="/posts/eks-auto-cert-manager-velero/">Amazon EKS Auto Mode with cert-manager and Velero</a><li class="text-truncate lh-lg"> <a href="/posts/mcp-servers-k8s/">MCP Servers running on Kubernetes</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon-eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/bash/">bash</a> <a class="post-tag btn btn-outline-primary" href="/tags/pxe/">pxe</a> <a class="post-tag btn btn-outline-primary" href="/tags/wifi/">wifi</a> <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">prometheus</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/provision-windows-server-2016-in-aws-using-ansible-via-cloudformation/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1486940400" data-df="ll" > Feb 13, 2017 </time><h4 class="pt-0 my-2">Provision Windows Server 2016 in AWS using Ansible via CloudFormation</h4><div class="text-muted"><p>Provision Windows Server 2016 in AWS using Ansible via CloudFormation</p></div></div></a></article><article class="col"> <a href="/posts/create-windows-image-using-packer-and-ansible-and-then-run-it-in-vagrant-libvirt/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1508796000" data-df="ll" > Oct 24, 2017 </time><h4 class="pt-0 my-2">Create Windows image using Packer and Ansible and then run it in Vagrant (libvirt)</h4><div class="text-muted"><p>Create Windows image using Packer and Ansible and then run it in Vagrant (libvirt)</p></div></div></a></article><article class="col"> <a href="/posts/detect-a-hacker-attacks-eks-vm/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1720303200" data-df="ll" > Jul 7, 2024 </time><h4 class="pt-0 my-2">Detect the hacker attacks on Amazon EKS and EC2 instances</h4><div class="text-muted"><p>Use the security tools to detect the hacker attacks on Amazon EKS and EC2 instances</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/provision-windows-server-2016-in-aws-using-ansible-via-cloudformation/" class="btn btn-outline-primary" aria-label="Older" ><p>Provision Windows Server 2016 in AWS using Ansible via CloudFormation</p></a> <a href="/posts/how-to-build-pxe-fedora-26-live-image/" class="btn btn-outline-primary" aria-label="Newer" ><p>How-to build PXE Fedora 26 live image</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2026</time> <a href="https://twitter.com/Ruzicka_Petr">Petr Ruzicka</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon-eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/bash/">bash</a> <a class="post-tag btn btn-outline-primary" href="/tags/pxe/">pxe</a> <a class="post-tag btn btn-outline-primary" href="/tags/wifi/">wifi</a> <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">prometheus</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ruzickap/ruzickap.github.io', 'data-repo-id': 'R_kgDOGkp4nQ', 'data-category': 'General', 'data-category-id': 'DIC_kwDOGkp4nc4CSdu1', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
