<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Trivy Operator Dashboard in Grafana" /><meta name="author" content="Petr Ruzicka" /><meta property="og:locale" content="en" /><meta name="description" content="Deploy Trivy Operator and Grafana Dashboard" /><meta property="og:description" content="Deploy Trivy Operator and Grafana Dashboard" /><link rel="canonical" href="https://ruzickap.github.io/posts/trivy-operator-grafana/" /><meta property="og:url" content="https://ruzickap.github.io/posts/trivy-operator-grafana/" /><meta property="og:site_name" content="Petr’s Blog" /><meta property="og:image" content="https://raw.githubusercontent.com/aquasecurity/trivy-vscode-extension/02fa1bf2b5e1333647ebd1bced679f4e94f8bf39/media/trivy.svg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-03-08T00:00:00+01:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://raw.githubusercontent.com/aquasecurity/trivy-vscode-extension/02fa1bf2b5e1333647ebd1bced679f4e94f8bf39/media/trivy.svg" /><meta property="twitter:title" content="Trivy Operator Dashboard in Grafana" /><meta name="twitter:site" content="@Ruzicka_Petr" /><meta name="twitter:creator" content="@Ruzicka_Petr" /><meta name="google-site-verification" content="4ugGShJoiB9veoPwFcMsMjzk-1BYbi5ozcSnovkBWtA" /><meta name="msvalidate.01" content="592AB158E3F9EF887F8DC8E69A2FF754" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Petr Ruzicka","url":"https://petr.ruzicka.dev"},"dateModified":"2025-06-11T16:18:06+02:00","datePublished":"2023-03-08T00:00:00+01:00","description":"Deploy Trivy Operator and Grafana Dashboard","headline":"Trivy Operator Dashboard in Grafana","image":"https://raw.githubusercontent.com/aquasecurity/trivy-vscode-extension/02fa1bf2b5e1333647ebd1bced679f4e94f8bf39/media/trivy.svg","mainEntityOfPage":{"@type":"WebPage","@id":"https://ruzickap.github.io/posts/trivy-operator-grafana/"},"url":"https://ruzickap.github.io/posts/trivy-operator-grafana/"}</script><title>Trivy Operator Dashboard in Grafana | Petr's Blog</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> document.addEventListener('DOMContentLoaded', () => { const pv = document.getElementById('pageviews'); if (pv !== null) { const uri = location.pathname.replace(/\/$/, ''); const url = `https://ruzickap-github-io.goatcounter.com/counter/${encodeURIComponent(uri)}.json`; fetch(url) .then((response) => response.json()) .then((data) => { const count = data.count.replace(/\D/g, ''); pv.innerText = new Intl.NumberFormat().format(count); }) .catch((error) => { pv.innerText = '1'; }); } }); </script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-64WRCWDZM8"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-64WRCWDZM8'); }); </script> <script async src="https://gc.zgo.at/count.js" data-goatcounter="https://ruzickap-github-io.goatcounter.com/count" ></script> <script defer src="https://cloud.umami.is/script.js" data-website-id="380ea41a-7d5f-4423-8e13-03151bde195f" ></script> <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "3ppVAbe7E50OYFNqyhCNM1wmS_uQ1FrH5PHYn9d-"}' ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://0.gravatar.com/avatar/5484c0fd9f98e2ffd9212b158931bf4b?s=200" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Petr's Blog</a><p class="site-subtitle fst-italic mb-0">DevOps • GitOps • K8s</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-project-diagram"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/ruzickap" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['petr.ruzicka','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/petrruzicka/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="https://petr.ruzicka.dev" aria-label="homepage" target="_blank" rel="noopener noreferrer" > <i class="fas fa-home"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Trivy Operator Dashboard in Grafana</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Trivy Operator Dashboard in Grafana</h1><p class="post-desc fw-light mb-4">Deploy Trivy Operator and Grafana Dashboard</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1678230000" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 8, 2023 </time> </span> <span> Updated <time data-ts="1749651486" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jun 11, 2025 </time> </span><div class="mt-3 mb-3"> <a href="https://raw.githubusercontent.com/aquasecurity/trivy-vscode-extension/02fa1bf2b5e1333647ebd1bced679f4e94f8bf39/media/trivy.svg" class="popup img-link preview-img shimmer"><img src="https://raw.githubusercontent.com/aquasecurity/trivy-vscode-extension/02fa1bf2b5e1333647ebd1bced679f4e94f8bf39/media/trivy.svg" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://petr.ruzicka.dev">Petr Ruzicka</a> </em> </span><div> <span> <em id="pageviews"> <i class="fas fa-spinner fa-spin small"></i> </em> views </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="5082 words" > <em>28 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Trivy Operator Dashboard in Grafana</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Trivy Operator Dashboard in Grafana</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>In a previous post, “<a href="/posts/cheapest-amazon-eks/">Cheapest Amazon EKS</a>”, I installed the <a href="https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack">kube-prometheus-stack</a> to enable cluster monitoring, which includes <a href="https://grafana.com/">Grafana</a>, <a href="https://prometheus.io/">Prometheus</a>, and a few other components.</p><p>Many tools allow you to scan container images and display their vulnerabilities, such as <a href="https://trivy.dev/">Trivy</a>, <a href="https://github.com/anchore/grype">Grype</a>, or <a href="https://github.com/quay/clair">Clair</a>.</p><p>Unfortunately, there are not as many open-source (OSS) tools that can show vulnerabilities of container images running inside Kubernetes (K8s). This capability is usually a paid offering from third-party vendors like <a href="https://www.paloaltonetworks.com/prisma/cloud">Palo Alto Networks</a>, <a href="https://www.aquasec.com/">Aqua Security</a>, <a href="https://www.wiz.io/">Wiz</a>, and many others.</p><p>Let’s look at the <a href="https://github.com/aquasecurity/trivy-operator">Trivy Operator</a>, which can help you build your Kubernetes cluster’s security posture (covering Compliance, Vulnerabilities, RBAC, and more).</p><p>I’ll walk you through the installation process, its integration with Prometheus and Grafana, and some examples to help you better understand how it works.</p><p>Links:</p><ul><li><a href="https://aquasecurity.github.io/trivy-operator/v0.12.0/tutorials/grafana-dashboard/">Trivy Operator Dashboard in Grafana</a><li><a href="https://blog.aquasec.com/kubernetes-benchmark-scans-trivy-cis-nsa-reports">Kubernetes Benchmark Scans with Trivy: CIS and NSA Reports</a></ul><h2 id="requirements"><span class="me-2">Requirements</span><a href="#requirements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>An Amazon EKS cluster with the <a href="https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack">kube-prometheus-stack</a> installed (as described in “<a href="/posts/cheapest-amazon-eks/">Cheapest Amazon EKS</a>)”<li><a href="https://helm.sh">Helm</a></ul><p>The following variables are used in the subsequent steps:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">AWS_DEFAULT_REGION</span><span class="k">:-</span><span class="nv">us</span><span class="p">-east-1</span><span class="k">}</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">CLUSTER_FQDN</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">CLUSTER_FQDN</span><span class="k">:-</span><span class="nv">k01</span><span class="p">.k8s.mylabs.dev</span><span class="k">}</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">CLUSTER_NAME</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">CLUSTER_FQDN</span><span class="p">%%.*</span><span class="k">}</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">TMP_DIR</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">:-${</span><span class="nv">PWD</span><span class="k">}}</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">KUBECONFIG</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">KUBECONFIG</span><span class="k">:-${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="p">/</span><span class="k">${</span><span class="nv">CLUSTER_FQDN</span><span class="k">}</span><span class="p">/kubeconfig-</span><span class="k">${</span><span class="nv">CLUSTER_NAME</span><span class="k">}</span><span class="p">.conf</span><span class="k">}</span><span class="s2">"</span>

<span class="nb">mkdir</span> <span class="nt">-pv</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">CLUSTER_FQDN</span><span class="k">}</span><span class="s2">"</span>
</pre></table></code></div></div><h2 id="install-trivy-operator"><span class="me-2">Install Trivy Operator</span><a href="#install-trivy-operator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Install the <code class="language-plaintext highlighter-rouge">trivy-operator</code> <a href="https://artifacthub.io/packages/helm/trivy-operator/trivy-operator">Helm chart</a> and modify its <a href="https://github.com/aquasecurity/trivy-operator/blob/main/deploy/helm/values.yaml">default values</a>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c"># renovate: datasource=helm depName=trivy-operator registryUrl=https://aquasecurity.github.io/helm-charts/</span>
<span class="nv">TRIVY_OPERATOR_HELM_CHART_VERSION</span><span class="o">=</span><span class="s2">"0.20.6"</span>

helm repo add <span class="nt">--force-update</span> aqua https://aquasecurity.github.io/helm-charts/
<span class="nb">cat</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">CLUSTER_FQDN</span><span class="k">}</span><span class="s2">/helm_values-trivy-operator.yml"</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
serviceMonitor:
  enabled: true
trivy:
  ignoreUnfixed: true
</span><span class="no">EOF
</span>helm upgrade <span class="nt">--install</span> <span class="nt">--version</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TRIVY_OPERATOR_HELM_CHART_VERSION</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--namespace</span> trivy-system <span class="nt">--create-namespace</span> <span class="nt">--wait</span> <span class="nt">--values</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">CLUSTER_FQDN</span><span class="k">}</span><span class="s2">/helm_values-trivy-operator.yml"</span> trivy-operator aqua/trivy-operator
</pre></table></code></div></div><p><a href="https://raw.githubusercontent.com/aquasecurity/trivy-operator/e5722da903ff16d5fd926ed46fdffacf5d50d9b5/docs/images/trivy-operator-logo.png" class="popup img-link shimmer"><img src="https://raw.githubusercontent.com/aquasecurity/trivy-operator/e5722da903ff16d5fd926ed46fdffacf5d50d9b5/docs/images/trivy-operator-logo.png" alt="trivy-operator" width="500" loading="lazy"></a></p><p>Once the Helm chart is installed, you can see the trivy-operator initiating scans:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get pods <span class="nt">-n</span> trivy-system
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="go">NAME                                        READY   STATUS      RESTARTS   AGE
node-collector-7555455fcf-q4dp6             0/1     Completed   0          11s
node-collector-7f544b4779-7p5zr             0/1     Completed   0          11s
scan-vulnerabilityreport-55bc49bd77-nr5br   0/2     Init:0/1    0          9s
scan-vulnerabilityreport-594f6f446-v64sp    0/1     Init:0/1    0          2s
scan-vulnerabilityreport-65cd458f97-6zbs8   0/3     Init:0/1    0          4s
scan-vulnerabilityreport-6d9888f48-vrtxg    0/4     Init:0/1    0          2s
scan-vulnerabilityreport-74b9cf67dd-mpqgj   0/1     Init:0/1    0          11s
scan-vulnerabilityreport-77875c6784-vwkv2   0/1     Init:0/1    0          1s
scan-vulnerabilityreport-7bd5758c7b-5wjqq   0/1     Init:0/1    0          8s
scan-vulnerabilityreport-7dc9c49c47-gfrlk   0/3     Init:0/1    0          6s
scan-vulnerabilityreport-978494f65-ggd8g    0/3     Init:0/1    0          7s
scan-vulnerabilityreport-c7b7fbfdd-284zv    0/1     Init:0/1    0          5s
trivy-operator-56bdc96f8-dls8c              1/1     Running     0          15s
</span></pre></table></code></div></div><h2 id="trivy-operator-details"><span class="me-2">Trivy Operator details</span><a href="#trivy-operator-details" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s look at some examples to see how the <a href="https://github.com/aquasecurity/trivy-operator">Trivy Operator</a> can help identify security issues in a Kubernetes cluster.</p><blockquote class="prompt-warning"><p>The outputs below were generated on 2023-03-12 and will differ in the future.</p></blockquote><h3 id="vulnerability-reports"><span class="me-2">Vulnerability Reports</span><a href="#vulnerability-reports" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Deploy a vulnerable (old) version of <a href="https://hub.docker.com/layers/library/nginx/1.22.0/images/sha256-b3a676a9145dc005062d5e79b92d90574fb3bf2396f4913dc1732f9065f55c4b?context=explore">nginx:1.22.0</a> to the cluster:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>kubectl create namespace test-trivy1
kubectl run nginx <span class="nt">--namespace</span><span class="o">=</span>test-trivy1 <span class="nt">--image</span><span class="o">=</span>nginx:1.22.0

<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"Waiting for trivy-operator to create VulnerabilityReports: "</span>
<span class="k">until </span>kubectl get vulnerabilityreports <span class="nt">-n</span> test-trivy1 <span class="nt">-o</span> go-template<span class="o">=</span><span class="s1">'{{.items | len}}'</span> | <span class="nb">grep</span> <span class="nt">-qxF</span> 1<span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"."</span>
  <span class="nb">sleep </span>3
<span class="k">done</span>
</pre></table></code></div></div><p>View a summary of the container image vulnerabilities present in the old version of nginx:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get vulnerabilityreports <span class="nt">-n</span> test-trivy1 <span class="nt">-o</span> wide
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">NAME              REPOSITORY      TAG      SCANNER   AGE     CRITICAL   HIGH   MEDIUM   LOW   UNKNOWN
pod-nginx-nginx   library/nginx   1.22.0   Trivy     4m33s   3          18     39       0     0
</span></pre></table></code></div></div><p>Examine the <a href="https://aquasecurity.github.io/trivy-operator/v0.12.0/docs/crds/vulnerability-report/">VulnerabilityReports</a>, which represent the latest vulnerabilities found in a container image of a given Kubernetes workload. Each report consists of a list of OS package and application vulnerabilities, with a summary of vulnerabilities grouped by severity.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl describe vulnerabilityreports <span class="nt">-n</span> test-trivy1
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre><td class="rouge-code"><pre><span class="go">Name:         pod-nginx-nginx
Namespace:    test-trivy1
Labels:       resource-spec-hash=5b79d7b777
              trivy-operator.container.name=nginx
              trivy-operator.resource.kind=Pod
              trivy-operator.resource.name=nginx
              trivy-operator.resource.namespace=test-trivy1
Annotations:  trivy-operator.aquasecurity.github.io/report-ttl: 24h0m0s
API Version:  aquasecurity.github.io/v1alpha1
Kind:         VulnerabilityReport
Metadata:
  Creation Timestamp:  2023-03-14T04:28:11Z
  Generation:          1
  Managed Fields:
    API Version:  aquasecurity.github.io/v1alpha1
</span><span class="c">...
</span><span class="go">    Manager:    trivy-operator
    Operation:  Update
    Time:       2023-03-14T04:28:11Z
  Owner References:
    API Version:           v1
    Block Owner Deletion:  false
    Controller:            true
    Kind:                  Pod
    Name:                  nginx
    UID:                   c879915a-7f0a-4ac1-a507-c9c47e69aa42
  Resource Version:        114086
  UID:                     7531bd9b-2fe2-40cd-9223-280af46bebec
Report:
  Artifact:
    Repository:  library/nginx
    Tag:         1.22.0
  Registry:
    Server:  index.docker.io
  Scanner:
    Name:     Trivy
    Vendor:   Aqua Security
    Version:  0.38.2
  Summary:
    Critical Count:  3
    High Count:      18
    Low Count:       0
    Medium Count:    39
    None Count:      0
    Unknown Count:   0
  Update Timestamp:  2023-03-14T04:28:11Z
  Vulnerabilities:
    Fixed Version:      7.74.0-1.3+deb11u5
    Installed Version:  7.74.0-1.3+deb11u3
    Links:
    Primary Link:       https://avd.aquasec.com/nvd/cve-2022-32221
    Resource:           curl
    Score:              4.8
    Severity:           CRITICAL
    Target:
    Title:              curl: POST following PUT confusion
    Vulnerability ID:   CVE-2022-32221
    Fixed Version:      7.74.0-1.3+deb11u7
    Installed Version:  7.74.0-1.3+deb11u3
    Links:
    Primary Link:       https://avd.aquasec.com/nvd/cve-2023-23916
    Resource:           curl
    Score:              6.5
    Severity:           HIGH
    Target:
    Title:              curl: HTTP multi-header compression denial of service
    Vulnerability ID:   CVE-2023-23916
    Fixed Version:      7.74.0-1.3+deb11u5
    Installed Version:  7.74.0-1.3+deb11u3
    Links:
    Primary Link:       https://avd.aquasec.com/nvd/cve-2022-43552
    Resource:           curl
    Score:              5.9
    Severity:           MEDIUM
</span><span class="c">...
</span></pre></table></code></div></div><p>You can easily obtain a list of container image vulnerabilities for the entire cluster:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get vulnerabilityreports <span class="nt">--all-namespaces</span> <span class="nt">-o</span> wide
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="go">NAMESPACE               NAME                                                              REPOSITORY                                       TAG          SCANNER   AGE   CRITICAL   HIGH   MEDIUM   LOW   UNKNOWN
cert-manager            replicaset-6bdbc5f78f                                             jetstack/cert-manager-cainjector                 v1.11.0      Trivy     12m   0          1      0        0     0
cert-manager            replicaset-cert-manager-68784d64d7-cert-manager-controller        jetstack/cert-manager-controller                 v1.11.0      Trivy     12m   0          1      0        0     0
cert-manager            replicaset-cert-manager-webhook-6787f645b9-cert-manager-webhook   jetstack/cert-manager-webhook                    v1.11.0      Trivy     13m   0          1      0        0     0
external-dns            replicaset-external-dns-58995955b-external-dns                    external-dns/external-dns                        v0.13.2      Trivy     12m   0          13     4        0     0
forecastle              replicaset-forecastle-7b645d64bf-forecastle                       stakater/forecastle                              v1.0.121     Trivy     12m   0          1      1        0     0
ingress-nginx           replicaset-ingress-nginx-controller-f958b4d8d-controller          ingress-nginx/controller                                      Trivy     12m   2          3      2        0     0
karpenter               replicaset-karpenter-565b558f9-controller                         karpenter/controller                                          Trivy     12m   0          0      0        0     0
kube-prometheus-stack   daemonset-6c9bb4f54f                                              prometheus/node-exporter                         v1.5.0       Trivy     13m   0          1      1        0     0
kube-prometheus-stack   replicaset-56c596c9bb                                             curlimages/curl                                  7.85.0       Trivy     13m   0          6      3        0     0
kube-prometheus-stack   replicaset-5b5d6f8fb8                                             kiwigrid/k8s-sidecar                             1.22.0       Trivy     13m   0          7      2        0     0
kube-prometheus-stack   replicaset-64556849bd                                             prometheus-operator/prometheus-operator          v0.63.0      Trivy     12m   0          1      1        0     0
kube-prometheus-stack   replicaset-79cd99d94                                              kiwigrid/k8s-sidecar                             1.22.0       Trivy     13m   0          7      2        0     0
kube-prometheus-stack   replicaset-d894b795d                                              kube-state-metrics/kube-state-metrics            v2.8.1       Trivy     13m   0          1      0        0     0
kube-prometheus-stack   replicaset-kube-prometheus-stack-grafana-646bc57bb6-grafana       grafana/grafana                                  9.3.8        Trivy     13m   0          2      3        0     0
kube-prometheus-stack   statefulset-55c7d87c7d                                            prometheus-operator/prometheus-config-reloader   v0.63.0      Trivy     13m   0          0      0        0     0
kube-prometheus-stack   statefulset-646865b49b                                            prometheus-operator/prometheus-config-reloader   v0.63.0      Trivy     13m   0          0      0        0     0
kube-prometheus-stack   statefulset-6547f6bbc9                                            prometheus/prometheus                            v2.42.0      Trivy     13m   0          2      0        0     0
kube-prometheus-stack   statefulset-6ddfb59cf5                                            prometheus-operator/prometheus-config-reloader   v0.63.0      Trivy     13m   0          0      0        0     0
kube-prometheus-stack   statefulset-758c4b8b8                                             prometheus/alertmanager                          v0.25.0      Trivy     13m   0          2      0        0     0
kube-system             daemonset-6b8684d996                                              aws-ec2/aws-node-termination-handler             v1.19.0      Trivy     13m   0          2      1        0     0
kube-system             replicaset-metrics-server-7df9d78f65-metrics-server               metrics-server/metrics-server                    v0.6.2       Trivy     12m   1          3      2        0     0
mailhog                 replicaset-mailhog-6f54fccf85-mailhog                             cd2team/mailhog                                  1663459324   Trivy     13m   0          6      2        0     0
oauth2-proxy            replicaset-oauth2-proxy-f5f86cd5d-oauth2-proxy                    oauth2-proxy/oauth2-proxy                        v7.4.0       Trivy     12m   0          8      3        0     0
test-trivy1             pod-nginx-nginx                                                   library/nginx                                    1.22.0       Trivy     12m   3          18     39       0     0
trivy-system            replicaset-trivy-operator-56bdc96f8-trivy-operator                aquasecurity/trivy-operator                      0.12.1       Trivy     13m   0          0      0        0     0
</span></pre></table></code></div></div><h3 id="compliance-reports"><span class="me-2">Compliance Reports</span><a href="#compliance-reports" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>I will deploy a pod with <code class="language-plaintext highlighter-rouge">hostIPC: true</code> and then examine the compliance report.</p><p>Links:</p><ul><li><a href="https://www.cisecurity.org/benchmark/kubernetes">CIS Kubernetes Benchmark</a><li><a href="https://bishopfox.com/blog/kubernetes-pod-privilege-escalation#pod7">Bad Pod #7: HOSTIPC Only</a></ul><p><a href="https://upload.wikimedia.org/wikipedia/en/2/2e/Center_for_Internet_Security_Logo.png" class="popup img-link shimmer"><img src="https://upload.wikimedia.org/wikipedia/en/2/2e/Center_for_Internet_Security_Logo.png" alt="Center for Internet Security" loading="lazy"></a> <em>Center for Internet Security</em></p><p>Here is a list of the supported Compliance Reports:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get clustercompliancereports
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="go">NAME             AGE
cis              15m
nsa              15m
pss-baseline     15m
pss-restricted   15m
</span></pre></table></code></div></div><p>We are currently interested in the <a href="https://www.cisecurity.org/benchmark/kubernetes">CIS Kubernetes Benchmark</a> and specifically the control to “<a href="https://github.com/aquasecurity/kube-bench/blob/7aeb6c39774763e74979a0904e374df01844bf21/cfg/cis-1.20/policies.yaml">Minimize the admission of containers wishing to share the host IPC namespace</a>”:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get clustercompliancereports cis <span class="nt">-o</span> json | jq <span class="s1">'.spec.compliance.controls[] | select(.name=="Minimize the admission of containers wishing to share the host IPC namespace")'</span>
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"checks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AVD-KSV-0008"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Do not generally permit containers to be run with the hostIPC flag set to true"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5.2.4"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Minimize the admission of containers wishing to share the host IPC namespace"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"severity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HIGH"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>Let’s create a new namespace with a pod that has the <code class="language-plaintext highlighter-rouge">hostIPC: true</code> parameter present in its Kubernetes YAML manifest:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre>kubectl create namespace test-trivy2
kubectl apply <span class="nt">--namespace</span><span class="o">=</span>test-trivy2 <span class="nt">-f</span> - <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
apiVersion: v1
kind: Pod
metadata:
  name: hostipc-exec-pod
  labels:
    app: pentest
spec:
  automountServiceAccountToken: false
  hostIPC: true                            # &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; This is the security issue
  containers:
  - name: hostipc-pod
    image: k8s.gcr.io/pause:3.6
    resources:
      requests:
        memory: "1Mi"
        cpu: "1m"
      limits:
        memory: "16Mi"
        cpu: "20m"
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - ALL
      readOnlyRootFilesystem: true
      runAsGroup: 30000
      runAsNonRoot: true
      runAsUser: 20000
      seccompProfile:
        type: RuntimeDefault
</span><span class="no">EOF

</span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"Waiting for trivy-operator to create ConfigAuditReports: "</span>
<span class="k">until </span>kubectl get configauditreports <span class="nt">-n</span> test-trivy2 <span class="nt">-o</span> go-template<span class="o">=</span><span class="s1">'{{.items | len}}'</span> | <span class="nb">grep</span> <span class="nt">-qxF</span> 1<span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"."</span>
  <span class="nb">sleep </span>5
<span class="k">done</span>
</pre></table></code></div></div><p>An instance of the <a href="https://aquasecurity.github.io/trivy-operator/v0.12.0/docs/crds/configaudit-report/">ConfigAuditReports</a> resource represents checks performed by <a href="https://trivy.dev/">Trivy</a> against a Kubernetes object’s configuration.</p><p>The introduced security issue is visible in the <a href="https://aquasecurity.github.io/trivy-operator/v0.12.0/docs/crds/configaudit-report/">ConfigAuditReports</a>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl describe configauditreports <span class="nt">-n</span> test-trivy2
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="go">Name:         pod-hostipc-exec-pod
Namespace:    test-trivy2
Labels:       plugin-config-hash=659b7b9c46
              resource-spec-hash=7f9b85d646
              trivy-operator.resource.kind=Pod
              trivy-operator.resource.name=hostipc-exec-pod
              trivy-operator.resource.namespace=test-trivy2
Annotations:  trivy-operator.aquasecurity.github.io/report-ttl: 24h0m0s
API Version:  aquasecurity.github.io/v1alpha1
Kind:         ConfigAuditReport
Metadata:
  Creation Timestamp:  2023-03-14T04:41:51Z
  Generation:          2
  Managed Fields:
    API Version:  aquasecurity.github.io/v1alpha1
</span><span class="c">...
</span><span class="go">    Manager:    trivy-operator
    Operation:  Update
    Time:       2023-03-14T04:41:53Z
  Owner References:
    API Version:           v1
    Block Owner Deletion:  false
    Controller:            true
    Kind:                  Pod
    Name:                  hostipc-exec-pod
    UID:                   c1b84929-b947-452c-95b4-d1fc2f8dc11d
  Resource Version:        117561
  UID:                     5deb58ae-b18d-4c85-b757-5e877c3abeae
Report:
  Checks:
    Category:     Kubernetes Security Check
    Check ID:     KSV008
    Description:  Sharing the host's IPC namespace allows container processes to communicate with processes on the host.
    Messages:
      Pod 'hostipc-exec-pod' should not set 'spec.template.spec.hostIPC' to true
    Severity:  HIGH
    Success:   false
    Title:     Access to host IPC namespace
  Scanner:
    Name:     Trivy
    Vendor:   Aqua Security
    Version:  0.12.1
  Summary:
    Critical Count:  0
    High Count:      1
    Low Count:       0
    Medium Count:    0
  Update Timestamp:  2023-03-14T04:41:53Z
</span><span class="gp">Events:              &lt;none&gt;</span><span class="w">
</span></pre></table></code></div></div><p>As in the previous example, you can see the compliance report for the entire cluster:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get configauditreports <span class="nt">--all-namespaces</span> <span class="nt">-o</span> wide
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="go">NAMESPACE               NAME                                                             SCANNER   AGE   CRITICAL   HIGH   MEDIUM   LOW
cert-manager            replicaset-cert-manager-68784d64d7                               Trivy     16m   0          0      0        7
cert-manager            replicaset-cert-manager-cainjector-547c9b8f95                    Trivy     15m   0          0      0        7
cert-manager            replicaset-cert-manager-webhook-6787f645b9                       Trivy     14m   0          0      0        7
cert-manager            service-cert-manager                                             Trivy     14m   0          0      0        0
cert-manager            service-cert-manager-webhook                                     Trivy     15m   0          0      0        0
default                 service-kubernetes                                               Trivy     14m   0          0      0        1
external-dns            replicaset-external-dns-58995955b                                Trivy     16m   0          0      1        6
external-dns            service-external-dns                                             Trivy     15m   0          0      0        0
forecastle              replicaset-forecastle-7b645d64bf                                 Trivy     15m   0          0      2        10
forecastle              service-forecastle                                               Trivy     15m   0          0      0        0
ingress-nginx           replicaset-ingress-nginx-controller-f958b4d8d                    Trivy     15m   0          0      3        6
ingress-nginx           service-ingress-nginx-controller                                 Trivy     14m   0          0      0        0
ingress-nginx           service-ingress-nginx-controller-admission                       Trivy     15m   0          0      0        0
ingress-nginx           service-ingress-nginx-controller-metrics                         Trivy     15m   0          0      0        0
karpenter               replicaset-karpenter-565b558f9                                   Trivy     15m   0          0      2        10
karpenter               service-karpenter                                                Trivy     15m   0          0      0        0
kube-prometheus-stack   daemonset-kube-prometheus-stack-prometheus-node-exporter         Trivy     15m   0          3      2        10
kube-prometheus-stack   replicaset-kube-prometheus-stack-grafana-646bc57bb6              Trivy     14m   0          0      8        34
kube-prometheus-stack   replicaset-kube-prometheus-stack-kube-state-metrics-5979d9d98c   Trivy     16m   0          0      2        10
kube-prometheus-stack   replicaset-kube-prometheus-stack-operator-5df65d688f             Trivy     15m   0          0      0        9
kube-prometheus-stack   service-alertmanager-operated                                    Trivy     14m   0          0      0        0
kube-prometheus-stack   service-kube-prometheus-stack-alertmanager                       Trivy     16m   0          0      0        0
kube-prometheus-stack   service-kube-prometheus-stack-grafana                            Trivy     15m   0          0      0        0
kube-prometheus-stack   service-kube-prometheus-stack-kube-state-metrics                 Trivy     16m   0          0      0        0
kube-prometheus-stack   service-kube-prometheus-stack-operator                           Trivy     16m   0          0      0        0
kube-prometheus-stack   service-kube-prometheus-stack-prometheus                         Trivy     14m   0          0      0        0
kube-prometheus-stack   service-kube-prometheus-stack-prometheus-node-exporter           Trivy     14m   0          0      0        0
kube-prometheus-stack   service-prometheus-operated                                      Trivy     14m   0          0      0        0
kube-prometheus-stack   statefulset-alertmanager-kube-prometheus-stack-alertmanager      Trivy     16m   0          0      0        8
kube-prometheus-stack   statefulset-prometheus-kube-prometheus-stack-prometheus          Trivy     16m   0          0      0        11
kube-system             daemonset-aws-node                                               Trivy     16m   0          3      7        17
kube-system             daemonset-aws-node-termination-handler                           Trivy     15m   0          1      2        9
kube-system             daemonset-ebs-csi-node                                           Trivy     15m   0          1      8        12
kube-system             daemonset-ebs-csi-node-windows                                   Trivy     16m   0          0      8        14
kube-system             daemonset-kube-proxy                                             Trivy     16m   0          2      4        9
kube-system             replicaset-coredns-7975d6fb9b                                    Trivy     14m   0          0      3        5
kube-system             replicaset-ebs-csi-controller-646b59c99                          Trivy     15m   0          0      1        20
kube-system             replicaset-metrics-server-7df9d78f65                             Trivy     15m   0          0      1        9
kube-system             service-kube-dns                                                 Trivy     15m   0          0      1        0
kube-system             service-kube-prometheus-stack-coredns                            Trivy     14m   0          0      1        0
kube-system             service-kube-prometheus-stack-kubelet                            Trivy     14m   0          0      1        0
kube-system             service-metrics-server                                           Trivy     14m   0          0      1        0
mailhog                 replicaset-mailhog-6f54fccf85                                    Trivy     14m   0          0      0        7
mailhog                 service-mailhog                                                  Trivy     16m   0          0      0        0
oauth2-proxy            replicaset-oauth2-proxy-f5f86cd5d                                Trivy     15m   0          0      2        10
oauth2-proxy            service-oauth2-proxy                                             Trivy     14m   0          0      0        0
test-trivy1             pod-nginx                                                        Trivy     15m   0          0      3        10
test-trivy2             pod-hostipc-exec-pod                                             Trivy     59s   0          1      0        0
trivy-system            replicaset-trivy-operator-56bdc96f8                              Trivy     14m   0          0      1        7
trivy-system            service-trivy-operator                                           Trivy     15m   0          0      0        0
</span></pre></table></code></div></div><h3 id="exposed-secrets-report"><span class="me-2">Exposed Secrets Report</span><a href="#exposed-secrets-report" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>An <a href="https://aquasecurity.github.io/trivy-operator/v0.12.0/docs/crds/exposedsecret-report/">ExposedSecretReport</a> represents secrets found in a container image of a given Kubernetes workload.</p><p>Consider an example of a container that has SSH keys embedded within it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>kubectl create namespace test-trivy3
kubectl run ubuntu-sshd-exposed-secrets <span class="nt">--namespace</span><span class="o">=</span>test-trivy3 <span class="nt">--image</span><span class="o">=</span>peru/ubuntu_sshd <span class="nt">--overrides</span><span class="o">=</span><span class="s1">'{"spec": { "nodeSelector": {"kubernetes.io/arch": "amd64"}}}'</span>

<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"Waiting for trivy-operator to create ExposedSecretReports: "</span>
<span class="k">until </span>kubectl get exposedsecretreports <span class="nt">-n</span> test-trivy3 <span class="nt">-o</span> go-template<span class="o">=</span><span class="s1">'{{.items | len}}'</span> | <span class="nb">grep</span> <span class="nt">-qxF</span> 1<span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"."</span>
  <span class="nb">sleep </span>3
<span class="k">done</span>
</pre></table></code></div></div><p>After examining the <a href="https://aquasecurity.github.io/trivy-operator/v0.12.0/docs/crds/exposedsecret-report/">ExposedSecretReport</a> details, it should be easy to identify the problem:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl describe exposedsecretreport <span class="nt">-n</span> test-trivy3
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre><span class="go">Name:         pod-ubuntu-sshd-exposed-secrets-ubuntu-sshd-exposed-secrets
Namespace:    test-trivy3
Labels:       resource-spec-hash=b9d794b6b
              trivy-operator.container.name=ubuntu-sshd-exposed-secrets
              trivy-operator.resource.kind=Pod
              trivy-operator.resource.name=ubuntu-sshd-exposed-secrets
              trivy-operator.resource.namespace=test-trivy3
Annotations:  trivy-operator.aquasecurity.github.io/report-ttl: 24h0m0s
API Version:  aquasecurity.github.io/v1alpha1
Kind:         ExposedSecretReport
Metadata:
  Creation Timestamp:  2023-03-14T04:44:08Z
  Generation:          2
  Managed Fields:
    API Version:  aquasecurity.github.io/v1alpha1
</span><span class="c">...
</span><span class="go">    Manager:    trivy-operator
    Operation:  Update
    Time:       2023-03-14T04:44:38Z
  Owner References:
    API Version:           v1
    Block Owner Deletion:  false
    Controller:            true
    Kind:                  Pod
    Name:                  ubuntu-sshd-exposed-secrets
    UID:                   d3a57ab4-e187-4e76-8691-2a97ef293c62
  Resource Version:        118720
  UID:                     23a924b1-ac50-4cc9-957b-6b28ad504b65
Report:
  Artifact:
    Repository:  peru/ubuntu_sshd
    Tag:         latest
  Registry:
    Server:  index.docker.io
  Scanner:
    Name:     Trivy
    Vendor:   Aqua Security
    Version:  0.38.2
  Secrets:
    Category:  AsymmetricPrivateKey
    Match:     ----BEGIN RSA PRIVATE KEY-----**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************-----END RSA PRIVATE
    Rule ID:   private-key
    Severity:  HIGH
    Target:    /etc/ssh/ssh_host_rsa_key
    Title:     Asymmetric Private Key
    Category:  AsymmetricPrivateKey
    Match:     -----BEGIN EC PRIVATE KEY-----************************************************************************************************************************************************************************-----END EC PRIVATE
    Rule ID:   private-key
    Severity:  HIGH
    Target:    /etc/ssh/ssh_host_ecdsa_key
    Title:     Asymmetric Private Key
    Category:  AsymmetricPrivateKey
    Match:     BEGIN OPENSSH PRIVATE KEY-----******************************************************************************************************************************************************************************************************************************************************************************************************************************************************-----END OPENSSH PRI
    Rule ID:   private-key
    Severity:  HIGH
    Target:    /etc/ssh/ssh_host_ed25519_key
    Title:     Asymmetric Private Key
  Summary:
    Critical Count:  0
    High Count:      3
    Low Count:       0
    Medium Count:    0
  Update Timestamp:  2023-03-14T04:44:38Z
</span><span class="gp">Events:              &lt;none&gt;</span><span class="w">
</span></pre></table></code></div></div><p>A cluster-wide output will show us the complete picture of exposed secrets:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get exposedsecretreport <span class="nt">-n</span> test-trivy3 <span class="nt">-o</span> wide
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">NAME                                                          REPOSITORY         TAG      SCANNER   AGE   CRITICAL   HIGH   MEDIUM   LOW
pod-ubuntu-sshd-exposed-secrets-ubuntu-sshd-exposed-secrets   peru/ubuntu_sshd   latest   Trivy     99s   0          3      0        0
</span></pre></table></code></div></div><h3 id="rbac-assessment-report"><span class="me-2">RBAC Assessment Report</span><a href="#rbac-assessment-report" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The RBAC Assessment Report exists in two “versions” (Custom Resource Definitions - CRDs):</p><ul><li><a href="https://aquasecurity.github.io/trivy-operator/v0.12.0/docs/crds/rbacassessment-report/">RbacAssessmentReport</a><li>ClusterRbacAssessmentReport</ul><h4 id="rbacassessmentreport"><span class="me-2">RbacAssessmentReport</span><a href="#rbacassessmentreport" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Let’s consider an example with a role that allows manipulation and reading of secrets:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>kubectl create namespace test-trivy4
kubectl apply <span class="nt">--namespace</span><span class="o">=</span>test-trivy4 <span class="nt">-f</span> - <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: secret-reader
rules:
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["*"]#                              &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; This is the security issue
</span><span class="no">EOF

</span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"Waiting for trivy-operator to create RbacAssessmentReport: "</span>
<span class="k">until </span>kubectl get rbacassessmentreport <span class="nt">-n</span> test-trivy4 <span class="nt">-o</span> go-template<span class="o">=</span><span class="s1">'{{.items | len}}'</span> | <span class="nb">grep</span> <span class="nt">-qxF</span> 1<span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"."</span>
  <span class="nb">sleep </span>3
<span class="k">done</span>
</pre></table></code></div></div><p>The generated <a href="https://aquasecurity.github.io/trivy-operator/v0.12.0/docs/crds/rbacassessment-report/">RbacAssessmentReport</a> will contain a CRITICAL issue related to secret management:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl describe rbacassessmentreport <span class="nt">--namespace</span> test-trivy4
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="go">Name:         role-secret-reader
Namespace:    test-trivy4
Labels:       plugin-config-hash=659b7b9c46
              resource-spec-hash=6f775df776
              trivy-operator.resource.kind=Role
              trivy-operator.resource.name=secret-reader
              trivy-operator.resource.namespace=test-trivy4
Annotations:  trivy-operator.aquasecurity.github.io/report-ttl: 24h0m0s
API Version:  aquasecurity.github.io/v1alpha1
Kind:         RbacAssessmentReport
Metadata:
  Creation Timestamp:  2023-03-14T04:46:33Z
  Generation:          1
  Managed Fields:
    API Version:  aquasecurity.github.io/v1alpha1
</span><span class="c">...
</span><span class="go">    Manager:    trivy-operator
    Operation:  Update
    Time:       2023-03-14T04:46:33Z
  Owner References:
    API Version:           rbac.authorization.k8s.io/v1
    Block Owner Deletion:  false
    Controller:            true
    Kind:                  Role
    Name:                  secret-reader
    UID:                   d97c0dc5-6d81-440a-9bc3-6e7c3621635c
  Resource Version:        119225
  UID:                     6b9a7b0f-768e-4487-b288-538433e2045d
Report:
  Checks:
    Category:     Kubernetes Security Check
    Check ID:     KSV045
    Description:  Check whether role permits wildcard verb on specific resources
    Messages:
      Role permits wildcard verb on specific resources
    Severity:     CRITICAL
    Success:      false
    Title:        No wildcard verb roles
    Category:     Kubernetes Security Check
    Check ID:     KSV041
    Description:  Check whether role permits managing secrets
    Messages:
      Role permits management of secret(s)
    Severity:  CRITICAL
    Success:   false
    Title:     Do not allow management of secrets
  Scanner:
    Name:     Trivy
    Vendor:   Aqua Security
    Version:  0.12.1
  Summary:
    Critical Count:  2
    High Count:      0
    Low Count:       0
    Medium Count:    0
</span><span class="gp">Events:              &lt;none&gt;</span><span class="w">
</span></pre></table></code></div></div><p>You can also view all “Role issues” in the cluster:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get rbacassessmentreport <span class="nt">--all-namespaces</span> <span class="nt">--output</span><span class="o">=</span>wide
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="go">NAMESPACE               NAME                                             SCANNER   AGE   CRITICAL   HIGH   MEDIUM   LOW
cert-manager            role-565fd84cf                                   Trivy     21m   1          0      0        0
default                 role-864ddd97cb                                  Trivy     19m   0          1      0        1
ingress-nginx           role-ingress-nginx                               Trivy     20m   1          0      0        0
karpenter               role-karpenter                                   Trivy     19m   1          0      1        0
kube-prometheus-stack   role-kube-prometheus-stack-grafana               Trivy     19m   0          0      0        0
kube-public             role-b99d4b8d7                                   Trivy     20m   0          0      1        0
kube-system             role-54bf889b86                                  Trivy     19m   0          0      1        0
kube-system             role-5c6cd5c956                                  Trivy     19m   0          0      0        0
kube-system             role-5cc59f98f6                                  Trivy     19m   0          0      0        0
kube-system             role-5df4dbbd98                                  Trivy     19m   0          0      1        0
kube-system             role-668d4b4c7b                                  Trivy     20m   0          2      1        0
kube-system             role-6fbccbcb9d                                  Trivy     19m   0          0      1        0
kube-system             role-77cd64c645                                  Trivy     19m   0          0      1        0
kube-system             role-79f88497                                    Trivy     19m   0          0      1        0
kube-system             role-7f4d588ff9                                  Trivy     18m   0          0      0        0
kube-system             role-8498b9b6d4                                  Trivy     19m   0          0      1        0
kube-system             role-864ddd97cb                                  Trivy     20m   0          0      0        0
kube-system             role-868458b9d6                                  Trivy     20m   1          0      0        0
kube-system             role-8c86c9467                                   Trivy     19m   0          0      0        0
kube-system             role-b99d4b8d7                                   Trivy     19m   1          0      0        0
kube-system             role-eks-vpc-resource-controller-role            Trivy     19m   0          0      1        0
kube-system             role-extension-apiserver-authentication-reader   Trivy     19m   0          0      0        0
kube-system             role-karpenter-dns                               Trivy     20m   0          0      0        0
test-trivy4             role-secret-reader                               Trivy     49s   2          0      0        0
trivy-system            role-trivy-operator                              Trivy     21m   1          0      1        0
trivy-system            role-trivy-operator-leader-election              Trivy     19m   0          0      0        0
</span></pre></table></code></div></div><h4 id="clusterrbacassessmentreport"><span class="me-2">ClusterRbacAssessmentReport</span><a href="#clusterrbacassessmentreport" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Creating the following <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-and-clusterrole">ClusterRole</a> will cause another security violation against the principle of <a href="https://kubernetes.io/docs/concepts/security/rbac-good-practices/#least-privilege">least privilege</a>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> - <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: wildcard-resource
rules:
- apiGroups: [""]
  resources: ["*"]                         # &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; This is the security issue
  verbs: ["*"]
</span><span class="no">EOF

</span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"Waiting for trivy-operator to create ClusterRbacAssessmentReport: "</span>
<span class="k">until </span>kubectl get clusterrbacassessmentreport clusterrole-wildcard-resource 2&gt; /dev/null<span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"."</span>
  <span class="nb">sleep </span>3
<span class="k">done</span>
</pre></table></code></div></div><p>See the details below:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl describe clusterrbacassessmentreport clusterrole-wildcard-resource
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="go">Name:         clusterrole-wildcard-resource
Namespace:
Labels:       plugin-config-hash=659b7b9c46
              resource-spec-hash=6c64bd7d7
              trivy-operator.resource.kind=ClusterRole
              trivy-operator.resource.name=wildcard-resource
              trivy-operator.resource.namespace=
</span><span class="gp">Annotations:  &lt;none&gt;</span><span class="w">
</span><span class="go">API Version:  aquasecurity.github.io/v1alpha1
Kind:         ClusterRbacAssessmentReport
Metadata:
  Creation Timestamp:  2023-03-14T04:47:57Z
  Generation:          1
  Managed Fields:
    API Version:  aquasecurity.github.io/v1alpha1
</span><span class="c">...
</span><span class="go">    Manager:    trivy-operator
    Operation:  Update
    Time:       2023-03-14T04:47:57Z
  Owner References:
    API Version:           rbac.authorization.k8s.io/v1
    Block Owner Deletion:  false
    Controller:            true
    Kind:                  ClusterRole
    Name:                  wildcard-resource
    UID:                   ef842392-d8cc-47c9-b60d-8a713232596b
  Resource Version:        119581
  UID:                     1fc1eb0a-7ad4-4ee9-9e1a-725847e2ed11
Report:
  Checks:
    Category:     Kubernetes Security Check
    Check ID:     KSV046
    Description:  Check whether role permits specific verb on wildcard resources
    Messages:
      Role permits specific verb on wildcard resource
    Severity:  CRITICAL
    Success:   false
    Title:     No wildcard resource roles
  Scanner:
    Name:     Trivy
    Vendor:   Aqua Security
    Version:  0.12.1
  Summary:
    Critical Count:  1
    High Count:      0
    Low Count:       0
    Medium Count:    0
</span><span class="gp">Events:              &lt;none&gt;</span><span class="w">
</span></pre></table></code></div></div><p>View all “ClusterRole issues” in the cluster:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get clusterrbacassessmentreport <span class="nt">--all-namespaces</span> <span class="nt">--output</span><span class="o">=</span>wide
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
</pre><td class="rouge-code"><pre><span class="go">NAME                                                             SCANNER   AGE   CRITICAL   HIGH   MEDIUM   LOW
clusterrole-54bb85d744                                           Trivy     20m   0          0      0        0
clusterrole-54bf889b86                                           Trivy     21m   0          0      0        0
clusterrole-54ccb57cc4                                           Trivy     20m   0          0      0        0
clusterrole-54cdc9b678                                           Trivy     21m   1          0      0        0
clusterrole-5585c7b9ff                                           Trivy     19m   0          0      0        0
clusterrole-565cd5fdf                                            Trivy     19m   0          0      0        0
clusterrole-567cc86fc6                                           Trivy     19m   0          0      0        0
clusterrole-569d87574c                                           Trivy     22m   1          0      0        0
clusterrole-575b7f6784                                           Trivy     20m   0          0      0        0
clusterrole-57d745d4cc                                           Trivy     23m   1          0      0        0
clusterrole-5857f84f59                                           Trivy     21m   0          0      0        0
clusterrole-58bfc7788d                                           Trivy     20m   0          0      0        0
clusterrole-59dc5c9cb6                                           Trivy     19m   0          0      0        0
clusterrole-5b458986c5                                           Trivy     19m   0          0      0        0
clusterrole-5b97d66885                                           Trivy     20m   0          0      0        0
clusterrole-5bd7cc878d                                           Trivy     19m   0          0      0        0
clusterrole-5c6cd5c956                                           Trivy     20m   0          0      0        0
clusterrole-5cbfdf6f9d                                           Trivy     21m   0          0      0        0
clusterrole-5f9f8f6b4c                                           Trivy     21m   1          0      0        0
clusterrole-644b85fbb5                                           Trivy     21m   0          0      0        0
clusterrole-6496b874bc                                           Trivy     20m   0          0      0        0
clusterrole-64cd5dd8c5                                           Trivy     19m   0          0      0        0
clusterrole-64f9898979                                           Trivy     21m   0          0      0        0
clusterrole-658cbf7c48                                           Trivy     19m   0          0      0        0
clusterrole-6594cc4fb6                                           Trivy     19m   0          1      0        0
clusterrole-65bd45754b                                           Trivy     20m   0          0      0        0
clusterrole-65ff89d4f6                                           Trivy     19m   0          0      0        0
clusterrole-668d4b4c7b                                           Trivy     19m   2          0      0        0
clusterrole-679f75d6b5                                           Trivy     21m   0          0      0        0
clusterrole-6858fccb98                                           Trivy     21m   0          0      0        0
clusterrole-68679985fd                                           Trivy     19m   0          0      0        0
clusterrole-69c4fbc9c4                                           Trivy     20m   1          0      0        0
clusterrole-6b696dd9d5                                           Trivy     20m   0          0      0        0
clusterrole-6b6f997745                                           Trivy     20m   0          0      0        0
clusterrole-6c9cb84f7b                                           Trivy     20m   0          0      0        0
clusterrole-6d7d6f9d9c                                           Trivy     22m   0          1      0        0
clusterrole-6f54fcfddd                                           Trivy     20m   0          0      0        0
clusterrole-6f647d9bdc                                           Trivy     20m   0          0      0        0
clusterrole-6f69bb5b79                                           Trivy     21m   0          0      0        0
clusterrole-74586d59d6                                           Trivy     20m   0          0      1        0
clusterrole-74f98bf848                                           Trivy     20m   0          0      0        0
clusterrole-7557d9789b                                           Trivy     20m   0          0      0        0
clusterrole-75f5d55dd8                                           Trivy     21m   0          0      0        0
clusterrole-76c6b6cf99                                           Trivy     19m   0          0      0        0
clusterrole-77898f44f5                                           Trivy     21m   0          1      0        0
clusterrole-779895897b                                           Trivy     21m   0          0      0        0
clusterrole-779f88d9b5                                           Trivy     21m   0          1      0        0
clusterrole-77f88d49d                                            Trivy     23m   0          0      0        0
clusterrole-79d4fc89cd                                           Trivy     22m   1          0      0        0
clusterrole-79ff87886f                                           Trivy     20m   0          0      0        0
clusterrole-7b884bc5d8                                           Trivy     21m   1          2      1        0
clusterrole-7bdcc749f8                                           Trivy     19m   0          1      0        0
clusterrole-7c4d8f665                                            Trivy     19m   1          1      0        0
clusterrole-7c5d4b78b6                                           Trivy     20m   0          1      0        0
clusterrole-7c7649d468                                           Trivy     22m   0          0      0        0
clusterrole-7dfccfdf                                             Trivy     19m   0          0      0        0
clusterrole-7f76ddfb76                                           Trivy     20m   0          0      0        0
clusterrole-7f7cc8689f                                           Trivy     20m   0          0      0        0
clusterrole-7ff7dbc7fd                                           Trivy     20m   0          0      0        0
clusterrole-8498b9b6d4                                           Trivy     20m   0          0      0        0
clusterrole-8545bb4f4d                                           Trivy     20m   0          0      0        0
clusterrole-865d464ff8                                           Trivy     20m   0          0      0        0
clusterrole-8686d64c5                                            Trivy     19m   0          1      0        0
clusterrole-8689f7c759                                           Trivy     21m   0          0      0        0
clusterrole-86ccd5dd47                                           Trivy     20m   1          0      0        0
clusterrole-889f4b7cc                                            Trivy     20m   0          0      0        0
clusterrole-8b7445588                                            Trivy     22m   0          0      0        0
clusterrole-96685f56d                                            Trivy     20m   0          1      0        0
clusterrole-984fc85d                                             Trivy     21m   0          1      0        0
clusterrole-9d8f67c6d                                            Trivy     20m   0          0      0        0
clusterrole-admin                                                Trivy     20m   2          2      1        0
clusterrole-aggregate-config-audit-reports-view                  Trivy     20m   0          0      0        0
clusterrole-aggregate-exposed-secret-reports-view                Trivy     20m   0          0      0        0
clusterrole-aggregate-vulnerability-reports-view                 Trivy     20m   0          0      0        0
clusterrole-aws-node                                             Trivy     19m   1          0      0        0
clusterrole-aws-node-termination-handler                         Trivy     20m   0          0      0        0
clusterrole-b754c4cc6                                            Trivy     20m   2          1      0        0
clusterrole-bf7d9ff77                                            Trivy     21m   0          0      1        0
clusterrole-c497699bd                                            Trivy     20m   0          0      0        0
clusterrole-cert-manager-cainjector                              Trivy     19m   1          0      0        0
clusterrole-cert-manager-controller-certificates                 Trivy     19m   1          0      0        0
clusterrole-cert-manager-controller-certificatesigningrequests   Trivy     20m   0          0      0        0
clusterrole-cert-manager-controller-challenges                   Trivy     20m   1          1      0        0
clusterrole-cert-manager-controller-clusterissuers               Trivy     19m   1          0      0        0
clusterrole-cert-manager-controller-ingress-shim                 Trivy     21m   0          0      0        0
clusterrole-cert-manager-controller-issuers                      Trivy     20m   1          0      0        0
clusterrole-cert-manager-controller-orders                       Trivy     19m   1          0      0        0
clusterrole-cert-manager-edit                                    Trivy     21m   0          0      0        0
clusterrole-cert-manager-view                                    Trivy     20m   0          0      0        0
clusterrole-cf7d59df5                                            Trivy     19m   0          0      0        0
clusterrole-cluster-admin                                        Trivy     22m   2          0      0        0
clusterrole-d6d6b6c99                                            Trivy     19m   0          0      0        0
clusterrole-df67d86bd                                            Trivy     19m   0          1      0        0
clusterrole-ebs-csi-node-role                                    Trivy     20m   0          0      0        0
clusterrole-ebs-external-attacher-role                           Trivy     19m   0          0      0        0
clusterrole-ebs-external-provisioner-role                        Trivy     19m   0          0      0        0
clusterrole-ebs-external-resizer-role                            Trivy     20m   0          0      0        0
clusterrole-ebs-external-snapshotter-role                        Trivy     20m   0          0      0        0
clusterrole-edit                                                 Trivy     20m   1          2      1        0
clusterrole-external-dns                                         Trivy     20m   0          0      0        0
clusterrole-f44d6476f                                            Trivy     19m   0          0      0        0
clusterrole-forecastle-cluster-ingress-role                      Trivy     20m   0          0      0        0
clusterrole-ingress-nginx                                        Trivy     19m   1          0      0        0
clusterrole-karpenter                                            Trivy     19m   0          0      0        0
clusterrole-karpenter-admin                                      Trivy     20m   0          0      0        0
clusterrole-karpenter-core                                       Trivy     20m   0          0      0        0
clusterrole-kube-prometheus-stack-grafana-clusterrole            Trivy     20m   1          0      0        0
clusterrole-kube-prometheus-stack-kube-state-metrics             Trivy     19m   1          0      0        0
clusterrole-kube-prometheus-stack-operator                       Trivy     19m   2          2      1        0
clusterrole-kube-prometheus-stack-prometheus                     Trivy     21m   0          0      0        0
clusterrole-trivy-operator                                       Trivy     21m   1          1      0        0
clusterrole-view                                                 Trivy     21m   0          0      0        0
clusterrole-vpc-resource-controller-role                         Trivy     23m   0          0      0        0
clusterrole-wildcard-resource                                    Trivy     97s   1          0      0        0
</span></pre></table></code></div></div><h3 id="cluster-infra-assessment-reports"><span class="me-2">Cluster Infra Assessment Reports</span><a href="#cluster-infra-assessment-reports" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Cluster Infra Assessment Reports should help you with hardening your Kubernetes cluster. Since I’m using Amazon EKS (a managed service), I’m not sure how useful this report is in this context, but I will test it for reference.</p><p>View a cluster summary of node issues:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get clusterinfraassessmentreports <span class="nt">-o</span> wide
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="go">NAME                                  SCANNER   AGE    CRITICAL   HIGH   MEDIUM   LOW
node-ip-192-168-12-204.ec2.internal   Trivy     23m    5          5      0        0
node-ip-192-168-77-76.ec2.internal    Trivy     6m5s   5          5      0        0
node-ip-192-168-8-119.ec2.internal    Trivy     24m    5          5      0        0
</span></pre></table></code></div></div><p>Details about the nodes:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">NODE</span><span class="o">=</span><span class="si">$(</span>kubectl get clusterinfraassessmentreports <span class="nt">--no-headers</span><span class="o">=</span><span class="nb">true</span> <span class="nt">-o</span> custom-columns<span class="o">=</span><span class="s2">":metadata.name"</span> | <span class="nb">head</span> <span class="nt">-1</span><span class="si">)</span>
kubectl describe clusterinfraassessmentreports <span class="s2">"</span><span class="k">${</span><span class="nv">NODE</span><span class="k">}</span><span class="s2">"</span>
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
</pre><td class="rouge-code"><pre><span class="go">Name:         node-ip-192-168-12-204.ec2.internal
Namespace:
Labels:       plugin-config-hash=659b7b9c46
              resource-spec-hash=54fdd9476
              trivy-operator.resource.kind=Node
              trivy-operator.resource.name=ip-192-168-12-204.ec2.internal
              trivy-operator.resource.namespace=
</span><span class="gp">Annotations:  &lt;none&gt;</span><span class="w">
</span><span class="go">API Version:  aquasecurity.github.io/v1alpha1
Kind:         ClusterInfraAssessmentReport
Metadata:
  Creation Timestamp:  2023-03-14T04:26:37Z
  Generation:          1
  Managed Fields:
    API Version:  aquasecurity.github.io/v1alpha1
    Fields Type:  FieldsV1
</span><span class="c">...
</span><span class="go">    Manager:    trivy-operator
    Operation:  Update
    Time:       2023-03-14T04:26:37Z
  Owner References:
    API Version:           v1
    Block Owner Deletion:  false
    Controller:            true
    Kind:                  Node
    Name:                  ip-192-168-12-204.ec2.internal
    UID:                   d74b3dc1-eed2-45e8-af14-b7ca8c49277a
  Resource Version:        113102
  UID:                     c19ff166-d97c-4b16-94c2-17c39101cb69
Report:
  Checks:
    Category:     Kubernetes Security Check
    Check ID:     KCV0089
    Description:  Setup TLS connection on the Kubelets.
    Messages:
      Ensure that the --tls-key-file argument are set as appropriate
    Severity:     CRITICAL
    Success:      false
    Title:        Ensure that the --tls-key-file argument are set as appropriate
    Category:     Kubernetes Security Check
    Check ID:     KCV0088
    Description:  Setup TLS connection on the Kubelets.
    Messages:
      Ensure that the --tls-cert-file argument are set as appropriate
    Severity:     CRITICAL
    Success:      false
    Title:        Ensure that the --tls-cert-file argument are set as appropriate
    Category:     Kubernetes Security Check
    Check ID:     KCV0091
    Description:  Enable kubelet server certificate rotation.
    Messages:
      Verify that the RotateKubeletServerCertificate argument is set to true
    Severity:     HIGH
    Success:      false
    Title:        Verify that the RotateKubeletServerCertificate argument is set to true
    Category:     Kubernetes Security Check
    Check ID:     KCV0079
    Description:  Disable anonymous requests to the Kubelet server.
    Messages:
      Ensure that the --anonymous-auth argument is set to false
    Severity:     CRITICAL
    Success:      false
    Title:        Ensure that the --anonymous-auth argument is set to false
    Category:     Kubernetes Security Check
    Check ID:     KCV0092
    Description:  Ensure that the Kubelet is configured to only use strong cryptographic ciphers.
    Messages:
      Ensure that the Kubelet only makes use of Strong Cryptographic Ciphers
    Severity:     CRITICAL
    Success:      false
    Title:        Ensure that the Kubelet only makes use of Strong Cryptographic Ciphers
    Category:     Kubernetes Security Check
    Check ID:     KCV0081
    Description:  Enable Kubelet authentication using certificates.
    Messages:
      Ensure that the --client-ca-file argument is set as appropriate
    Severity:     CRITICAL
    Success:      false
    Title:        Ensure that the --client-ca-file argument is set as appropriate
    Category:     Kubernetes Security Check
    Check ID:     KCV0080
    Description:  Do not allow all requests. Enable explicit authorization.
    Messages:
      Ensure that the --authorization-mode argument is not set to AlwaysAllow
    Severity:     HIGH
    Success:      false
    Title:        Ensure that the --authorization-mode argument is not set to AlwaysAllow
    Category:     Kubernetes Security Check
    Check ID:     KCV0082
    Description:  Disable the read-only port.
    Messages:
      Verify that the --read-only-port argument is set to 0
    Severity:     HIGH
    Success:      false
    Title:        Verify that the --read-only-port argument is set to 0
    Category:     Kubernetes Security Check
    Check ID:     KCV0090
    Description:  Enable kubelet client certificate rotation.
    Messages:
      Ensure that the --rotate-certificates argument is not set to false
    Severity:     HIGH
    Success:      false
    Title:        Ensure that the --rotate-certificates argument is not set to false
    Category:     Kubernetes Security Check
    Check ID:     KCV0083
    Description:  Protect tuned kernel parameters from overriding kubelet default kernel parameter values.
    Messages:
      Ensure that the --protect-kernel-defaults is set to true
    Severity:  HIGH
    Success:   false
    Title:     Ensure that the --protect-kernel-defaults is set to true
  Scanner:
    Name:     Trivy
    Vendor:   Aqua Security
    Version:  0.12.1
  Summary:
    Critical Count:  5
    High Count:      5
    Low Count:       0
    Medium Count:    0
</span><span class="gp">Events:              &lt;none&gt;</span><span class="w">
</span></pre></table></code></div></div><h2 id="grafana"><span class="me-2">Grafana</span><a href="#grafana" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Add Trivy Grafana Dashboards to <code class="language-plaintext highlighter-rouge">kube-prometheus-stack</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c"># renovate: datasource=helm depName=kube-prometheus-stack registryUrl=https://prometheus-community.github.io/helm-charts</span>
<span class="nv">KUBE_PROMETHEUS_STACK_HELM_CHART_VERSION</span><span class="o">=</span><span class="s2">"56.6.2"</span>

<span class="nb">cat</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">CLUSTER_FQDN</span><span class="k">}</span><span class="s2">/helm_values-kube-prometheus-stack-trivy-operator-grafana.yml"</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
grafana:
  dashboards:
    default:
      17813-trivy-operator-dashboard:
        # renovate: depName="Trivy Operator Dashboard"
        gnetId: 17813
        revision: 2
        datasource: Prometheus
</span><span class="no">EOF
</span>helm upgrade <span class="nt">--install</span> <span class="nt">--version</span> <span class="s2">"</span><span class="k">${</span><span class="nv">KUBE_PROMETHEUS_STACK_HELM_CHART_VERSION</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--namespace</span> kube-prometheus-stack <span class="nt">--reuse-values</span> <span class="nt">--values</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TMP_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">CLUSTER_FQDN</span><span class="k">}</span><span class="s2">/helm_values-kube-prometheus-stack-trivy-operator-grafana.yml"</span> kube-prometheus-stack prometheus-community/kube-prometheus-stack
</pre></table></code></div></div><p>Add the following Grafana Dashboards to the existing <a href="https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack">kube-prometheus-stack</a> Helm chart configuration:</p><ul><li><p>[16652] - <a href="https://grafana.com/grafana/dashboards/17813-trivy-operator-dashboard/">Trivy Operator Dashboard</a> <a href="/assets/img/posts/2023/2023-03-08-trivy-operator-grafana/grafana-dashboard-17813-trivy-operator-dashboard.avif" class="popup img-link shimmer"><img src="/assets/img/posts/2023/2023-03-08-trivy-operator-grafana/grafana-dashboard-17813-trivy-operator-dashboard.avif" alt="Trivy Operator Dashboard" loading="lazy"></a> <em>Trivy Operator Dashboard</em></p><li><p>[16742] - <a href="https://grafana.com/grafana/dashboards/16742-trivy-image-vulnerability-overview/">Trivy Image Vulnerability Overview</a> <a href="/assets/img/posts/2023/2023-03-08-trivy-operator-grafana/grafana-dashboard-16742-trivy-image-vulnerability-overview.avif" class="popup img-link shimmer"><img src="/assets/img/posts/2023/2023-03-08-trivy-operator-grafana/grafana-dashboard-16742-trivy-image-vulnerability-overview.avif" alt="Trivy Image Vulnerability Overview" loading="lazy"></a> <em>Trivy Image Vulnerability Overview</em></p><li><p>[16652] - <a href="https://grafana.com/grafana/dashboards/16652-trivy-operator-reports/">Trivy Operator Reports</a> <a href="/assets/img/posts/2023/2023-03-08-trivy-operator-grafana/grafana-dashboard-16652-trivy-operator-reports.avif" class="popup img-link shimmer"><img src="/assets/img/posts/2023/2023-03-08-trivy-operator-grafana/grafana-dashboard-16652-trivy-operator-reports.avif" alt="Trivy Operator Reports" loading="lazy"></a> <em>Trivy Operator Reports</em></p></ul><hr /><p>Delete the previously created test namespaces:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl delete namespace test-trivy1 test-trivy2 test-trivy3 test-trivy4 <span class="o">||</span> <span class="nb">true</span>
</pre></table></code></div></div><p>Enjoy … 😉</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/kubernetes/">Kubernetes</a>, <a href="/categories/amazon-eks/">Amazon EKS</a>, <a href="/categories/security/">Security</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/amazon-eks/" class="post-tag no-text-decoration" >Amazon EKS</a> <a href="/tags/k8s/" class="post-tag no-text-decoration" >k8s</a> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/grafana/" class="post-tag no-text-decoration" >grafana</a> <a href="/tags/trivy-operator/" class="post-tag no-text-decoration" >trivy-operator</a> <a href="/tags/dashboard/" class="post-tag no-text-decoration" >dashboard</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Trivy%20Operator%20Dashboard%20in%20Grafana%20-%20Petr's%20Blog&url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Ftrivy-operator-grafana%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Trivy%20Operator%20Dashboard%20in%20Grafana%20-%20Petr's%20Blog&u=https%3A%2F%2Fruzickap.github.io%2Fposts%2Ftrivy-operator-grafana%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Ftrivy-operator-grafana%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/amazon-eks-karpenter-tests/">Amazon EKS - Karpenter tests</a><li class="text-truncate lh-lg"> <a href="/posts/eks-auto-cert-manager-velero/">Amazon EKS Auto Mode with cert-manager and Velero</a><li class="text-truncate lh-lg"> <a href="/posts/secure-cheap-amazon-eks-auto/">Build secure and cheap Amazon EKS Auto Mode</a><li class="text-truncate lh-lg"> <a href="/posts/mcp-servers-k8s/">MCP Servers running on Kubernetes</a><li class="text-truncate lh-lg"> <a href="/posts/ollama-k8s-exploitation/">Exploiting RCE Vulnerabilities in Ollama on Kubernetes</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/k8s/">k8s</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">Amazon EKS</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/external-dns/">external-dns</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/oauth2-proxy/">oauth2-proxy</a> <a class="post-tag btn btn-outline-primary" href="/tags/podinfo/">podinfo</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/secure-cheap-amazon-eks/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1695592800" data-df="ll" > Sep 25, 2023 </time><h4 class="pt-0 my-2">Build secure and cheap Amazon EKS</h4><div class="text-muted"><p>Build "cheap and secure" Amazon EKS with network policies, cluster encryption and logging</p></div></div></a></article><article class="col"> <a href="/posts/cilium-amazon-eks/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1691013600" data-df="ll" > Aug 3, 2023 </time><h4 class="pt-0 my-2">Build secure Amazon EKS with Cilium and network encryption</h4><div class="text-muted"><p>Build "cheap and secure" Amazon EKS with Karpenter and Cilium</p></div></div></a></article><article class="col"> <a href="/posts/detect-a-hacker-attacks-eks-vm/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1720303200" data-df="ll" > Jul 7, 2024 </time><h4 class="pt-0 my-2">Detect the hacker attacks on Amazon EKS and EC2 instances</h4><div class="text-muted"><p>Use the security tools to detect the hacker attacks on Amazon EKS and EC2 instances</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/ftp-and-sony-camera/" class="btn btn-outline-primary" aria-label="Older" ><p>Transfer photos wirelessly from Sony cameras</p></a> <a href="/posts/velero-and-cert-manager/" class="btn btn-outline-primary" aria-label="Newer" ><p>Velero and cert-manager</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/Ruzicka_Petr">Petr Ruzicka</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/k8s/">k8s</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">Amazon EKS</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/external-dns/">external-dns</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/oauth2-proxy/">oauth2-proxy</a> <a class="post-tag btn btn-outline-primary" href="/tags/podinfo/">podinfo</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ruzickap/ruzickap.github.io', 'data-repo-id': 'R_kgDOGkp4nQ', 'data-category': 'General', 'data-category-id': 'DIC_kwDOGkp4nc4CSdu1', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
