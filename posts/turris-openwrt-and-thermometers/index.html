<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Turris - OpenWRT and thermometers" /><meta name="author" content="Petr Ruzicka" /><meta property="og:locale" content="en" /><meta name="description" content="Turris - OpenWRT and thermometers" /><meta property="og:description" content="Turris - OpenWRT and thermometers" /><link rel="canonical" href="https://ruzickap.github.io/posts/turris-openwrt-and-thermometers/" /><meta property="og:url" content="https://ruzickap.github.io/posts/turris-openwrt-and-thermometers/" /><meta property="og:site_name" content="Petr’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2014-04-22T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Turris - OpenWRT and thermometers" /><meta name="twitter:site" content="@Ruzicka_Petr" /><meta name="twitter:creator" content="@Ruzicka_Petr" /><meta name="google-site-verification" content="4ugGShJoiB9veoPwFcMsMjzk-1BYbi5ozcSnovkBWtA" /><meta name="msvalidate.01" content="592AB158E3F9EF887F8DC8E69A2FF754" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Petr Ruzicka","url":"https://petr.ruzicka.dev"},"dateModified":"2026-01-17T19:48:44+01:00","datePublished":"2014-04-22T00:00:00+02:00","description":"Turris - OpenWRT and thermometers","headline":"Turris - OpenWRT and thermometers","mainEntityOfPage":{"@type":"WebPage","@id":"https://ruzickap.github.io/posts/turris-openwrt-and-thermometers/"},"url":"https://ruzickap.github.io/posts/turris-openwrt-and-thermometers/"}</script><title>Turris - OpenWRT and thermometers | Petr's Blog</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> document.addEventListener('DOMContentLoaded', () => { const pv = document.getElementById('pageviews'); if (pv !== null) { const uri = location.pathname.replace(/\/$/, ''); const url = `https://ruzickap-github-io.goatcounter.com/counter/${encodeURIComponent(uri)}.json`; fetch(url) .then((response) => response.json()) .then((data) => { const count = data.count.replace(/\D/g, ''); pv.innerText = new Intl.NumberFormat().format(count); }) .catch((error) => { pv.innerText = '1'; }); } }); </script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-64WRCWDZM8"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-64WRCWDZM8'); }); </script> <script async src="https://gc.zgo.at/count.js" data-goatcounter="https://ruzickap-github-io.goatcounter.com/count" ></script> <script defer src="https://cloud.umami.is/script.js" data-website-id="380ea41a-7d5f-4423-8e13-03151bde195f" ></script> <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "ad8c64404e1e41dba184019564cf11bb"}' ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://0.gravatar.com/avatar/5484c0fd9f98e2ffd9212b158931bf4b?s=200" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Petr's Blog</a><p class="site-subtitle fst-italic mb-0">DevOps • GitOps • K8s</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-project-diagram"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/ruzickap" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['petr.ruzicka','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://petr.ruzicka.dev" aria-label="homepage" target="_blank" rel="noopener noreferrer" > <i class="fas fa-home"></i> </a> <a href="https://mastodon.social/@petr_ruzicka" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Turris - OpenWRT and thermometers</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Turris - OpenWRT and thermometers</h1><p class="post-desc fw-light mb-4">Turris - OpenWRT and thermometers</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1398117600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 22, 2014 </time> </span> <span> Updated <time data-ts="1768675724" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 17, 2026 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://petr.ruzicka.dev">Petr Ruzicka</a> </em> </span><div> <span> <em id="pageviews"> <i class="fas fa-spinner fa-spin small"></i> </em> views </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1135 words" > <em>6 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Turris - OpenWRT and thermometers</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Turris - OpenWRT and thermometers</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><blockquote class="prompt-info"><p>Original post from <a href="https://linux.xvx.cz/2014/04/turris-openwrt-and-thermometers.html">linux.xvx.cz</a></p></blockquote><p>I would like to put here some notes about the thermometers in <a href="https://openwrt.org/">OpenWrt</a> and <a href="https://www.turris.cz/en/">Turris</a>.</p><h2 id="turris-internal-thermometers"><span class="me-2">Turris internal thermometers</span><a href="#turris-internal-thermometers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Turris has its own thermometers which are monitoring the temperature of CPU and board. This how-to expects the previous lighttpd configuration described in my previous post “<a href="/posts/turris-openwrt-and-thermometers/">Turris - OpenWrt configuration</a>”. Here is how you can create graphs from the data using <a href="https://oss.oetiker.ch/rrdtool/">RRDtool</a>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /data/temperature_sensors /www3/temperature_sensors
<span class="c">#The graphs can be accessed: http://192.168.1.1/myadmin/temperature_sensors</span>
<span class="nb">ln</span> <span class="nt">-s</span> /www3/temperature_sensors /www3/myadmin/temperature_sensors

<span class="c">#Create RRDtool database to store the values every 10 minutes (600 seconds) for 10 years (525600 * 600 seconds)</span>
rrdtool create /data/temperature_sensors/temperature_sensors.rrd <span class="nt">--step</span> 600 <span class="se">\</span>
  DS:temp0:GAUGE:1000:-273:5000 DS:temp1:GAUGE:1000:-273:5000 RRA:AVERAGE:0.5:1:525600 <span class="se">\</span>
  RRA:MIN:0.5:1:525600 RRA:MAX:0.5:1:525600

<span class="c">#Add cron entry to put the temperatures into the database</span>
<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/crontabs/root <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
*/10 * * * * test -f /data/temperature_sensors/temperature_sensors.rrd &amp;&amp; rrdtool update /data/temperature_sensors/temperature_sensors.rrd </span><span class="si">$(</span><span class="nb">date</span> +<span class="se">\%</span>s<span class="si">)</span><span class="sh">:</span><span class="si">$(</span>thermometer | <span class="nb">tr</span> <span class="nt">-s</span> <span class="se">\\</span>n <span class="s1">' '</span> | <span class="nb">awk</span> <span class="s1">'{print $2":"$4}'</span><span class="si">)</span><span class="sh">
</span><span class="no">EOF

</span><span class="c">#Create main graph script</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /data/temperature_sensors/temperature_sensors-graph.sh <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
#!/bin/sh

NAME=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$0</span> | <span class="nb">sed</span> <span class="s1">'s@.*/\([^-]*\)-.*@\1@'</span><span class="si">)</span><span class="sh">
RRD_FILE="/data/</span><span class="nv">$NAME</span><span class="sh">/</span><span class="nv">$NAME</span><span class="sh">.rrd"
DST_FILE="/www3/</span><span class="nv">$NAME</span><span class="sh">/</span><span class="nv">$1</span><span class="sh">.png"

RRD_PARAMETERS='
  </span><span class="nv">$DST_FILE</span><span class="sh"> --end=</span><span class="si">$(</span><span class="nb">date</span> +%s<span class="si">)</span><span class="sh"> --vertical-label "Temperature .C" --width 1024 --height 600 --lower-limit 0
  DEF:temp0=</span><span class="nv">$RRD_FILE</span><span class="sh">:temp0:AVERAGE
  DEF:temp1=</span><span class="nv">$RRD_FILE</span><span class="sh">:temp1:AVERAGE
  LINE1:temp0#CF00FF:"10 minutes average Board</span><span class="se">\\</span><span class="sh">n"
  LINE2:temp1#FF3C00:"10 minutes average CPU</span><span class="se">\\</span><span class="sh">n"
  COMMENT:" </span><span class="se">\\</span><span class="sh">n"
  GPRINT:temp0:MIN:"Minimum Board</span><span class="se">\\</span><span class="sh">: %4.1lf .C      "
  GPRINT:temp1:MIN:"Minimum CPU</span><span class="se">\\</span><span class="sh">: %4.1lf .C     "
  GPRINT:temp0:MAX:"Maximum Board</span><span class="se">\\</span><span class="sh">: %4.1lf .C      "
  GPRINT:temp1:MAX:"Maximum CPU</span><span class="se">\\</span><span class="sh">: %4.1lf .C</span><span class="se">\\</span><span class="sh">n"
  GPRINT:temp0:AVERAGE:"Average Board</span><span class="se">\\</span><span class="sh">: %4.1lf .C  "
  GPRINT:temp1:AVERAGE:"Average CPU</span><span class="se">\\</span><span class="sh">: %4.1lf .C "
  GPRINT:temp0:LAST:"Current Board</span><span class="se">\\</span><span class="sh">: %4.1lf .C     "
  GPRINT:temp1:LAST:"Current CPU</span><span class="se">\\</span><span class="sh">: %4.1lf .C"
  &gt; /dev/null
'

case </span><span class="nv">$1</span><span class="sh"> in
  daily)
    eval /usr/bin/rrdtool graph --start="end-2days" --title </span><span class="se">\'</span><span class="sh">Daily graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  weekly)
    eval /usr/bin/rrdtool graph --start="end-2week" --title </span><span class="se">\'</span><span class="sh">Weekly graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  monthly)
    eval /usr/bin/rrdtool graph --start="end-2month" --title </span><span class="se">\'</span><span class="sh">Monthly graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  yearly)
    eval /usr/bin/rrdtool graph --start="end-1year" --title </span><span class="se">\'</span><span class="sh">Yearly graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  2years)
    eval /usr/bin/rrdtool graph --start="end-2years" --title </span><span class="se">\'</span><span class="sh">2 Years graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  5years)
    eval /usr/bin/rrdtool graph --start="end-5years" --title </span><span class="se">\'</span><span class="sh">5 Years graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  10years)
    eval /usr/bin/rrdtool graph --start="end-10years" --title </span><span class="se">\'</span><span class="sh">10 Years graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  *)
    echo "Please specify </span><span class="nv">$0</span><span class="sh"> [daily|weekly|monthly|yearly|2years|5years|10years]"
  ;;
esac
</span><span class="no">EOF

</span><span class="nb">chmod </span>a+x /data/temperature_sensors/temperature_sensors-graph.sh

<span class="c">#Add cron entry to generate graphs</span>
<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/crontabs/root <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
7    * * * * /data/temperature_sensors/temperature_sensors-graph.sh daily
1    1 * * * /data/temperature_sensors/temperature_sensors-graph.sh weekly
2    1 * * 0 /data/temperature_sensors/temperature_sensors-graph.sh monthly
3    1 1 * * /data/temperature_sensors/temperature_sensors-graph.sh yearly
4    1 1 1 * /data/temperature_sensors/temperature_sensors-graph.sh 2years
5    1 1 1 * /data/temperature_sensors/temperature_sensors-graph.sh 5years
6    1 1 1 * /data/temperature_sensors/temperature_sensors-graph.sh 10years
</span><span class="no">EOF
</span></pre></table></code></div></div><p>You should be able to see the generated graphs in <code class="language-plaintext highlighter-rouge">http://192.168.1.1/myadmin/temperature_sensors</code> in the next few days.</p><p>Here is the example:</p><p><a href="https://raw.githubusercontent.com/ruzickap/linux.xvx.cz/gh-pages/files/turris_configured/www3/temperature_sensors/daily.png" class="popup img-link shimmer"><img src="https://raw.githubusercontent.com/ruzickap/linux.xvx.cz/gh-pages/files/turris_configured/www3/temperature_sensors/daily.png" alt="Turris temperature sensors daily graph" loading="lazy"></a></p><h2 id="external-thermometers"><span class="me-2">External thermometers</span><a href="#external-thermometers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I’m using two external thermometers to monitor temperature around router + in the room. These were built according to the following descriptions:</p><ul><li><a href="https://web.archive.org/web/20130219033601/http://www.linuxfocus.org/English/November2003/article315.shtml">DS18S20 article</a><li><a href="https://martybugs.net/electronics/tempsensor/hardware.cgi">Serial Port Temperature Sensors - Serial Hardware Interface</a></ul><p>I used the serial to USB converter and it works nicely with <a href="https://www.digitemp.com/">Digitemp</a>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>gate / <span class="c"># digitemp_DS9097 -c/etc/digitemp.conf -t0 -q -s/dev/ttyUSB0 -o"%.2C"</span>
28.00
gate / <span class="c"># digitemp_DS9097 -c/etc/digitemp.conf -t1 -q -s/dev/ttyUSB0 -o"%.2C"</span>
20.63
</pre></table></code></div></div><p>The scripts are very similar to the previous solution, except for getting the data from thermometers. It happens from time to time that digitemp returns bad values, so you need to read them a few times.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /data/mydigitemp /www3/mydigitemp
<span class="c">#The graphs can be accessed: http://192.168.1.1/myadmin/mydigitemp</span>
<span class="nb">ln</span> <span class="nt">-s</span> /www3/mydigitemp  /www3/myadmin/mydigitemp

<span class="c">#Create RRDtool database to store the values every 10 minutes (600 seconds) for 10 years (525600 * 600 seconds)</span>
rrdtool create /data/mydigitemp/mydigitemp.rrd <span class="nt">--step</span> 600 <span class="se">\</span>
DS:temp0:GAUGE:1000:-273:5000 DS:temp1:GAUGE:1000:-273:5000 RRA:AVERAGE:0.5:1:525600 <span class="se">\</span>
RRA:MIN:0.5:1:525600 RRA:MAX:0.5:1:525600

<span class="c">#Script getting the data from thermometers</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /data/mydigitemp/mydigitemp.sh <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
#!/bin/sh

TEMP0_ROUNDED=1000
TEMP1_ROUNDED=1000

#Sometimes the values are not in the right "range" and need to be read a few times
while [ </span><span class="nv">$TEMP0_ROUNDED</span><span class="sh"> -gt 50 ] || [ </span><span class="nv">$TEMP0_ROUNDED</span><span class="sh"> -lt 5 ] ; do
  TEMP0=</span><span class="si">$(</span>/usr/bin/digitemp_DS9097 <span class="nt">-c</span>/etc/digitemp.conf <span class="nt">-t0</span> <span class="nt">-q</span> <span class="nt">-s</span>/dev/ttyUSB0 <span class="nt">-o</span><span class="s2">"%.2C"</span><span class="si">)</span><span class="sh">
  TEMP0_ROUNDED=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$TEMP0</span> | <span class="nb">awk</span> <span class="s1">'{print int($1+0.5)}'</span><span class="si">)</span><span class="sh">
done

while [ </span><span class="nv">$TEMP1_ROUNDED</span><span class="sh"> -gt 50 ] || [ </span><span class="nv">$TEMP1_ROUNDED</span><span class="sh"> -lt 5 ] ; do
  TEMP1=</span><span class="si">$(</span>/usr/bin/digitemp_DS9097 <span class="nt">-c</span>/etc/digitemp.conf <span class="nt">-t1</span> <span class="nt">-q</span> <span class="nt">-s</span>/dev/ttyUSB0 <span class="nt">-o</span><span class="s2">"%.2C"</span><span class="si">)</span><span class="sh">
  TEMP1_ROUNDED=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$TEMP1</span> | <span class="nb">awk</span> <span class="s1">'{print int($1+0.5)}'</span><span class="si">)</span><span class="sh">
done

/usr/bin/rrdtool update /data/mydigitemp/mydigitemp.rrd </span><span class="si">$(</span><span class="nb">date</span> +%s<span class="si">)</span><span class="sh">:</span><span class="nv">$TEMP0</span><span class="sh">:</span><span class="nv">$TEMP1</span><span class="sh">
</span><span class="no">EOF

</span><span class="nb">cat</span> <span class="o">&gt;</span> /data/mydigitemp/mydigitemp-graph.sh <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
#!/bin/sh

RRD_FILE="/data/mydigitemp/mydigitemp.rrd"
DST_FILE="/www3/mydigitemp/</span><span class="nv">$1</span><span class="sh">.png"

RRD_PARAMETERS='
  </span><span class="nv">$DST_FILE</span><span class="sh"> --end=</span><span class="si">$(</span><span class="nb">date</span> +%s<span class="si">)</span><span class="sh"> --vertical-label "Temperature .C" --width 1024 --height 600 --lower-limit 0
  DEF:temp0=</span><span class="nv">$RRD_FILE</span><span class="sh">:temp0:AVERAGE
  DEF:temp1=</span><span class="nv">$RRD_FILE</span><span class="sh">:temp1:AVERAGE
  LINE1:temp0#CF00FF:"10 minutes average inside</span><span class="se">\\</span><span class="sh">n"
  LINE2:temp1#FF3C00:"10 minutes average outside</span><span class="se">\\</span><span class="sh">n"
  COMMENT:" </span><span class="se">\\</span><span class="sh">n"
  GPRINT:temp0:MIN:"Minimum inside</span><span class="se">\\</span><span class="sh">: %4.1lf .C      "
  GPRINT:temp1:MIN:"Minimum outside</span><span class="se">\\</span><span class="sh">: %4.1lf .C     "
  GPRINT:temp0:MAX:"Maximum inside</span><span class="se">\\</span><span class="sh">: %4.1lf .C      "
  GPRINT:temp1:MAX:"Maximum outside</span><span class="se">\\</span><span class="sh">: %4.1lf .C</span><span class="se">\\</span><span class="sh">n"
  GPRINT:temp0:AVERAGE:"Average inside</span><span class="se">\\</span><span class="sh">: %4.1lf .C  "
  GPRINT:temp1:AVERAGE:"Average outside</span><span class="se">\\</span><span class="sh">: %4.1lf .C "
  GPRINT:temp0:LAST:"Current inside</span><span class="se">\\</span><span class="sh">: %4.1lf .C     "
  GPRINT:temp1:LAST:"Current outside</span><span class="se">\\</span><span class="sh">: %4.1lf .C"
  &gt; /dev/null
'

case </span><span class="nv">$1</span><span class="sh"> in
  daily)
    eval /usr/bin/rrdtool graph --start="end-2days" --title </span><span class="se">\'</span><span class="sh">Daily graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  weekly)
    eval /usr/bin/rrdtool graph --start="end-2week" --title </span><span class="se">\'</span><span class="sh">Weekly graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  monthly)
    eval /usr/bin/rrdtool graph --start="end-2month" --title </span><span class="se">\'</span><span class="sh">Monthly graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  yearly)
    eval /usr/bin/rrdtool graph --start="end-1year" --title </span><span class="se">\'</span><span class="sh">Yearly graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  2years)
    eval /usr/bin/rrdtool graph --start="end-2years" --title </span><span class="se">\'</span><span class="sh">2 Years graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  5years)
    eval /usr/bin/rrdtool graph --start="end-5years" --title </span><span class="se">\'</span><span class="sh">5 Years graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  10years)
    eval /usr/bin/rrdtool graph --start="end-10years" --title </span><span class="se">\'</span><span class="sh">10 Years graph [</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%F %H:%M"</span><span class="si">)</span><span class="sh">]</span><span class="se">\'</span><span class="sh"> </span><span class="nv">$RRD_PARAMETERS</span><span class="sh">
  ;;
  *)
    echo "Please specify </span><span class="nv">$0</span><span class="sh"> [daily|weekly|monthly|yearly|2years|5years|10years]"
  ;;
esac
</span><span class="no">EOF

</span><span class="nb">chmod </span>a+x /data/mydigitemp/<span class="k">*</span>.sh

<span class="c">#Add cron entries to put the temperatures into the database and create graphs</span>
<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/crontabs/root <span class="o">&lt;&lt;</span> <span class="sh">\</span><span class="no">EOF</span><span class="sh">
*/10 * * * * test -x /data/mydigitemp/mydigitemp.sh &amp;&amp; /data/mydigitemp/mydigitemp.sh
0    * * * * /data/mydigitemp/mydigitemp-graph.sh daily
1    0 * * * /data/mydigitemp/mydigitemp-graph.sh weekly
2    0 * * 0 /data/mydigitemp/mydigitemp-graph.sh monthly
3    0 1 * * /data/mydigitemp/mydigitemp-graph.sh yearly
4    0 1 1 * /data/mydigitemp/mydigitemp-graph.sh 2years
5    0 1 1 * /data/mydigitemp/mydigitemp-graph.sh 5years
6    0 1 1 * /data/mydigitemp/mydigitemp-graph.sh 10years
</span><span class="no">EOF
</span></pre></table></code></div></div><p>Graph example:</p><p><a href="https://raw.githubusercontent.com/ruzickap/linux.xvx.cz/gh-pages/files/turris_configured/www3/mydigitemp/daily.png" class="popup img-link shimmer"><img src="https://raw.githubusercontent.com/ruzickap/linux.xvx.cz/gh-pages/files/turris_configured/www3/mydigitemp/daily.png" alt="External thermometers daily graph" loading="lazy"></a></p><p>(you can see the temperature was higher when I turned the PC near the wifi router 16:00 and 00:00)</p><p>The scripts created by the steps above can be found in <a href="https://github.com/ruzickap/linux.xvx.cz/tree/gh-pages/files/turris_configured">GitHub</a>.</p><p>Enjoy…</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/openwrt/">OpenWrt</a>, <a href="/categories/linux-xvx-cz/">linux.xvx.cz</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/turris/" class="post-tag no-text-decoration" >turris</a> <a href="/tags/monitoring/" class="post-tag no-text-decoration" >monitoring</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Turris%20-%20OpenWRT%20and%20thermometers%20-%20Petr's%20Blog&url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fturris-openwrt-and-thermometers%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Turris%20-%20OpenWRT%20and%20thermometers%20-%20Petr's%20Blog&u=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fturris-openwrt-and-thermometers%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fruzickap.github.io%2Fposts%2Fturris-openwrt-and-thermometers%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <script defer type="module" src="https://cdn.jsdelivr.net/npm/@justinribeiro/share-to-mastodon/+esm"></script> <button class="btn text-start" data-bs-toggle="tooltip" data-bs-placement="top" title="Mastodon" aria-label="Mastodon"> <share-to-mastodon class="share-mastodon" message="Turris%20-%20OpenWRT%20and%20thermometers%20-%20Petr's%20Blog" url="https%3A%2F%2Fruzickap.github.io%2Fposts%2Fturris-openwrt-and-thermometers%2F"customInstanceList="[{&quot;label&quot;:&quot;mastodon.social&quot;,&quot;link&quot;:&quot;https://mastodon.social/&quot;},{&quot;label&quot;:&quot;mastodon.online&quot;,&quot;link&quot;:&quot;https://mastodon.online/&quot;},{&quot;label&quot;:&quot;fosstodon.org&quot;,&quot;link&quot;:&quot;https://fosstodon.org/&quot;},{&quot;label&quot;:&quot;photog.social&quot;,&quot;link&quot;:&quot;https://photog.social/&quot;}]" > <i class="fa-fw fa-brands fa-mastodon"></i> </share-to-mastodon> </button> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/installtion-f5-bigip-virtual-edition-to-rhel7/">Installation F5 BIGIP Virtual Edition to RHEL7</a><li class="text-truncate lh-lg"> <a href="/posts/detect-a-hacker-attacks-eks-vm/">Detect the hacker attacks on Amazon EKS and EC2 instances</a><li class="text-truncate lh-lg"> <a href="/posts/secure-cheap-amazon-eks-auto/">Build secure and cheap Amazon EKS Auto Mode</a><li class="text-truncate lh-lg"> <a href="/posts/eks-auto-cert-manager-velero/">Amazon EKS Auto Mode with cert-manager and Velero</a><li class="text-truncate lh-lg"> <a href="/posts/mcp-servers-k8s/">MCP Servers running on Kubernetes</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon-eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/bash/">bash</a> <a class="post-tag btn btn-outline-primary" href="/tags/pxe/">pxe</a> <a class="post-tag btn btn-outline-primary" href="/tags/wifi/">wifi</a> <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">prometheus</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/turris-openwrt-and-guest-access/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1399500000" data-df="ll" > May 8, 2014 </time><h4 class="pt-0 my-2">Turris - OpenWRT and guest access</h4><div class="text-muted"><p>Turris - OpenWRT and guest access</p></div></div></a></article><article class="col"> <a href="/posts/turris-openwrt-configuration/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1397599200" data-df="ll" > Apr 16, 2014 </time><h4 class="pt-0 my-2">Turris - OpenWrt configuration</h4><div class="text-muted"><p>Turris - OpenWrt configuration</p></div></div></a></article><article class="col"> <a href="/posts/turris-the-open-enterprise-wi-fi-router/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1396994400" data-df="ll" > Apr 9, 2014 </time><h4 class="pt-0 my-2">Turris - The Open Enterprise Wi-Fi Router</h4><div class="text-muted"><p>Turris - The Open Enterprise Wi-Fi Router</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/turris-openwrt-configuration/" class="btn btn-outline-primary" aria-label="Older" ><p>Turris - OpenWrt configuration</p></a> <a href="/posts/turris-openwrt-and-guest-access/" class="btn btn-outline-primary" aria-label="Newer" ><p>Turris - OpenWRT and guest access</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2026</time> <a href="https://twitter.com/Ruzicka_Petr">Petr Ruzicka</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/amazon-eks/">amazon-eks</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/cert-manager/">cert-manager</a> <a class="post-tag btn btn-outline-primary" href="/tags/eksctl/">eksctl</a> <a class="post-tag btn btn-outline-primary" href="/tags/bash/">bash</a> <a class="post-tag btn btn-outline-primary" href="/tags/pxe/">pxe</a> <a class="post-tag btn btn-outline-primary" href="/tags/wifi/">wifi</a> <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">prometheus</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'ruzickap/ruzickap.github.io', 'data-repo-id': 'R_kgDOGkp4nQ', 'data-category': 'General', 'data-category-id': 'DIC_kwDOGkp4nc4CSdu1', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
